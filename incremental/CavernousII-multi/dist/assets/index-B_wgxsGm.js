(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const Y=`<svg
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:cc="http://creativecommons.org/ns#"
xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns:svg="http://www.w3.org/2000/svg"
xmlns="http://www.w3.org/2000/svg"
width="14"
height="14"
viewBox="0 0 100 100"
version="1.1"><g>`,U="</g></svg>",Ut=Y+`<path
style="fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:0.195532px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
d="M 75.685627,99.4946 75.347197,54.404488 99.797843,64.146031 48.867133,-0.04885298 0.40663777,64.892147 23.207155,54.795838 l 0.33843,45.09011 z"
sodipodi:nodetypes="cccccccc" />`+U,Ft=Y+`<path
style="fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:0.195532px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
d="M 24.679697,0.09776622 V 45.189149 L 0.30285443,35.264368 50.75032,99.839696 99.69686,35.264246 76.821208,45.189143 V 0.09776622 Z"
sodipodi:nodetypes="cccccccc" />`+U,Kt=Y+`<path
style="fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:0.195532px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
d="M 99.710792,24.30587 54.62068,24.6443 64.362223,0.19365396 0.16734307,51.124364 65.108339,99.584859 55.01203,76.784342 l 45.09011,-0.33843 z"
sodipodi:nodetypes="cccccccc" />`+U,Mt=Y+`<path
style="fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:0.195532px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
d="M 0.49689686,75.469431 45.587009,75.131001 35.845466,99.581647 100.04035,48.650937 35.09935,0.19044171 45.195659,22.990959 0.10554886,23.329389 Z"
sodipodi:nodetypes="cccccccc" />`+U,_t=Y+`<ellipse
style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:24.8532;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
cx="50.000019"
cy="50.000023"
rx="37.573391"
ry="37.573414" />`+U,Ct=Y.replace(/"14"/g,'"22"')+`<path
style="fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:1.70587;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
d="M 91.9799,91.807365 18.079698,16.036452 25.563263,8.5529065 101.33436,82.452928 Z"
sodipodi:nodetypes="ccccc" />
<rect
style="fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:1.02885;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
width="24.971128"
height="13.971112"
x="22.162033"
y="7.162077"
transform="matrix(0.70710772,0.70710584,-0.70710756,0.70710601,0,0)" />
<path
style="fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
d="M 18.115658,40.012506 8.6448037,30.806257 21.500632,17.265495 C 34.342634,4.4235229 48.2233,-2.5167945 52.503969,1.763861 L 62.503992,11.763863 C 58.223325,7.4832065 44.342658,14.423523 31.500655,27.265494 Z"
sodipodi:nodetypes="ccccccc" />`+U,Qt=Y.replace("0 0 100 100","-10 -10 120 120")+`<ellipse
style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:20;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
cx="50.000019"
cy="50.000023"
rx="37.573391"
ry="37.573414" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none"
width="32.915249"
height="1.9515609"
x="15.293995"
y="34.624523"
transform="rotate(-45)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none"
width="32.915249"
height="1.9515609"
x="34.624523"
y="-17.245558"
transform="rotate(45)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none"
width="32.915249"
height="1.9515609"
x="15.016818"
y="-106.00282"
transform="rotate(135)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none"
width="32.915249"
height="1.9515609"
x="-106.00282"
y="-16.968386"
transform="rotate(-135)" />`+U,Xt=Y.replace("0 0 100 100","10 0 100 110")+`<path
style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:20;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
transform="rotate(-90)"
sodipodi:type="arc"
sodipodi:cx="-47.573391"
sodipodi:cy="66.676941"
sodipodi:rx="37.573391"
sodipodi:ry="37.573414"
sodipodi:start="4.5378561"
sodipodi:end="3.6651914"
sodipodi:arc-type="arc"
d="m -54.097942,29.674352 a 37.573391,37.573414 0 0 1 41.237838,22.623866 37.573391,37.573414 0 0 1 -13.162075,45.157061 37.573391,37.573414 0 0 1 -46.935426,-3.076311 37.573391,37.573414 0 0 1 -7.155298,-46.488733"
sodipodi:open="true" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none"
width="32.915249"
height="1.9515609"
x="-65.493187"
y="-22.577936"
transform="rotate(-135)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none"
width="32.915249"
height="1.9515609"
x="-22.577936"
y="63.541618"
transform="rotate(-45)" />`+U,Jt=Y.replace("0 0 100 100","0 0 110 100")+`<rect
style="fill:#000000;stroke:#000000;stroke-width:9.93948;stroke-miterlimit:4;stroke-dasharray:none"
width="32.716053"
height="1.9397504"
x="-44.910587"
y="54.781082"
transform="matrix(0.71201421,-0.70216505,0.71201421,0.70216505,0,0)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:9.93948;stroke-miterlimit:4;stroke-dasharray:none"
width="32.716053"
height="1.9397504"
x="54.781082"
y="42.970829"
transform="matrix(0.71201421,0.70216505,-0.71201421,0.70216505,0,0)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10.7087;stroke-miterlimit:4;stroke-dasharray:none"
width="63.291317"
height="1.1638763"
x="11.354335"
y="69.019333" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:9.93948;stroke-miterlimit:4;stroke-dasharray:none"
width="32.716053"
height="1.9397504"
x="-50.982647"
y="-93.638168"
transform="matrix(-0.71201421,0.70216505,-0.71201421,-0.70216505,0,0)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:9.93948;stroke-miterlimit:4;stroke-dasharray:none"
width="32.716053"
height="1.9397504"
x="-93.638168"
y="49.042889"
transform="matrix(-0.71201421,-0.70216505,0.71201421,-0.70216505,0,0)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10.7087;stroke-miterlimit:4;stroke-dasharray:none"
width="63.291317"
height="1.1638763"
x="-98.645668"
y="-30.932226"
transform="scale(-1)" />`+U,en=Y.replace("0 0 100 100","0 0 110 100")+`<rect
style="fill:#000000;stroke:#000000;stroke-width:9.93948;stroke-miterlimit:4;stroke-dasharray:none"
width="32.716053"
height="1.9397504"
x="-44.910587"
y="54.781082"
transform="matrix(0.71201421,-0.70216505,0.71201421,0.70216505,0,0)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:9.93948;stroke-miterlimit:4;stroke-dasharray:none"
width="32.716053"
height="1.9397504"
x="54.781082"
y="42.970829"
transform="matrix(0.71201421,0.70216505,-0.71201421,0.70216505,0,0)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10.7087;stroke-miterlimit:4;stroke-dasharray:none"
width="63.291317"
height="1.1638763"
x="11.354335"
y="69.019333" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:9.93948;stroke-miterlimit:4;stroke-dasharray:none"
width="32.716053"
height="1.9397504"
x="-50.982647"
y="-93.638168"
transform="matrix(-0.71201421,0.70216505,-0.71201421,-0.70216505,0,0)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:9.93948;stroke-miterlimit:4;stroke-dasharray:none"
width="32.716053"
height="1.9397504"
x="-93.638168"
y="49.042889"
transform="matrix(-0.71201421,-0.70216505,0.71201421,-0.70216505,0,0)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10.7087;stroke-miterlimit:4;stroke-dasharray:none"
width="63.291317"
height="1.1638763"
x="-98.645668"
y="-30.932226"
transform="scale(-1)" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:10.9459;stroke-miterlimit:4;stroke-dasharray:none"
width="83.054092"
height="0.92666042"
x="-109.25067"
y="18.000542"
transform="rotate(-120)" />`+U,tn=Y+`<path
style="fill:#000000;fill-rule:nonzero;stroke:none;stroke-width:13.6765;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
d="M 95.138414,68.714019 C 89.811746,66.779793 76.937774,61.926021 64.511934,57.114146 57.325396,54.331177 48.756213,50.962801 41.004921,47.583351 35.509621,45.18748 31.083504,43.072344 27.69944,41.22435 c -1.511624,-0.825478 -2.564896,-1.459954 -3.400568,-1.983676 -0.75034,-0.470245 -1.144413,-0.762278 -1.164562,-0.612315 -0.01958,0.145765 0.373401,0.755801 0.663639,2.145461 0.144892,0.693747 0.237424,1.540882 0.171882,2.495642 -0.06583,0.958995 -0.282877,1.895866 -0.639323,2.762073 -0.350732,0.852317 -0.790958,1.52646 -1.212724,2.026195 -0.415835,0.492709 -0.80337,0.805112 -1.078648,0.980994 -0.630548,0.402874 -0.653713,0.179862 -0.497126,0.01263 0.500157,-0.534147 2.202708,-1.334 4.518135,-2.105185 2.474242,-0.824079 5.482656,-1.582016 8.562766,-2.274897 2.55254,-0.574201 5.27764,-1.130456 7.691201,-1.613545 4.621884,-0.925098 9.289424,-1.744835 13.640719,-2.645224 3.677013,-0.760864 7.177935,-1.586897 10.327988,-2.598292 3.28452,-1.054568 6.467231,-2.397177 9.113653,-4.275787 1.405121,-0.997453 2.770555,-2.224786 3.896751,-3.736257 1.182337,-1.586818 2.087453,-3.475094 2.437951,-5.597542 0.171873,-1.040783 0.199531,-2.077905 0.09146,-3.089723 C 80.70872,20.048393 80.442304,19.028463 80.052187,18.070501 79.315693,16.261985 78.173316,14.75191 76.867246,13.473802 75.559327,12.193886 74.005831,11.067029 72.346719,10.04111 70.591239,8.9556012 68.609432,7.9182835 66.555254,6.9320672 61.07629,4.3016029 54.239842,1.654467 50.246312,0 c 3.645003,2.7467878 8.856744,7.2301701 12.527225,11.797883 1.325107,1.649025 2.379436,3.220047 3.110252,4.654418 0.692031,1.358251 1.048507,2.50904 1.101266,3.371423 0.05225,0.854112 -0.207553,1.318415 -0.544807,1.329341 -0.173642,0.0056 -0.345954,-0.112399 -0.476403,-0.309242 -0.12495,-0.188544 -0.206205,-0.43344 -0.245854,-0.695646 -0.07834,-0.518105 0.03265,-0.996921 0.0095,-1.18386 -0.02219,-0.179502 -0.181689,-0.133291 -0.618563,0.04316 -1.041446,0.420625 -2.309848,0.970044 -4.984606,1.70524 -2.343284,0.644086 -5.174535,1.255876 -8.53877,1.820791 -3.972782,0.667101 -8.34081,1.211755 -13.086587,1.683475 -2.292907,0.22791 -5.4375,0.530233 -8.07634,0.810529 -3.273143,0.347672 -6.952704,0.780269 -10.293188,1.359012 -3.011964,0.521827 -6.504226,1.281836 -9.562163,2.567234 -1.5311583,0.64362 -3.3176602,1.566127 -5.0007467,2.941437 -0.8585666,0.701566 -1.7469212,1.566985 -2.5658429,2.629099 -0.826446,1.071875 -1.5784506,2.340168 -2.14046162,3.810303 -0.56820767,1.486352 -0.89838482,3.065835 -0.97033249,4.692363 -0.0719305,1.626182 0.11955772,3.1683 0.47489394,4.58227 0.70318867,2.798149 2.04464737,5.095381 3.32085117,6.828324 1.3342675,1.811787 2.8996661,3.415312 4.476104,4.817751 1.6681093,1.483992 3.5351006,2.907491 5.5218186,4.274868 4.406187,3.032598 9.78875,6.051374 15.577397,8.968544 8.257168,4.161173 17.378524,8.126674 24.66934,11.121773 13.006767,5.343235 25.851678,9.881047 31.46682,11.920023 z"
sodipodi:nodetypes="cc"
inkscape:path-effect="#path-effect1207"
inkscape:original-d="M 90.267782,82.127264 C -109.79121,9.4816321 148.34729,56.074321 50.246312,0" />`+U,nn=Y+`<rect
style="fill:#000000;stroke:#000000;stroke-width:17.3414;stroke-miterlimit:4;stroke-dasharray:none"
width="2.6586194"
height="72.658623"
x="68.670677"
y="13.670691" />
<rect
style="fill:#000000;stroke:#000000;stroke-width:17.3414;stroke-miterlimit:4;stroke-dasharray:none"
width="2.6586232"
height="72.658623"
x="-31.329311"
y="-86.329308"
transform="scale(-1)" />`+U;let on=new URL(document.location.href).searchParams.get("messages")=="disabled";function it(){return document.querySelector("#message-box")??(()=>{throw new Error("No config box found")})()}class w{name;message;displayed;constructor(e,t){this.name=e,this.message=t.replace(/\t/g,"").trim().replace(/\n/g,`<br>
`),this.displayed=!1}display(e=!1){return this.displayed&&!e||on?!1:(document.querySelector("#message-title").innerHTML=this.name,document.querySelector("#message-text").innerHTML=this.message,it().hidden=!1,this.displayed=!0,!0)}}function Pe(){it().hidden=!0}function b(n){return At.find(e=>e.name===n)}const At=[new w("Welcome to Cavernous!",`
			You wake up in a bare room.
			One of the walls looks soft enough for you to dig through,
			but you have a feeling you'll be back here again.

			Move around with <u>arrow keys</u> - try going right!
			You can click on a tile to view its description.
			Click anywhere to continue.`),new w("Digging",`
			That wall was surprisingly easy to dig through. It only took 1 second!
			It looks like 1 mana drained away while you did it, though.
			You wonder what will happen when you run out of mana.`),new w("Out of Mana",`
			As your mana runs out you freeze in place, and feel a tugging on your spirit to draw you back to where you started.

			(Click "Travel back in time" or press the <u>R</u> key to reset)`),new w("Time Travel",`
			You're back in the room you first found yourself in.
			This time, you feel slightly more competent than last time.
			Is that because you now know a little of the cave you're in?
			Given time, you're sure you can find a way out.
			And while you haven't, it would be good to use the <u>spacebar</u> to extract mana from those rocks.
			If you haven't found a mana rock, maybe keep looking!

			<b>Controls:</b>
			<u>Backspace</u> to remove last action
			<u>Ctrl+Backspace</u> to clear queue
			<u>Arrows</u> to move
			<u>Spacebar</u> to interact`),new w("Persisted Programming",`
			The actions you input are remembered below the map and will repeat each loop.
			Use backspace to clear the actions before resetting if you want to try something different.`),new w("The Looping of Looping Loops",`
			The time repeats itself over and over, the cave stays the same.

			Check the <u>Options</u> panel for the <u>Auto-Restart requirement (W)</u>
			Setting it to "Wait when any complete" will ignore game.clones that end with a Sync (=) action.`),new w("Mana Extraction",`
			You found a mana spring!
			If you use space to interact, you can drain the mana from here to increase your starting mana, which will increase the time you can spend in a loop.
			When you reset the loop, the mana spring regenerates and you can drain it again, increasing your starting mana further.`),new w("Strip Mining",`
			It's getting harder to extract mana from that rock.
			Soon, you'll have to go out and find another rock to extract mana from.
			Maybe you can come back to this one later when you have more mana to spend on it.

			Check the right panel to estimate how many more times you can refine this rock`),new w("All the known ways",`
			There are many mana rocks, but the shortest path is always the best one.

			Check the <u>Options</u> panel for the <u>Auto-Grind</u>
			to automatically select the fastest path`),new w("Buy More Time",`
			Have you found the Vaporizer yet?  Interacting with it will turn your gold into mana!
			You can probably mine those rocks a few additional times with that.`),new w("Looper's Log: Supplemental",`
			There is a log of your actions this loop, which will help you plan out your game.routes better. ("Loop Log", on the left)
			Mousing over an action there will give you a breakdown of which stats affect that action.`),new w("First Clone",`
			You've created your first clone!  It can carry out actions in exactly the same way you can.
			You can create more game.clones by bringing more gold to a Clone Machine.  Click on a Clone Machine to find out how much the next clone costs.
			Your game.clones can act independently or help each other out by cooperating on the same task.  Keeping them idle doesn't save you any mana.
			Two game.clones can work in the same space, taking half the time it takes one clone to complete the job (they don't help each other walk around).

			Use CTRL-click to select more than one clone or CTRL-A to select them all.  Tab rotates through them.`),new w("Second Clone",`
			You've created another clone!  Remember, these game.clones can work together.
			It's probably a good thing that you can get along with yourself - it would get messy quick if you couldn't.

			Use CTRL-click to select more than one clone or CTRL-A to select them all.  Tab rotates through them.`),new w("Third Clone",`
			You've created yet another clone.
			Soon you'll have a personal army!  Perhaps one of them will know why you're in this place...
			You might begin to notice now that some of your old game.routes don't work any more - this might be because you're getting so efficient the old ways get out of sync.`),new w("Fourth Clone",`
			Time seems to be a bit unstable.  How many of you must there be before you escape the final zone?`),new w("Goblin",`
			What you thought was a strange statue in the passage suddenly moves to attack you as you approach!  This place is stranger than you'd thought.`),new w("Death",`
			That goblin killed one of your game.clones!
			Fortunately for you, death is not the end.  Surely you'll be able to overcome this obstacle in short order.
			If you <u>sync</u> your game.clones and have them attack together, you might have better luck.  Or maybe you need to craft more or better weapons.`),new w("Learning",`
			Despite going back in time, your skills are slowly improving.  You can perform actions faster than before!

			Each stat is displayed as <u>current</u> (<u>base</u>), and your current value is reset to your base value when you travel back in time.
			You'll need to achieve a high enough current value for your base to increase.
			Hovering over a stat displays the percentage of time you save on tasks using that stat.`),new w("Lava Can't Melt Steel Bridges",`
			You worked so hard on that bridge, and to see it quickly turn to slag after crossing that lava is sad.
			At least one of your game.clones made it across.`),new w("Mass Manufacturing",`
			You've sure got a lot of iron!  You can use the Repeat-Interact action to forge it all into bars.  Use ctrl-space to insert a Repeat-Interact action into your queue.
			You might not need it now, but later in the game it can really help with making sure your game.clones line up when forging bars or vaporizing gold.
			Unlike normal interact, if you don't have the resources to start an interact action, it'll just skip it entirely.`),new w("Arcane Shield",`
			Your deepening understanding of the mysteries of magic give you the idea of forming your mana into a shield, protecting yourself from danger.
			You'll preserve your health, but it might take a lot of mana to maintain.  Each clone will have to form one separately.
			It will last until the end of your next fight.`),new w("Enter New Zone",`
			You've found a portal to another zone!
			Each zone has at least 3 mana rocks - they give more mana but their cost scales faster the deeper you get.  They give 0.1 mana to each zone up to the current one, which you'll receive on entering that zone.
			You can view a zone by clicking on it, and hovering it shows a summary of the game.routes you've beaten it with.  You can click on these game.routes to load them.  There's an option which lets you load only that route or that route and its prerequisites.
			Only one clone needs to pass through the portal, and the rest will be brought to the next zone with it.`),new w("Game Slowdown",`
			At this point, the game slows down quite a bit.  You'll need to grind stats much more in order to progress.  If that's not your thing, no worries!  Thanks for playing this far.  You've beaten the tightly-designed portion of the game, and I'd count that as a win.

			If you're sticking around, there's much more that you haven't yet reached.`),new w("Unlocked Weaken Rune",`
			You've unlocked a rune!
			To place a rune, press the relevant number, and the rune will be inscribed upon the space that clone is in.  You can inscribe runes only on Dug Tunnel spaces.
			The Weaken rune reduces the attack and defense of adjacent enemies by 1 point each (but not below 0).
			You can find the cost to place a rune in that rune's tooltip.`),new w("Unlocked Wither Rune",`
			You've unlocked a rune!
			The Wither rune kills plants next to it.  After placing it, interact with it to charge it up and kill orthogonally adjacent plants.`),new w("Unlocked Duplication Rune",`
			You've unlocked a rune!
			The Duplication rune gets you more stuff.  After placing it, interact with it to charge it up.
			Once it's charged, each of the 8 adjacent spaces will give one extra resource (of the type it already gives).
			Each Duplication rune placed in a zone takes longer to charge up.`),new w("Unlocked Teleport Runes",`
			You've unlocked a rune!  Well, two runes.
			You can place one To rune per zone, and any number of From runes.  Activating any From rune teleports you to the To rune.`),new w("Unlocked Pump Rune",`
			You've unlocked a rune!
			A pump rune costs a steel bar and 3 iron bars and drains the water from the 4 surrounding spaces.  It's pricy, but it'll keep you from drowning.`),new w("Other Realms",`
			There are realms beyond this one, and you've just discovered a way to get to the Long Realm! The Long Realm looks just like the Core Realm, but almost everything takes thrice as much effort and twice as many resources.
			Mining mana there will reduce the cost scaling of that mana rock in all Realms.`),new w("Further Realms",`
			There are realms beyond this one, and you've just discovered a way to get to the Verdant Realm!
			In the Verdant Realm, there is almost nothing that's not some kind of mushroom.
			Mining mana there will increase the conversion rate between gold and mana.`),new w("Compounding Realm",`
			In the Compounding Realm, you feel like you're moving through molasses.
			Each time you move, subsequent actions will take 2.5% longer.
			However, mining mana there will increase your ability to learn past 100.`),new w("Upgraded Duplication Rune",`
			You've upgraded the Duplication rune!
			Duplication now gives 25% more resources (you can't do anything with less than a full item, though, unless you have enough quarter items).  Further upgrades will increase this by 25% (additively).`),new w("Upgraded Wither Rune",`
			You've upgraded the Wither rune!
			Wither now affects all diagonally adjacent plants as well as orthogonally adjacent plants.  Further upgrades will double its potency each time.`),new w("Reupgraded Wither Rune",`
			You've upgraded the Wither rune again!
			Wither now takes half as long to complete.  There's one more upgrade for Wither available, which will halve the time required again.`),new w("Time Barriers",`
			You've unlocked the first of the time barriers!
			There's one in each zone, behind which is a mana rock.  However, breaching a time barrier causes the zone to leech 5 of your mana per second.`),new w("Complete Verdant",`
			You've learned all that you can in the Verdant Realm.  You no longer have access to it - but wither runes no longer cost any gold.`),new w("You Win!",`
			You've beaten the game!
			There may be, in the future, further updates to this game.
			It is highly likely, however, that those updates will be in the form of Cavernous III.
			Thanks for playing!`)];var T=(n=>(n[n.Never=0]="Never",n[n.NotNow=1]="NotNow",n[n.Now=2]="Now",n))(T||{}),k=(n=>(n[n.NotStarted=0]="NotStarted",n[n.Started=1]="Started",n[n.Waiting=2]="Waiting",n[n.Complete=3]="Complete",n))(k||{});const ot=5;class H{name;icon;description;current;base;learnable;bonus;node;value;dirty;lastIncreaseRequired;lastIncreaseUpdate;min;effectNode=null;descriptionNode=null;constructor(e,t,i,o=0,a=!0){this.name=e,this.icon=t,this.description=i,this.current=this.base=this.min=o,this.learnable=a,this.bonus=0,this.node=null,this.value=1,this.dirty=!1,this.lastIncreaseRequired=0,this.lastIncreaseUpdate=this.base}updateValue(){this.current<100?this.value=100/(100+this.current+this.bonus):this.value=100/(100+this.current*(100+this.bonus)/100),this.dirty=!0}get baseValue(){return 100/(100+this.base)}gainSkill(e){if(isNaN(+e))return;const t=this.current;if(this.current+=e/10,this.dirty=!0,this.current>5&&t<=5&&b("Learning").display(),!this.learnable)return;const i=99+W("Compounding Realm")*(1+S.level)+S.level*20,o=(this.base+1)**(10/9*(this.base>i?i/this.base:1)**.05)-1,a=(this.current+1)**(.9*(this.base>i?i/this.base:1)**.05)-(this.base+1);if(a<0)return;let l=(t+1)**(.9*(this.base>i?i/this.base:1)**.05)-(this.base+1);l<0&&(l=0);const c=(a-l)/this.statIncreaseDivisor*(.99+W("Compounding Realm")*(1+S.level)/100+S.level*20/100)*Math.max(1,this.current/Math.max(1,o))**.5;this.base+=c}setStat(e){isNaN(+e)||this.base+e<this.current||(this.current=this.base+e,this.dirty=!0,this.update())}update(e=!1){if(this.dirty){if(this.updateValue(),!this.node||!this.effectNode||!this.descriptionNode){if(this.base===0&&this.current===0||["Health","Attack","Defense"].includes(this.name)&&g("Combat").base===0)return;this.createNode(),this.effectNode=this.node.querySelector(".effect"),this.descriptionNode=this.node.querySelector(".description")}if(this.name==="Mana")this.effectNode.innerText=`${v(this.current<100?this.current+this.bonus:this.current*(1+this.bonus/100),1)} (${v(this.base,1)})`;else if(!this.learnable)this.effectNode.innerText=v(this.current<100?this.current+this.bonus:this.current*(1+this.bonus/100),1);else{this.effectNode.innerText=`${v(this.current<100?this.current+this.bonus:this.current*(1+this.bonus/100),2)} (${v(this.base,2)})`;let t;const i=99+W("Compounding Realm")*(1+S.level)+S.level*20;if(this.base<i)t=(this.base+1)**(10/9)-1;else if(!e&&this.lastIncreaseRequired&&this.base-.01<this.lastIncreaseUpdate)t=this.lastIncreaseRequired;else{let a=this.base,l=this.base;for(;;){const c=(a+1)**(.9*i**.05/this.base**.05)-(this.base+1);if(Math.abs(c)<.1||isNaN(c)||l<.1)break;c>0&&(a-=l,l/=2),c<0&&(a+=l)}t=a,this.lastIncreaseRequired=t,this.lastIncreaseUpdate=this.base}const o=G.getBestRoute(this.name);this.descriptionNode.innerText=`${this.description} (${v(100-this.value*100,1)}%)
			Increase at: ${v(t,2)}
			Current: ${v(this.current,2)} + ${v(this.current<100?this.bonus:this.current*(100+this.bonus)/100-this.current,2)}`+(o?`
			Click to load best grind route (projected +${v(o?.projectedGain||0,3)}) in ${v(o?.totalTime/1e3||0,1)}s
			This route is in the ${f[o.realm].name}.
			Ctrl-click to delete this stat's grind route.`:"")}this.dirty=!1}}createNode(){const e=document.querySelector("#stat-template");if(e===null)throw new Error("No stat template");this.node=e.cloneNode(!0),this.node.id="stat_"+this.name.replace(" ","-"),this.node.querySelector(".name").innerHTML=this.name,this.node.querySelector(".icon").innerHTML=this.icon.length?this.icon:"&nbsp",this.node.querySelector(".description").innerHTML=this.description,this.node.addEventListener("click",this.loadGrindRoute.bind(this)),document.querySelector("#stats").appendChild(this.node),this.name==="Runic Lore"&&(document.querySelector(".active-pane")||document.querySelector("#runes").classList.add("active-pane"))}loadGrindRoute(e){this.learnable&&(e?.ctrlKey||e?.metaKey?(G.deleteRoute(this.name),this.dirty=!0,this.update()):G.getBestRoute(this.name)?.loadRoute())}reset(){this.name==="Mana"&&(this.base=ot),!(this.current===this.base&&this.bonus===0)&&(this.current=this.base,this.bonus=0,this.dirty=!0)}get statIncreaseDivisor(){return d.debug_statIncreaseDivisor||100}spendMana(e){this.name==="Mana"&&(this.current-=e,this.current<.01&&(this.current=0),this.dirty=!0,this.min=Math.min(this.current,this.min))}getBonus(e){this.bonus+=e,this.dirty=!0,this.update()}}const P=[new H("Mana","","How long you can resist being pulled back to your cave.  Also increases the maximum speed the game runs at.",ot,!1),new H("Mining","â›","Your skill at mining, reducing the time it takes to do mining-type tasks."),new H("Woodcutting","","How good you are at chopping down mushrooms of various kinds."),new H("Magic","â˜…","Your understanding of arcane mysteries."),new H("Speed","","How quick you are."),new H("Smithing",Ct,"Your skill at turning raw ores into usable objects."),new H("Runic Lore","ðŸ•®","A measure of your understanding of magical runes."),new H("Combat","","Your ability to kill things.",0),new H("Gemcraft","","You pick pretty stuff from the walls - in one piece.",0),new H("Chronomancy","","Your command of magic has expanded, even affecting the flow of time! (It helps you resist the leeching of time barriers)",0),new H("Attack","","How much damage your wild flailing does. (Weapons increase all game.clones' stats)",0,!1),new H("Defense","","How well you avoid taking damage. (Shields increase all game.clones' stats)",0,!1),new H("Health","â™¥","How many hits you can take until you're nothing more than meat. (Armour increases all game.clones' stats)",10,!1)];function g(n){return P.find(e=>e.name===n)}function be(n=r.currentZone,e=r.currentRealm){return ot+s.reduce((t,i,o)=>o>n?t:t+i.cacheManaGain[e],0)}const fe=5;class q{name;icon;description;colour;count;index=-1;node;countNode;min;effect;constructor(e,t,i,o,a=0,l=null){this.name=e,this.icon=t,this.description=i,this.colour=o,this.count=a,this.node=null,this.countNode=null,this.min=0,this.effect=l,setTimeout(()=>{this.index=se.findIndex(c=>c===this)})}update(e=0){this.node===null&&this.createNode(),this.count+=e,this.effect!==null&&this.effect(this.count-e,this.count),this.count=Math.round(this.count*100)/100,this.countNode.innerText=v(this.count,Math.abs(Math.round(this.count)-this.count)<.01?0:2).replace(/(\.[123456789])0+$/,"$1"),this.count>0&&(this.countNode.parentNode.style.display="inline-block"),this.min=Math.min(this.count,this.min),this.displayDescription()}displayDescription(){if(this.description.includes("{}")){const e=g({"Iron Axe":"Woodcutting","Iron Pick":"Mining","Iron Hammer":"Smithing"}[this.name]),t=Math.pow(e.value,.01*this.count*(1+.1*S.level));this.node&&(this.node.querySelector(".description").innerHTML=this.description.replace("{}",v(t*100,1)))}}createNode(){if(this.node)return;let e=document.querySelector("#stuff-template");if(e===null)throw new Error("No stuff template");this.node=e.cloneNode(!0),this.node.id="stuff_"+this.name.replace(" ","_"),this.node.querySelector(".name").innerHTML=this.name,this.node.querySelector(".icon").innerHTML=this.icon,this.node.querySelector(".description").innerHTML=this.description.replace("{}","0"),this.node.style.color=rn(this.colour),this.node.style.backgroundColor=this.colour,this.node.style.order=this.index.toString(),document.querySelector("#stuff-inner").appendChild(this.node),this.countNode=this.node.querySelector(".count")}resetMin(){this.effect!=null?this.min=0:this.min=this.count}}function J(){let n=[];n.push(...Array(M("+1 Sword").count).fill(4)),n.push(...Array(M("Steel Sword").count).fill(2)),n.push(...Array(M("Iron Sword").count).fill(1)),n=n.slice(0,r.clones.length).reduce((i,o)=>i+o,0);let e=[];e.push(...Array(M("+1 Shield").count).fill(4*(1+.1*S.level))),e.push(...Array(M("Steel Shield").count).fill(2*(1+.1*S.level))),e.push(...Array(M("Iron Shield").count).fill(1*(1+.1*S.level))),e=e.slice(0,r.clones.length).reduce((i,o)=>i+o,0);let t=[];t.push(...Array(M("+1 Armour").count).fill(25*(1+.1*S.level))),t.push(...Array(M("Steel Armour").count).fill(15*(1+.1*S.level))),t.push(...Array(M("Iron Armour").count).fill(5*(1+.1*S.level))),t=t.slice(0,r.clones.length).reduce((i,o)=>i+o,0),g("Attack").setStat(n),g("Defense").setStat(e),g("Health").setStat(t),r.clones.forEach(i=>i.styleDamage())}function De(n,e){let t=g(n);return(i,o)=>t.getBonus((Math.floor(o+.01)-Math.floor(i+.01))*e*(1+.1*S.level))}const se=[new q("Gold Nugget","â€¢","This is probably pretty valuable.  Shiny!","#ffd700",0),new q("Salt","âŒ‚","A pile of salt.  You're not hungry, so what's this good for?","#ffffff",0),new q("Iron Ore","â€¢","A chunk of iron ore.  Not useful in its current form.","#777777",0),new q("Gem","â˜¼","A gem, pulled from the ground.  Gives +2.5 (or +2.5%) to Magic.","#90ee90",0,De("Magic",2.5)),new q("Coal","â—‹","A chunk of coal.  Burns hot.","#222222",0),new q("Iron Bar","âš","An iron rod.  Has a faint smell of bacon.","#777777",0),new q("Iron Bridge","âŽ¶","A small iron bridge.","#777777",0),new q("Iron Sword",")","An iron sword.  Sharp! (+1 attack)  Max 1 weapon per clone.","#777777",0,J),new q("Iron Shield","[","An iron shield.  This should help you not die. (+1 defense)  Max 1 shield per clone.","#777777",0,J),new q("Iron Armour","]","An suit of iron armour.  This should help you take more hits. (+5 health)  Max 1 armour per clone.","#777777",0,J),new q("Steel Bar","âš","A steel rod.","#333333",0),new q("Steel Bridge","âŽ¶","A small steel bridge.","#222222",0),new q("Steel Sword",")","A steel sword.  Sharp! (+2 attack)  Max 1 weapon per clone.","#222222",0,J),new q("Steel Shield","[","A steel shield.  This should help you not die. (+2 defense)  Max 1 shield per clone.","#222222",0,J),new q("Steel Armour","]","A suit of steel armour.  This should help you take more hits. (+15 health)  Max 1 armour per clone.","#222222",0,J),new q("Iron Axe","Â¢","An iron axe.  Gives +15 or +15% to Woodcutting (whichever is greater), and applies 1% of your Woodcutting skill to combat ({}%).","#777777",0,De("Woodcutting",15)),new q("Iron Pick","â›","An iron pickaxe.  Gives +15 or +15% to Mining (whichever is greater), and applies 1% of your Mining skill to combat ({}%).","#777777",0,De("Mining",15)),new q("Iron Hammer",Ct,"An iron hammer.  Gives +15 or +15% to Smithing (whichever is greater), and applies 1% of your Smithing skill to combat ({}%).","#777777",0,De("Smithing",15)),new q("+1 Sword",")","A magical sword.  Sharp! (+4 attack)  Max 1 weapon per clone.","#688868",0,J),new q("+1 Shield","[","A magical shield.  This should help you not die. (+4 defense)  Max 1 shield per clone.","#688868",0,J),new q("+1 Armour","]","A suit of magical armour.  This should help you take more hits. (+25 health)  Max 1 armour per clone.","#688868",0,J)];function rn(n){return(parseInt(n.slice(1,3),16)*299+parseInt(n.slice(3,5),16)*587+parseInt(n.slice(5,7),16)*114)/1e3>125?"#000000":"#ffffff"}function an(n){let e=[...n.matchAll(/\d+/g)];return e.length==4||(e[0]*299+e[1]*587+e[2]*114)/1e3>125?"#000000":"#ffffff"}function M(n){return se.find(e=>e.name==n)}function Lt(n,e){function t(i){let o=M(i.name);return`<span style="color: ${o.colour}">${Math.round(i.count*1e3)/1e3}${o.icon}</span>`}if(e.require?.length)n.querySelector(".require").innerHTML=`<span class="actions">${e.actionCount||""}</span> `+e.require.map(t).join("")+(e instanceof ge?Mt:"");else{let i=n.querySelector(".require");i&&(i.innerHTML=`<span class="actions">${e.actionCount||""}</span> `)}if(e instanceof ge&&e.stuff.length)n.querySelector(".stuff").innerHTML=e.stuff.map(t).join(""),e.cloneHealth.some(i=>i[1]<0)&&(n.querySelector(".stuff").innerHTML+=`<span style="color: #ff0000">${e.cloneHealth.filter(i=>i[1]<0).length}â™¥</span>`);else{let i=n.querySelector(".stuff");i&&(i.innerHTML="")}}function sn(n){const e={"Iron Armour":5*(1+.1*S.level),"Steel Armour":15*(1+.1*S.level),"+1 Armour":25*(1+.1*S.level)};return n.reduce((t,i)=>t+(e[i.name]||0)*i.count,0)}class ge{realm;route;mana;stuff;cloneHealth;manaRequired;require;actionCount;noValidPrior=!1;isLocked=!1;id;constructor(e){if(e instanceof K){let t=s[r.currentZone].queues.map(o=>Oe(o));if(t=t.filter(o=>o.length),this.realm=r.currentRealm,t.every((o,a,l)=>o==l[0]))t=[t[0]];else{let o=t.find((l,c,u)=>u.filter(h=>h==l).length==1),a=t.find(l=>l!=o);t.every(l=>l==o||l==a)&&o&&a&&(t=[o,a])}this.route=t;let i=g("Mana");this.mana=i.current-e.startMana,this.stuff=se.filter(o=>o.count>0).map(o=>({name:o.name,count:o.count})).filter(o=>o.count>0),this.cloneHealth=r.clones.map(o=>[o.minHealth,o.startDamage-o.damage]),this.manaRequired=e.startMana-i.min,this.require=e.startStuff.map(o=>({name:o.name,count:o.count})).filter(o=>o.count>0),this.actionCount=f[this.realm].name=="Compounding Realm"?r.loopCompletions:0,this.id=Ze++;return}Object.assign(this,e),this.id?Ze=Math.max(Ze,this.id+1):this.id=Ze++}isBetter(e,t=.1){return this.mana>=e.mana-.1&&this.manaRequired<=e.manaRequired+t&&e.stuff.every(i=>(this.stuff.find(o=>o.name==i.name)||{count:-1}).count>=i.count)&&this.require.every(i=>(e.require.find(o=>o.name==i.name)||{count:-1}).count>=i.count)&&this.cloneHealth.every((i,o)=>i[0]>(e.cloneHealth[o]||[0])[0]-.1&&i[1]>(e.cloneHealth[o]||[0,0])[1]-.1)&&this.actionCount<=e.actionCount}isSame(e){return this.realm==e.realm&&this.route.length==e.route.length&&this.route.every((t,i)=>t==e.route[i])&&this.require.length===e.require.length&&Object.entries(this.require).every(([t,i])=>e.require[t].name==i.name&&e.require[t].count==i.count)}pickRoute(e,t,i=r.clones.map(a=>0),o=this.actionCount){let a=s[e].sumRoute(t,i,o);if(e==0){if(a.length==0)return null;let l=g("Health"),c=a.find(u=>u[1].every(h=>h.count==0)&&u[2].every(h=>h<l.base))||[];return c[0]?[c[0]]:null}for(let l=0;l<a.length;l++){let c=this.pickRoute(e-1,a[l][1],a[l][2]);if(c!==null)return[...c,a[l][0]]}return null}loadRoute(e,t=!0){let i=r.currentZone;r.currentZone=e.index;for(let o=0;o<e.queues.length;o++)o==0||this.route.length==1?e.queues[o].fromString(this.route[0]):this.route.length==2?e.queues[o].fromString(this.route[1]):e.queues[o].fromString(this.route[o]||this.route[this.route.length-1]||"");if(r.currentZone=i,e.displaySelectedRoute(),d.loadPrereqs&&e.index>0&&t){let o=this.pickRoute(e.index-1,this.require,this.cloneHealth.map(a=>a[0]));if(o!==null)for(let a=0;a<o.length;a++)o[a].loadRoute(s[a])}return this.require}static fromJSON(e){return e.map(t=>new ge(t))}}function Rt(){let n=[];return r.routes.forEach(e=>{if(e.zone==0||e.realm!=r.currentRealm)return;let t;if(e.usedRoutes&&e.usedRoutes.every((i,o)=>s[o].routes.some(a=>i==a)))t=e.usedRoutes;else if(t=e.pickRoute(e.zone-1,e.require,e.cloneHealth),e.usedRoutes=t,t===null){e.loadingFailed=!0;return}else e.loadingFailed=!1;t.forEach(i=>{n.includes(i)||n.push(i)})}),n}function ln(n=null){let e=Rt();s.forEach(t=>{if(n!==null&&n!=t.index)return;let i=(t.queues+"").replace(/(^|,)(.*?),\2(,|$)/,"$1");t.routes=t.routes.filter(o=>e.includes(o)||(o.route+"").replace(/(^|,)(.*?),\2(,|$)/,"$1")==i||o.realm!=r.currentRealm||o.isLocked),t.routesChanged=!0,t.display()})}let Ze=0;function cn(){return document.querySelector("#version")?.innerText.split(".").map((n,e)=>parseInt(n,36)/100**e).reduce((n,e)=>n+e)??0}const xt=new URL(document.location.href).searchParams;let oe=xt.get("save")||"";oe=`saveGameII${oe&&"_"}${oe}`;const qt=xt.get("saving")=="disabled";let un=async function(){if(qt)return;const e=P.map(C=>({name:C.name,base:C.base})),t=s.map(C=>{const de=[];for(let F=0;F<C.mapLocations.length;F++)for(let le=0;le<C.mapLocations[F].length;le++)if(C.mapLocations[F][le]){const Yt=C.mapLocations[F][le];de.push([le-C.xOffset,F-C.yOffset,Yt.priorCompletionData])}return{name:C.name,locations:de,queues:C.queues?C.queues.map(F=>F.map(le=>le.actionID)):[[]],routes:C.routes,goal:C.goalComplete}}),i={count:r.clones.length},o={saveTime:Date.now(),timeBanked:r.timeBanked},a=At.map(C=>[C.name,C.displayed]),l=JSON.parse(JSON.stringify(r.routes,(C,de)=>{if(C!="log")return C=="usedRoutes"?de?de.map(F=>F.id):void 0:de})),c=z.map(C=>({name:C.name,upgradeCount:C.upgradeCount})),u=f.map(C=>C.machineCompletions),h=f.map(C=>({maxMult:C.maxMult,completed:C.completed})),y={level:S.level,prestigepoints:S.prestigepoints,prestigecount:S.prestigecount,GameComplete:S.GameComplete};let ke={version:cn(),playerStats:e,zoneData:t,currentRealm:r.currentRealm,cloneData:i,time:o,messageData:a,settings:d,routes:l,grindRoutes:r.grindRoutes,runeData:c,machines:u,realmData:h,prestigeData:y},je=JSON.stringify(ke);localStorage[oe]=LZString.compressToBase64(je)};function dn(){if(!localStorage[oe]||qt)return St();let n;try{n=JSON.parse(LZString.decompressFromBase64(localStorage[oe]))}catch{n=JSON.parse(atob(localStorage[oe]))}n.routes||(n.routes=JSON.parse(n.savedRoutes)),P.forEach(e=>e.current=0);for(let e=0;e<n.playerStats.length;e++){const t=g(n.playerStats[e].name);t&&(t.base=n.playerStats[e].base)}for(let e=0;e<n.messageData.length;e++){const t=b(n.messageData[e][0]);t&&(t.displayed=n.messageData[e][1])}for(r.clones=[];r.clones.length<n.cloneData.count;)Ne.addNewClone(!0);for(let e=0;e<n.zoneData.length;e++){const t=s.find(i=>i.name==n.zoneData[e].name);if(t===void 0)throw new Error(`No zone "${n.zoneData[e].name}" exists`);for(let i=0;i<n.zoneData[e].locations.length;i++){const o=t.getMapLocation(n.zoneData[e].locations[i][0],n.zoneData[e].locations[i][1],!0);if(o===null){console.warn(new Error("Tried loading non-existent map location"));continue}for(o.priorCompletionData=n.zoneData[e].locations[i][2];o.priorCompletionData.length<f.length;)o.priorCompletionData.push(0)}t.queues=ye.fromJSON(n.zoneData[e].queues),t.routes=ge.fromJSON(n.zoneData[e].routes),(n.zoneData[e].goal||n.zoneData[e].challenge)&&t.completeGoal()}for(let e=0;e<f.length;e++)r.currentRealm=e,f[e].machineCompletions=(n.machines||[])[e]||0,It();n.realmData?.forEach((e,t)=>{e.maxMult&&(f[t].maxMult=e.maxMult),e.completed&&f[t].complete()}),r.lastAction=n.time.saveTime,r.timeBanked=+n.time.timeBanked+Date.now()-r.lastAction,n.routes&&(r.routes=V.fromJSON(n.routes)),n.grindRoutes&&(r.grindRoutes=G.fromJSON(n.grindRoutes));for(let e=0;e<(n.runeData||[]).length;e++)z[e].upgradeCount=n.runeData[e].upgradeCount||0;for(let e=0;e<f.length;e++)st(f[e]);n.prestigeData===null?(S.level=0,S.prestigepoints=0,S.prestigecount=0,S.GameComplete=0):(S.level=n.prestigeData.level,S.prestigepoints=n.prestigeData.prestigepoints,S.prestigecount=n.prestigeData.prestigecount,S.GameComplete=n.prestigeData.GameComplete),wn(n.settings),s[0].queues[0].selected=!0,r.queuesNode=r.queuesNode||document.querySelector("#queues"),Q(),g("Attack").base=0,g("Defense").base=0,P.map(e=>e.update()),at(n.currentRealm),Re(),hn()}function hn(){d.debug_verticalBlocksJustify&&(document.querySelector(".vertical-blocks").style.justifyContent=d.debug_verticalBlocksJustify)}class V{actionCount=0;allDead;_cachedEstimate=0;cloneArriveTimes;cloneHealth;chronoMult=1;drainLoss=0;goldVaporized=[0,0];invalidateCost;hasAttempted=!1;loadingFailed=!1;log=null;manaDrain=0;needsNewEstimate=!0;noGrind=!1;realm;require;route;usedRoutes=null;x;y;zone;constructor(e){if(e instanceof ct){this.x=e.x,this.y=e.y,this.zone=r.currentZone,this.realm=r.currentRealm,this.actionCount=f[this.realm].name=="Compounding Realm"?r.loopCompletions:0,this.manaDrain=s[r.currentZone].manaDrain,this.log=A,this.goldVaporized=[this.log.goldVaporizedCount,this.log.goldVaporizedMana];let t=s[r.currentZone].queues.map(o=>Oe(o));if(t=t.filter(o=>o.length),t.every((o,a,l)=>o==l[0]))t=[t[0]];else{let o=t.find((l,c,u)=>u.filter(h=>h==l).length==1),a=t.find(l=>l!=o);t.every(l=>l==o||l==a)&&o&&a&&(t=[o,a])}this.route=t,this.cloneHealth=r.clones.map(o=>o.minHealth),this.require=s[r.currentZone].startStuff.map(o=>({name:o.name,count:Math.round((o.count-M(o.name).min)*1e3)/1e3})).filter(o=>o.count>0),this.cloneArriveTimes=r.clones.filter(o=>o.x==this.x&&o.y==this.y&&s[this.zone].queues[o.id].getNextAction()?.action==="I").map(o=>r.queueTime),oe==="saveGameII_separate"&&(this.cloneArriveTimes=[Math.min(...this.cloneArriveTimes)]),this.drainLoss=r.totalDrain,this.chronoMult=g("Chronomancy").value,this.allDead=!1,this.invalidateCost=!1,this.estimateRefineManaLeft();const i=s.slice(0,this.zone).map(o=>o.lastRoute?o.routes.find(a=>a.isSame(o.lastRoute)):null);i.every(o=>o)&&(this.usedRoutes=i);return}if(Object.assign(this,e),this.usedRoutes&&this.usedRoutes.length&&typeof this.usedRoutes[0]=="number"){const t=this.usedRoutes.flatMap(i=>s.map(o=>o.routes.find(a=>a.id==i)).filter(o=>o));t.every(i=>i)&&(this.usedRoutes=t)}}set cachedEstimate(e){this._cachedEstimate=e-be(this.zone,this.realm)}get cachedEstimate(){return this._cachedEstimate+be(this.zone,this.realm)}isSame(e){return e?JSON.stringify(e.route)==JSON.stringify(this.route)&&JSON.stringify(e.usedRoutes?.map(t=>t.id))==JSON.stringify(this.usedRoutes?.map(t=>t.id)):!1}pickRoute(e,t,i=r.clones.map(a=>0),o=this.actionCount){let a=s[e].sumRoute(t,i,o);if(e==0){if(a.length==0)return null;let l=g("Health"),c=a.find(u=>u[1].every(h=>h.count==0)&&u[2].every(h=>Math.abs(h)<l.base+sn(u[1])))||[];return c[0]?[c[0]]:null}for(let l=0;l<a.length;l++){let c=this.pickRoute(e-1,a[l][1],a[l][2],a[l][0].actionCount);if(c!==null)return a[l][0].noValidPrior=!1,[...c,a[l][0]];a[l][0].noValidPrior=!0}return null}loadRoute(e=!1,t=!1){e&&(d.grindStats&&Me(),d.grindMana&&Ae());let i=!0;if(this.zone>0){let o;if(this.usedRoutes&&this.usedRoutes.every((a,l)=>s[l].routes.some(c=>c.id==a.id))?o=this.usedRoutes:(o=this.pickRoute(this.zone-1,this.require,this.cloneHealth),_e(),this.usedRoutes=o),o!==null){for(let a=0;a<o.length;a++)o[a].loadRoute(s[a],!1);this.loadingFailed=!1}else i=!1,this.loadingFailed=!0}if(i||t){for(let o=0;o<s[this.zone].queues.length;o++)o==0||this.route.length==1?s[this.zone].queues[o].fromString(this.route[0]):this.route.length==2?s[this.zone].queues[o].fromString(this.route[1]):s[this.zone].queues[o].fromString(this.route[o]||this.route[this.route.length-1]||"");Q()}return i}updateRoute(){this.manaDrain=s[r.currentZone].manaDrain;let e=s[r.currentZone].queues.map(i=>Oe(i));if(e=e.filter(i=>i.length),this.log.goldVaporizedCount>this.goldVaporized[0]&&(this.needsNewEstimate=!0,this.goldVaporized=[this.log.goldVaporizedCount,this.log.goldVaporizedMana]),e.every((i,o,a)=>i==a[0]))e=[e[0]];else{let i=e.find((a,l,c)=>c.filter(u=>u==a).length==1),o=e.find(a=>a!=i);e.every(a=>a==i||a==o)&&i&&o&&(e=[i,o])}this.route=e,this.cloneHealth=r.clones.map(i=>i.minHealth),this.require=s[r.currentZone].startStuff.map(i=>({name:i.name,count:Math.round((i.count-M(i.name).min)*1e3)/1e3})).filter(i=>i.count>0);const t=r.clones.filter(i=>i.x==this.x&&i.y==this.y&&s[this.zone].queues[i.id].getNextAction()?.action==="I").length;for(;t>this.cloneArriveTimes.length&&oe!=="saveGameII_separate";)this.needsNewEstimate=!0,this.cloneArriveTimes.push(r.queueTime)}getRefineCost(e=0){let t=_(this.x,this.y,!0,this.zone);if(!t)return 1/0;let i=Z("Collect Mana").getBaseDuration(this.realm);return f[this.realm].name=="Compounding Realm"&&(i/=1+r.loopCompletions/40,i*=1+this.actionCount/40),$t(t,null,this.realm,t.completions+t.priorCompletionData[this.realm]+e)*i}getTotalRockTime(e=!1){const t=W("Verdant Realm")||1,i=be(this.zone,this.realm)+(e?this.goldVaporized[0]*fe*t:this.goldVaporized[1]),o=1+this.manaDrain*this.chronoMult;let a=this.cloneArriveTimes.reduce((u,h)=>u+(i-h/1e3),0)/o;a-=this.drainLoss*this.cloneArriveTimes.length;const l=Math.min(...this.cloneArriveTimes),c=this.cloneArriveTimes.reduce((u,h)=>u+(h-l),0);return a-=c/this.cloneArriveTimes.length*(this.manaDrain*this.chronoMult),a}estimateMagicAfterVaporizing(e){const t=g("Magic").base,i=f[this.realm].name=="Long Realm"?3:1,o=t+e*i*10/(100+t);return t+e*i*10/(100+o)}estimateRefineManaLeft(e=!1,t=!1,i=!1){if(!this.needsNewEstimate&&this.cachedEstimate)return!t&&this.invalidateCost?this.cachedEstimate+1e9:this.cachedEstimate;this.needsNewEstimate=!1;const o=this.getTotalRockTime(e),a=this.estimateMagicAfterVaporizing(this.goldVaporized[0]),l=a+o/10,c=this.getRefineCost(i?1:0)/(((a+l)/2+100)/100);let u=o-c;u/=this.cloneArriveTimes.length;const h=1+this.manaDrain*this.chronoMult;return u>0&&(u*=h),this.cachedEstimate=u,!t&&this.invalidateCost?u+1e9:u}estimateRefineTimes(){let e=0,t=this.estimateRefineManaLeft(!1,!0),i=this.getRefineCost(e);const o=be(this.zone,this.realm)+this.goldVaporized[1],a=this.cloneArriveTimes.reduce((h,y)=>h+(o-y/1e3),0)/(1+this.manaDrain/this.chronoMult),l=this.estimateMagicAfterVaporizing(this.goldVaporized[0]),c=l+a/10,u=1+(l+c)/200;for(;t+.1*e*(this.zone+1)>(this.getRefineCost(e)-i)*(1+this.manaDrain/this.chronoMult)/this.cloneArriveTimes.length/u;)e++;return e}static updateBestRoute(e,t=!1){if(e.baseType.name!=="Mana-infused Rock")return;const i=V.getBestRoute(e.x,e.y,r.currentZone);let o=r.currentRoutes.find(a=>a.x==e.x&&a.y==e.y&&a.zone==r.currentZone);if(o===void 0){if(o=new V(e),o.cloneArriveTimes.length==0)return;r.currentRoutes.push(o),i&&(i.needsNewEstimate=!0,i.estimateRefineManaLeft())}else o.updateRoute();if(!(i&&o&&!t&&!i.invalidateCost&&!o.needsNewEstimate)&&(t&&(o.hasAttempted=!1,i&&(i.hasAttempted=!1)),!((o==i||o.isSame(i)&&!t)&&!i?.invalidateCost&&!o.needsNewEstimate))){if(o.needsNewEstimate=!0,i){let a=o.estimateRefineManaLeft(!0,!1,t),l=i.estimateRefineManaLeft();if(a<l&&!(i.invalidateCost||t)&&i.route.join(",")!=o.route.join(","))return i;r.routes=r.routes.filter(c=>c!=i)}r.routes.push(o),r.routes=r.routes.filter((a,l)=>r.routes.findIndex(c=>c.x==a.x&&c.y==a.y&&c.zone==a.zone&&c.realm==a.realm)==l).map(a=>new V(a)),_e()}}static getBestRoute(e,t,i){return r.routes.find(o=>o.x==e&&o.y==t&&o.zone==i&&o.realm==r.currentRealm)}static migrate(e){return e&&(e.forEach(t=>{t.requirements&&(t.require=t.requirements,t.requirements=void 0),t.cloneArriveTimes||(t.cloneArriveTimes=[0]),s[t.zone].getMapLocation(t.x,t.y,!0)?.baseType.name!=="Mana-infused Rock"&&(t.discard=!0)}),e.filter(t=>!t.discard))}static fromJSON(e){return e=this.migrate(e),e.filter((t,i)=>e.findIndex(o=>o.x==t.x&&o.y==t.y&&o.zone==t.zone&&o.realm==t.realm)==i).map(t=>new V(t))}static loadBestRoute(){let e=r.routes.map(t=>t.realm!=r.currentRealm||t.allDead||t.noGrind?null:[t.estimateRefineManaLeft()+ +t.loadingFailed*-1e8,t]).filter(t=>t!==null).sort((t,i)=>t[1].hasAttempted&&!i[1].hasAttempted?1:!t[1].hasAttempted&&i[1].hasAttempted?-1:i[0]-t[0]);for(let t=0;t<e.length;t++)if(e[t][1].loadRoute())return}static invalidateRouteCosts(){r.routes.filter(e=>e.realm==r.currentRealm).forEach(e=>e.invalidateCost=!0)}static resetHasAttempted(){r.routes.filter(e=>e.realm==r.currentRealm).forEach(e=>e.hasAttempted=!1)}showOnLocationUI(){document.querySelector("#location-route").hidden=!1,document.querySelector("#route-has-route").hidden=!1,document.querySelector("#route-not-visited").hidden=!0;let e=this.estimateRefineManaLeft();const t=W("Verdant Realm")||1;let i=be(this.zone,this.realm)+this.goldVaporized[0]*fe*t-this.goldVaporized[1];if(document.querySelector("#route-best-time").innerText=v(i-e,1),document.querySelector("#route-best-mana-left").innerText=e>1e8?(e-1e9).toFixed(2):e.toFixed(2),document.querySelector("#route-best-unminable").hidden=e>=0,document.querySelector("#route-best-minable").hidden=e<0,e>0){let a=this.estimateRefineTimes();document.querySelector("#route-best-minable u").innerText=a.toString(),document.querySelector("#route-best-minable span").hidden=!1}document.querySelector("#route-best-invalidated").hidden=!this.invalidateCost,document.querySelector("#x-loc").value=this.x.toString(),document.querySelector("#y-loc").value=this.y.toString(),Lt(document.querySelector("#route-requirements"),this),document.querySelector("#failed-route").style.display=this.loadingFailed?"block":"none",document.querySelector("#dead-route").style.display=this.allDead?"block":"none",document.querySelector("#delete-route-button").onclick=this.deleteRoute.bind(this);const o=document.querySelector("#nogrind-button");o.onclick=this.setNoGrind.bind(this,o),this.noGrind?(o.classList.add("dontgrind"),o.innerHTML="Not grinding"):(o.classList.remove("dontgrind"),o.innerHTML="Grinding")}deleteRoute(){r.routes=r.routes.filter(e=>e!=this),we()}setNoGrind(e){this.noGrind=!this.noGrind,this.noGrind?(e.classList.add("dontgrind"),e.innerHTML="Not grinding"):(e.classList.remove("dontgrind"),e.innerHTML="Grinding")}}function rt(n,e,t){return r.routes.find(i=>i.x==n&&i.y==e&&i.zone==t&&i.realm==r.currentRealm)}const d={usingBankedTime:!0,running:!0,autoRestart:0,useWASD:!1,useDifferentBridges:!0,grindMana:!1,grindStats:!1,loadPrereqs:!1,warnings:!0,followZone:!0,timeline:!0,maxTotalTick:1e4,statGrindPerSec:!1,longWait:5e3,minStatGain:0,pauseOnPortal:!1};function $(n,e,...t){for(let i=0;i<99;i++){const o=n(...t);if(o===e)return o}return null}function Nt(){return d.usingBankedTime=!d.usingBankedTime,document.querySelector("#time-banked-toggle").innerHTML=d.usingBankedTime?"Using":"Banking",d.usingBankedTime}function ue(){return d.running=!d.running,document.querySelector("#running-toggle").innerHTML=d.running?"Running":"Paused",document.querySelector("#running-toggle").closest(".option").classList.toggle("option-highlighted",!d.running),document.title="Cavernous II"+(d.running?"":" - Paused"),d.running}var ne=(n=>(n[n.WaitAny=0]="WaitAny",n[n.RestartDone=1]="RestartDone",n[n.RestartAlways=2]="RestartAlways",n[n.WaitAll=3]="WaitAll",n))(ne||{});function Te(){const n=["Wait when any complete","Restart when complete","Restart always","Wait when all complete"];return d.autoRestart=(d.autoRestart+1)%n.length,document.querySelector("#auto-restart-toggle").innerHTML=n[d.autoRestart],document.querySelector("#auto-restart-toggle").closest(".option").classList.toggle("option-highlighted",d.autoRestart===0),d.autoRestart}function Ae(n){if(n?.ctrlKey||n?.metaKey){V.invalidateRouteCosts();return}return V.resetHasAttempted(),d.grindMana=!d.grindMana,document.querySelector("#grind-mana-toggle").innerHTML=d.grindMana?"Grinding mana rocks":"Not grinding mana rocks",document.querySelector("#grind-mana-toggle").closest(".option").classList.toggle("option-highlighted",d.grindMana),d.grindStats=!1,document.querySelector("#grind-stat-toggle").innerHTML="Not grinding stats",document.querySelector("#grind-stat-toggle").closest(".option").classList.remove("option-highlighted"),d.grindMana}function Me(){return d.grindStats=!d.grindStats,document.querySelector("#grind-stat-toggle").innerHTML=d.grindStats?"Grinding stats":"Not grinding stats",document.querySelector("#grind-stat-toggle").closest(".option").classList.toggle("option-highlighted",d.grindStats),d.grindMana=!1,document.querySelector("#grind-mana-toggle").innerHTML="Not grinding mana rocks",document.querySelector("#grind-mana-toggle").closest(".option").classList.remove("option-highlighted"),d.grindStats}function Dt(){return d.loadPrereqs=!d.loadPrereqs,document.querySelector("#load-prereq-toggle").innerHTML=d.loadPrereqs?"Load prereqs":"Load only zone route",d.loadPrereqs}function Zt(){return d.followZone=!d.followZone,document.querySelector("#follow-zone-toggle").innerHTML=d.followZone?"Follow on zone complete":"Stay on selected zone",d.followZone}function mn(){return d.timeline=!d.timeline,document.querySelector("#timeline-toggle").innerHTML=d.timeline?"Showing timeline":"Hiding timeline",document.querySelector("#timelines").hidden=!d.timeline,d.timeline}function pn(){return d.statGrindPerSec=!d.statGrindPerSec,document.querySelector("#stat-grind-per-sec").innerHTML=d.statGrindPerSec?"Stat grind strategy: Per sec":"Stat grind strategy: Total",d.statGrindPerSec}function fn(){return d.pauseOnPortal=!d.pauseOnPortal,document.querySelector("#pause-on-portal-toggle").innerHTML=d.pauseOnPortal?"Pause when entering a portal":"Do not pause on portal",d.pauseOnPortal}function gn(n){let e=+n.value;isNaN(e)||(d.maxTotalTick=Math.max(250,e||5e3)),n.value=d.maxTotalTick.toString()}function yn(n){let e=+n.value;isNaN(e)||(d.longWait=Math.max(100,e)),n.value=d.longWait.toString()}function vn(n){let e=+n.value;isNaN(e)||(d.minStatGain=Math.max(0,e)),n.value=d.minStatGain.toString()}function wn(n){$(Nt,n.usingBankedTime),$(ue,!!n.running),$(Te,n.autoRestart),n.grindMana&&$(Ae,!!n.grindMana),n.grindStats&&$(Me,!!n.grindStats),$(Dt,!!n.loadPrereqs),$(Zt,!!n.followZone),$(mn,!!n.timeline),$(pn,!!n.statGrindPerSec);const e=document.querySelector("#max-time");e&&gn(e);const t=document.querySelector("#long-wait");t&&yn(t);const i=document.querySelector("#min-stat-gain");i&&vn(i),Object.assign(d,n,d)}const mt={">Digit1":n=>D(0,n),">Digit2":n=>D(1,n),">Digit3":n=>D(2,n),">Digit4":n=>D(3,n),">Digit5":n=>D(4,n),">Digit6":n=>D(5,n),">Digit7":n=>D(6,n),">Digit8":n=>D(7,n),">Digit9":n=>D(8,n),"^>Digit1":n=>D(0,n),"^>Digit2":n=>D(1,n),"^>Digit3":n=>D(2,n),"^>Digit4":n=>D(3,n),"^>Digit5":n=>D(4,n),"^>Digit6":n=>D(5,n),"^>Digit7":n=>D(6,n),"^>Digit8":n=>D(7,n),"^>Digit9":n=>D(8,n),Tab:n=>{const e=s[r.currentZone].queues.findIndex(t=>t.selected);s[r.currentZone].queues.forEach((t,i)=>t.selected=i==(e+1)%r.clones.length),r.clones[s[r.currentZone].queues.findIndex(t=>t.selected)].writeStats(),n.stopPropagation()},">Tab":n=>{const e=s[r.currentZone].queues.findIndex(t=>t.selected);s[r.currentZone].queues.forEach((t,i)=>t.selected=e==(i+1)%r.clones.length),r.clones[s[r.currentZone].queues.findIndex(t=>t.selected)].writeStats(),n.stopPropagation()},Digit1:()=>O(0),Digit2:()=>O(1),Digit3:()=>O(2),Digit4:()=>O(3),Digit5:()=>O(4),Digit6:()=>O(5),Numpad1:()=>O(0),Numpad2:()=>O(1),Numpad3:()=>O(2),Numpad4:()=>O(3),Numpad5:()=>O(4),Numpad6:()=>O(5),Escape:()=>Pe(),Enter:()=>Pe(),Backspace:()=>R("B"),Delete:()=>R("b"),"^Backspace":()=>Bn(),"^KeyA":()=>s[r.currentZone].queues.forEach(n=>[n.selected,n.cursor]=[!0,null]),End:()=>s[r.displayZone].queues.forEach(n=>n.cursor=null),Home:()=>s[r.displayZone].queues.forEach(n=>n.cursor=-1)},pt={ArrowLeft:()=>R("L"),ArrowUp:()=>R("U"),ArrowRight:()=>R("R"),ArrowDown:()=>R("D"),Space:()=>R("I"),"^Space":()=>R("T"),Equal:()=>R("="),">Equal":()=>R("+"),NumpadAdd:()=>R("+"),Period:()=>R("."),Comma:()=>R(","),">Comma":()=>R("<"),">Semicolon":()=>R(":"),Semicolon:()=>R(":"),KeyP:()=>ue(),KeyB:()=>Nt(),KeyG:()=>Ae(),KeyZ:()=>Zt(),KeyL:()=>fn(),KeyQ:()=>Dt(),KeyW:()=>{d.useWASD?R("U"):Te()},KeyA:()=>{d.useWASD&&R("L")},KeyS:()=>{d.useWASD?R("D"):Me()},KeyD:()=>{d.useWASD&&R("R")},KeyR:()=>{g("Mana").base==5&&Pe(),ae()},KeyC:()=>{d.useWASD&&Te()},KeyT:()=>{d.useWASD&&Me()},"^ArrowLeft":()=>{s[r.displayZone].queues.forEach(n=>n.cursor===null||n.cursor--)},"^ArrowRight":()=>{s[r.displayZone].queues.forEach(n=>n.cursor===null||n.cursor++)},"^KeyW":()=>{if(!d.useWASD)return;let n=s[r.displayZone].queues;document.querySelectorAll(".selected-clone").forEach(e=>e.classList.remove("selected-clone"));for(let e=1;e<r.clones.length;e++)!n.some(t=>t.index==e-1)&&n.some(t=>t.index==e?t.index--+1/0:!1)&&([n[e],n[e-1]]=[n[e-1],n[e]]);n.forEach(e=>e.selected=!0),Q()},"^ArrowUp":()=>{let n=s[r.displayZone].queues;document.querySelectorAll(".selected-clone").forEach(e=>e.classList.remove("selected-clone"));for(let e=1;e<r.clones.length;e++)!n.some(t=>t.index==e-1)&&n.some(t=>t.index==e?t.index--+1/0:!1)&&([n[e],n[e-1]]=[n[e-1],n[e]]);n.forEach(e=>e.selected=!0),Q()},"^KeyS":()=>{if(!d.useWASD)return;let n=s[r.displayZone].queues;document.querySelectorAll(".selected-clone").forEach(e=>e.classList.remove("selected-clone"));for(let e=1;e<r.clones.length;e++)!n.some(t=>t.index==e-1)&&n.some(t=>t.index==e?t.index--+1/0:!1)&&([n[e],n[e-1]]=[n[e-1],n[e]]);n.forEach(e=>e.selected=!0),Q()},"^ArrowDown":()=>{let n=s[r.displayZone].queues;document.querySelectorAll(".selected-clone").forEach(e=>e.classList.remove("selected-clone"));for(let e=r.clones.length-2;e>=0;e--)!n.some(t=>t.index==e+1)&&n.some(t=>t.index==e?t.index+++1/0:!1)&&([n[e],n[e+1]]=[n[e+1],n[e]]);n.forEach(e=>e.selected=!0),Q()},KeyF:()=>{Be===null||He===null||(R(`P${Be}:${He};`),document.activeElement.blur())}};setTimeout(()=>{document.body.onkeydown=n=>{if(!document.querySelector("input:focus")){const e=`${n.ctrlKey||n.metaKey?"^":""}${n.shiftKey?">":""}${n.code}`;mt[e]&&(n.preventDefault(),mt[e](n)),pt[e]&&(n.preventDefault(),pt[e](n))}}},10);class K{name;originalMap;goalReward;goalComplete;map;yOffset;xOffset;mapLocations;manaGain;queues;routes;routesChanged;node;cacheManaGain;startStuff;index=0;lastRoute;startMana;zoneStartTime;manaDrain=0;constructor(e,t,i=null){for(this.name=e,this.originalMap=t,this.goalReward=i,this.goalComplete=!1,this.map=t.slice(),this.yOffset=t.findIndex(o=>o.includes(".")),this.xOffset=t[this.yOffset].indexOf("."),this.mapLocations=[],this.manaGain=0,this.queues=[],this.routes=[],this.routesChanged=!0,this.node=null,this.cacheManaGain=[0],this.startStuff=[],this.lastRoute=null,this.zoneStartTime=-1;this.mapLocations.length<t.length;)this.mapLocations.push([]);setTimeout(()=>{this.index=s.findIndex(o=>o==this)})}getMapLocation(e,t,i=!1){if(!i&&this.map[t+this.yOffset][e+this.xOffset]!="â–ˆ"&&(this.getMapLocation(e-1,t-1,!0),this.getMapLocation(e,t-1,!0),this.getMapLocation(e+1,t-1,!0),this.getMapLocation(e-1,t,!0),this.getMapLocation(e+1,t,!0),this.getMapLocation(e-1,t+1,!0),this.getMapLocation(e,t+1,!0),this.getMapLocation(e+1,t+1,!0)),e+=this.xOffset,t+=this.yOffset,e<0||e>=this.map[0].length||t<0||t>=this.map.length)return null;if(!this.mapLocations[t][e]){let o=this.map[t][e];this.mapLocations[t][e]=new ct(e-this.xOffset,t-this.yOffset,this,qe(o)),Le[o][2]?I.mapStain.push([e,t]):I.mapDirt.push([e,t])}return this.mapLocations[t][e]}getAdjLocations(e,t){return e+=this.xOffset,t+=this.yOffset,[[e-1,t],[e+1,t],[e,t+1],[e,t-1]].map(i=>{if(!(i[0]<0||i[0]>=this.map[0].length||i[1]<0||i[1]>=this.map.length))return[this.map[i[1]][i[0]],this.mapLocations[i[1]][i[0]]]}).filter(i=>i)}hasMapLocation(e,t){return this.mapLocations[t]&&this.mapLocations[t][e]!==void 0}resetZone(){this.map=this.originalMap.slice(),f[r.currentRealm].name=="Verdant Realm"&&(this.map=Cn(this.map,this.index)),this.goalComplete&&(this.map=this.map.map(t=>t.replace("âˆš","#")));let e=j("Compounding Realm").machineCompletions;for(let t=1;t<=9;t++)t>e&&(this.map=this.map.map(i=>i.replace(t.toString(),"â–ˆ")));this.mapLocations.forEach(t=>{t.forEach(i=>{i.reset()})}),this.zoneStartTime=-1,this.manaDrain=0}mineComplete(){let e;this.manaGain=+(this.manaGain+.1).toFixed(2);let t=g("Mana");t.base=+(t.base+.1).toFixed(2),t.current+=.1,this.cacheManaGain[r.currentRealm]+=.1,this.index&&s[this.index-1].mineComplete(),e=j("Verdant Realm"),f[r.currentRealm].name=="Verdant Realm"&&this.index==0&&e.mult!==null&&(e.mult+=5e-4),e=j("Compounding Realm"),f[r.currentRealm].name=="Compounding Realm"&&this.index==0&&e.mult!==null&&(e.mult+=.05,P.filter(i=>i.learnable&&i.base>=99+W("Compounding Realm")).forEach(i=>{i.dirty=!0,i.update(!0)})),this.display()}exitZone(e=!0){let t=!1;if(e){this.lastRoute=new ge(this);let i=this.routes.find(o=>o.isSame(this.lastRoute));if(i)i.mana=this.lastRoute.mana,i.mana,i.manaRequired=this.lastRoute.manaRequired,i.manaRequired,i.stuff=this.lastRoute.stuff,i.require=this.lastRoute.require,i.cloneHealth=this.lastRoute.cloneHealth;else if(!this.routes.some(o=>o.realm==r.currentRealm&&o.isBetter(this.lastRoute,this.manaGain))){this.routesChanged=!0;for(let o=0;o<this.routes.length;o++)this.routes[o].realm!=r.currentRealm||this.routes[o].isLocked||this.lastRoute.isBetter(this.routes[o],this.manaGain)&&(this.routes.splice(o,1),o--,t=!0);this.routes.push(this.lastRoute),t=!0}}t&&r.routes.forEach(i=>{i.realm==r.currentRealm&&i.zone>this.index&&(i.needsNewEstimate=!0)}),this.display(),A.moveZone(`z${this.index+1}`)}sumRoute(e,t,i){return this.routes.filter(a=>a.realm==r.currentRealm).filter(a=>{let l=(e||[]).map(c=>({name:c.name,count:c.count}));for(let c of l){let u=a.stuff.find(h=>h.name==c.name);if(!u||c.count>u.count)return!1}return!(i&&a.actionCount>i)}).map(a=>{let l=t.map((h,y)=>a.cloneHealth[y]===void 0?h:Math.max(h+a.cloneHealth[y][1],0)+a.cloneHealth[0][0]),c=a.mana+Math.floor(a.stuff.find(h=>h.name=="Gold Nugget")?.count||0)*(fe*W("Verdant Realm",!0)-1/r.clones.length);return[a,a.require,l,c]}).sort((a,l)=>i&&a[0].actionCount!=l[0].actionCount?a[0].actionCount-l[0].actionCount:l[3]-a[3])}enterZone(){this.display();let e=document.querySelector("#zone-select");if(e===null)throw new Error("No zone select found");let t=e.querySelector(".active-zone");t&&t.classList.remove("active-zone"),e.children[r.currentZone].classList.add("active-zone"),this.name=="Zone 2"&&b("Enter New Zone").display()&&d.running&&ue(),this.name=="Zone 7"&&b("Game Slowdown").display()&&d.running&&ue();let i=g("Mana");i.current+=this.manaGain,i.base+=this.manaGain,i.min=i.current,this.startMana=i.current,this.zoneStartTime=r.queueTime,Ht(),r.clones.forEach(o=>o.enterZone()),Q(),I.isDrawn=!1,this.getMapLocation(0,0),this.mapLocations.forEach((o,a)=>{o.forEach((l,c)=>{I.mapDirt.push([c,a])})}),this.startStuff=se.filter(o=>o.count>0).map(o=>(o.resetMin(),{name:o.name,count:o.count}))}display(){for(;this.queues.length<r.clones.length;){let e=new ye(this.queues.length);this.queues.push(e)}if(!this.node){const e=document.querySelector("#zone-template");if(e===null)throw new Error("No zone template found");this.node=e.cloneNode(!0),this.node.removeAttribute("id");let t=document.querySelector("#zone-select");if(t===null)throw new Error("No zone select found");t.appendChild(this.node)}if(r.currentZone==r.displayZone&&(document.querySelector("#zone-name").innerHTML=this.name,setTimeout(()=>we())),this.node.querySelector(".name").innerHTML=this.name,this.node.querySelector(".mana").innerHTML=`+${this.manaGain}`,this.node.onclick=()=>{document.querySelector("#zone-name").innerHTML=this.name,r.displayZone=s.findIndex(e=>e.name==this.name),Ot(),I.isDrawn=!1,I.mapDirt=[],I.mapStain=[],Re(),Q(),r.zoneTimeNode=r.zoneTimeNode||document.querySelector("#time-spent-zone"),this.zoneStartTime==-1?r.zoneTimeNode.innerText="0":r.zoneTimeNode.innerText=v(Math.max(0,(s[this.index+1]?.zoneStartTime+1||r.queueTime)-1-(this.zoneStartTime||0))/1e3,1)},this.routesChanged){let e=this.node.querySelector(".routes");if(e===null)throw new Error("Routes element not found");for(;e.lastChild;)e.removeChild(e.lastChild);let t=document.createElement("h4");t.innerHTML="Routes (click to load, ctrl-click here to clear unused game.routes):<br>Shift-click a route to prevent deletion.",t.onclick=this.clearRoutes.bind(this),e.appendChild(t);let i=document.querySelector("#zone-route-template");if(i===null)throw new Error("No route template found");e.style.display=this.routes.some(h=>h.realm==r.currentRealm)?"block":"none";let o=Rt();for(let h=0;h<this.routes.length;h++){if(this.routes[h].realm!=r.currentRealm)continue;let y=i.cloneNode(!0);y.removeAttribute("id"),this.routes[h].actionCount&&(y.querySelector(".actions").innerHTML=this.routes[h].actionCount.toString()+"&nbsp;"),y.querySelector(".mana").innerHTML=this.routes[h].mana.toFixed(2),Lt(y,this.routes[h]),y.onclick=ke=>{if(ke.shiftKey){this.routes[h].isLocked?(this.routes[h].isLocked=!1,y.querySelector(".delete-route-inner").innerHTML="x",y.querySelector(".delete-route-inner").onclick=this.deleteRoute.bind(this,h)):(this.routes[h].isLocked=!0,y.querySelector(".delete-route-inner").innerHTML="",y.querySelector(".delete-route-inner").onclick=()=>{});return}this.routes[h].loadRoute(this),e.querySelectorAll("div.active").forEach(je=>je.classList.remove("active")),y.classList.add("active")},y.title="",this.routes[h].isLocked?y.querySelector(".delete-route-inner").innerHTML="":y.querySelector(".delete-route-inner").onclick=this.deleteRoute.bind(this,h),o.includes(this.routes[h])||(y.classList.add("unused"),y.title+="This route is not used for any saved route. "),this.index>0&&!s[this.index-1].sumRoute(this.routes[h].require,this.routes[h].cloneHealth.map(ke=>ke[0]),this.routes[h].actionCount).length&&(y.classList.add("orphaned"),y.title+="This route has no valid predecessor. "),e.appendChild(y)}let a=document.createElement("h4");a.innerHTML="Legend:",e.appendChild(a);let l=document.createElement("h4");l.classList.add("route-legend"),l.classList.add("active"),l.innerHTML="Active",e.appendChild(l);let c=document.createElement("h4");c.classList.add("route-legend"),c.classList.add("unused"),c.innerHTML="Unused",e.appendChild(c);let u=document.createElement("h4");u.classList.add("route-legend"),u.classList.add("orphaned"),u.innerHTML="Orphaned",e.appendChild(u),this.routesChanged=!1}this.displaySelectedRoute()}displaySelectedRoute(){if(this.node===null)throw new Error("Missing display node");let e=this.node.querySelector(".routes");if(e===null)throw new Error("Routes element not found");e.querySelectorAll("div.active").forEach(i=>i.classList.remove("active"));let t=(this.queues+"").replace(/(^|,)(.*?),\2(,|$)/,"$1");this.routes.filter(i=>i.realm==r.currentRealm).forEach((i,o)=>{(i.route+"").replace(/(^|,)(.*?),\2(,|$)/,"$1")==t&&e.children[o+1]&&e.children[o+1].classList.add("active")})}clearRoutes(e){!e.ctrlKey&&!e.metaKey||d.warnings&&!confirm("Really delete unused game.routes?")||ln(this.index)}deleteRoute(e,t){this.routes.splice(e,1),_e(),this.display(),t.stopPropagation()}completeGoal(){this.goalComplete||this.goalReward===null||(this.goalComplete=!0,this.goalReward())}tick(e){if(this.mapLocations.forEach(t=>t.forEach(i=>i.zoneTick(e))),this.manaDrain){let t=e*this.manaDrain*g("Chronomancy").value;g("Mana").spendMana(t/1e3),A.addActionTime("Barrier Drain",this.index,t*r.clones.length),r.totalDrain+=t/1e3}}}function _e(){s.forEach(n=>n.routesChanged=!0)}function Et(n,e=!0){if(typeof n=="string"&&(n=s.findIndex(t=>t.name==n)),!s[n]){d.running=!1;return}s[r.currentZone].exitZone(e),r.currentZone==r.displayZone&&d.followZone&&(r.displayZone=n,Ot()),r.currentZone=n,document.querySelector("#barrier-mult").style.display="none",s[n].enterZone()}function It(){s.forEach(n=>n.manaGain=0),s.forEach((n,e)=>{n.manaGain=n.mapLocations.flat().filter(t=>t.type.name=="Mana-infused Rock").reduce((t,i)=>t+i.priorCompletions,0),n.manaGain/=10;for(let t=0;t<e;t++)s[t].manaGain+=n.manaGain}),s.forEach(n=>{n.manaGain=+n.manaGain.toFixed(2),n.queues&&n.mapLocations.some(e=>e.some(t=>t))&&n.display(),n.cacheManaGain[r.currentRealm]=n.manaGain})}const s=[new K("Zone 1",["â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ+##+â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ####% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ%â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ%â–ˆâ–ˆ#â–ˆ##%â–ˆÂ¢#â™ â™¥â–ˆâ–ˆâ–ˆâ–ˆÂ¤â–ˆ","â–ˆâ–ˆâ–ˆ###â–ˆâ–ˆâ–ˆÂ¤â–ˆâ–ˆ#â–ˆâ–ˆâ–ˆÂ¤â™£â–ˆâ•£â–ˆ","â–ˆâ–ˆ+â™ â–ˆâ–ˆâ–ˆâ–ˆ%â™ %â–ˆ#â•¬â–ˆâ–ˆâ–ˆ#â–ˆâ•£â–ˆ","â–ˆÂ¤â–ˆ+â–ˆâ–ˆ.###â™ =#âŽ¶â–ˆâ˜¼â–ˆ#â–ˆâ•£â–ˆ","â–ˆ%##â–ˆâ–ˆâ–ˆ#+â–ˆ#+##â–ˆ%##â–ˆâ•£â–ˆ","â–ˆâ–ˆâ–ˆ###â–ˆÂ¤â–ˆâ–ˆ##â–ˆâ™ â–ˆâ–ˆâ–ˆ+â–ˆâ•£â–ˆ","â–ˆâ–ˆâ–ˆ#â–ˆ#â–ˆâ–ˆÂ¤â™  â™ â–ˆ++â–ˆâ–ˆ#â–ˆâ•£â–ˆ","â–ˆ#  â–ˆ#â–ˆâ–ˆâ–ˆâ–ˆâ™ â™£â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ#â–ˆ3â–ˆ","â–ˆâ™ â–ˆâ–ˆâ–ˆ#â–ˆâ–ˆâ–ˆâ–ˆ+â™ â™£â™ â–ˆâ–ˆ  2#â–ˆ","â–ˆâ™ %â–ˆ#####+â–ˆâ–ˆâ–ˆâ™£1# â–ˆâ–ˆ#â–ˆ","â–ˆ#%â–ˆ+##â–ˆâ–ˆ#####â–ˆâ–ˆâ–ˆâ–ˆ##â–ˆ","â–ˆ#%â–ˆ##â™ #%â–ˆâ–ˆâ–ˆâ–ˆ Î˜â–ˆâ–ˆâ˜¼#+â–ˆ","â–ˆâ–ˆ%â–ˆâ–ˆâ–ˆ#â–ˆ#%#â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ+Â¤+â–ˆ","â–ˆÂ¤#Â¥â–ˆâ–ˆ++â–ˆâ–ˆ#Â£â–‘â•–âˆšâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"],()=>{b("Unlocked Duplication Rune").display(),x("Duplication").unlock()}),new K("Zone 2",["â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆÂ¥#Â¢â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ%â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ#+â–ˆ Â¤â–ˆ","â–ˆâ•–â—‹â–ˆ%#+â–ˆâ–ˆ+#â–ˆâ•¬#â–ˆâ–ˆ â–ˆâ–ˆ","â–ˆâ™£%â–ˆ%â–ˆÂ¤â–ˆâ–ˆ###%#%)+#â–ˆ","â–ˆâ™£â–ˆâ–ˆ%#Â«Â«â–ˆ%â–ˆ+â–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ¤â–ˆ","â–ˆÂ«â–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ«â–ˆâ–ˆâ–ˆ â–ˆ##â™¥â–ˆâ–ˆâ–ˆ","â–ˆÂ«~1+#â–ˆ%#â–ˆÂ¤#â–ˆ=â–ˆ#%â–ˆâ–ˆ","â–ˆâ•–â–ˆâ–ˆâ–ˆ#â–ˆâ–ˆ##â™ #####â–ˆâ–ˆâ–ˆ","â–ˆ++â–ˆ##%â–ˆ+â–ˆâ–ˆ.â–ˆâ–ˆâ–ˆ##â–ˆâ–ˆ","â–ˆâ–ˆÂ¤â–ˆ+#%â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ¤â–ˆâ–ˆ%#â–ˆ","â–ˆâ–ˆ2â–ˆâ–ˆâ–ˆ%Â«Â«Â«%+#â™£Â«Â«g#â–ˆ","â–ˆâ–ˆ#â–ˆ+â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ##â–ˆ","â–ˆ##â–ˆ+########âˆš#â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆcâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ###^â–ˆ","â–ˆâ—‹â—‹â–ˆâ–ˆÂ¤â–ˆ%â–ˆ###â–ˆâ–ˆâ–ˆâ–ˆ#â–ˆâ–ˆ","â–ˆâ–ˆÂ¤â–ˆÎ˜+Â«%#Â«â–ˆÂ«Â«Â«Â«Â«Â«â–ˆâ–ˆ","â–ˆâ–ˆ3â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆÂ«Â«â—‹â™£Â¤â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ—‹â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"],()=>{b("Unlocked Weaken Rune").display(),x("Weaken").unlock()}),new K("Zone 3",["â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆ+â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ%â–ˆ%%â–ˆâ–ˆâ–ˆ++â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆÂ«Â«Â«â–ˆâ–ˆâ–ˆâ–ˆÂ¤â–ˆâ–ˆ%+â–ˆÂ¤â–ˆ+â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆÂ¤+â–ˆÂ«+â–ˆÂ¤â–ˆ+%â–ˆ#+â–ˆ#â–ˆ|â–ˆâ–ˆâ–ˆ","â–ˆ+â–ˆâ–ˆ=Â«ggâŽ¶â–ˆgâ–ˆâ–ˆ##â–ˆsâ–ˆâ™£â–ˆâ–ˆâ–ˆ","â–ˆ%%â–ˆâ–ˆ.â–ˆâ–ˆâ–ˆâ–ˆâ™£â–£â–ˆ#â™¥â–ˆ#â–ˆ#â–ˆâ–ˆâ–ˆ","â–ˆâ™£%%%%â•¬â–ˆâ–ˆ+####â–ˆâ–ˆ#â–ˆ#â–ˆâ–ˆâ–ˆ","â–ˆâ™£â–ˆ â–ˆâ–ˆ[#â–ˆ+â–ˆâ–ˆâ–ˆ#(â–ˆ###3#â–ˆ","â–ˆ+â–ˆ â–ˆâ–ˆâ–ˆ~#%â–ˆ^â–ˆ#â–ˆâ–ˆâ–ˆ2â–ˆâ–ˆ#â–ˆ","â–ˆ###â–‘âˆšâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ™ â–ˆ#1   â–ˆâ˜¼â˜¼â–ˆ","â–ˆ+â–ˆâ–ˆâ–ˆ&+]â–ˆâ–ˆÎ˜c##â–ˆâ–ˆâ–ˆÂ«â–ˆâ–ˆÂ«â–ˆ","â–ˆ#â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ##â–ˆâ–ˆ#â–ˆ#+â–ˆÂ«Â«â˜¼â–ˆÂ¤â–ˆ","â–ˆ#â™ #%%â–ˆâ–ˆ+â–ˆ+#â–ˆâ–ˆ#â–ˆÂ«â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ#â–ˆâ–ˆ%â–ˆâ–ˆ#â–ˆâ–ˆâ–‘â–ˆ%%â–ˆÂ«Â«â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆ%#+â–ˆ%â—‹â–ˆ##â–ˆÂ¤â–ˆ%%â–ˆâ–‘â—‹â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ+Â¤â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ%â–ˆâ–ˆÂ¤Â£â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"],()=>{b("Unlocked Wither Rune").display(),x("Wither").unlock()}),new K("Zone 4",["â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆm++++++  Â¤â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆ3â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆÂ§Â§Â¤â–ˆ.â•–â•–âˆš++â–ˆÂ«â–ˆÂ«%Â«â–ˆ","â–ˆâ–ˆÂ§â–ˆâ–ˆâ–ˆÎ±â–ˆâ–ˆâ–ˆâ–ˆ+â–ˆÂ¤â–ˆ%Â«â–£â–ˆ","â–ˆâ–ˆÂ§â–ˆ+â–ˆâ•–â–ˆ++â–ˆâ–ˆâ–ˆ~â–ˆÂ«%%â–ˆ","â–ˆâ–ˆÂ§â–ˆÂ«Â«â™£Â«Â«â–ˆâ–ˆâ–ˆ+~â–ˆ%Â«Â«â–ˆ","â–ˆÂ§Â§â–ˆ=â–ˆÎ±â–ˆ%â–ˆÂ¤â–ˆÂ«â–ˆâ–ˆÂ«%Â«â–ˆ","â–ˆÂ§â–ˆâ–ˆâ–ˆâ–ˆÂ«â–ˆâ–ˆâ–ˆÂ«Â«Â«Â«+Â«â–ˆâ•–â–ˆ","â–ˆ2â–ˆâ–ˆ&+Â«â•–Â¤â–ˆâ–ˆÂ«â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ—‹â–ˆ","â–ˆ#|â–ˆâ–ˆâ–ˆÂ«â–ˆâ–ˆâ–ˆâŽ¶ â–ˆÂ«Î±Â«+Â«â–ˆ","â–ˆ#â–ˆâ–ˆ%Â«Â«â™£Â«Â«++â–ˆÎ±â–ˆ+â–ˆ{â–ˆ","â–ˆ%â–ˆâ–ˆâ—‹â–ˆâ–ˆÂ«â–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ«Î±â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆ%Â¤â–ˆâ–ˆâ–ˆÂ«Â«cÂ«Â«â–ˆâ–ˆâ–ˆÂ¤â–ˆâ•–Î˜â–ˆ","â–ˆ â–ˆâ–ˆâ•¬Â«Â«â–ˆâ–ˆâ–ˆâ•–Â«Â«â–ˆâ–ˆâ–ˆâ•–â–ˆâ–ˆ","â–ˆ â–ˆâ–ˆâ–ˆâ–ˆ}â–ˆ+â–ˆâ–ˆâ–ˆcâ–ˆÂ«Â«Â«â–ˆâ–ˆ","â–ˆ â–ˆâ–ˆ^â–ˆâ–ˆâ–ˆâ™ â™ â™ +Î±+Â«â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆ m1+++â™ â™ â–ˆâ–ˆâ–ˆâ–ˆÂ¤â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"],()=>{b("Other Realms").display(),f[0].unlock(),f[1].unlock()}),new K("Zone 5",["â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ++â–ˆ+#Â«Â«â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ¤~+â™£#++â–ˆÂ«â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆ%â–ˆ+â–ˆâ–ˆâ–ˆ++â–ˆâ–ˆâ–ˆâ–ˆ12 â–ˆâ–ˆâ–ˆ","â–ˆ+0.â•–â–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ«0â•–âˆšâ–ˆ â–ˆâ–ˆâ–ˆ","â–ˆ%â–ˆâ–ˆâ•–â–ˆ=â–ˆÂ¤â–ˆÂ«â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆÂ«Â«Â«Â«Â«Â«Â«â–ˆÂ¤â™ â–ˆ â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆÂ«Â«Â«Â«Â«Â«Â«Â«â–ˆâ–ˆâ–ˆâ™ â–ˆ â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆÂ«Â«Â«â–ˆ0Â«Â«Â«Â«Â«â™ â™ â–ˆ â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆÂ«Â«Â«â–ˆâ–ˆÂ«Â«Â«Â«Â«â–ˆ+â–ˆ â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆÂ«Â«Â«Â«Â«Â«Â«â–ˆâ–ˆÂ«â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ","â–ˆÂ«Â«Â«Â«Â«Â«â–ˆÂ«Â«â–ˆÂ«â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ","â–ˆÂ«â–ˆâ–ˆÂ«Â«Â«Â«Â«Â«Â«Â«+â–ˆâ–ˆ %%â–ˆ","â–ˆ+â–ˆ0Â«â–ˆâ–ˆâ–ˆÂ«Â«Â«â–ˆâ–ˆâ–ˆâ–ˆ%%%â–ˆ","â–ˆ%Â«â–ˆÂ«sÂ«â–ˆ+â–ˆâ–ˆâ–ˆâ–ˆÎ˜â–ˆ%%%â–ˆ","â–ˆâ–ˆÂ«â–ˆâ–ˆ0Â«â–ˆâ–ˆâ–ˆâ–ˆÂ«Â«â•–â–ˆÂ¤â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ+â–ˆâ–ˆâ–ˆsÂ«Â«Â«Â«Â«â–ˆâ–ˆâ–ˆ3â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ~~~Â¤â–ˆâ–ˆÂ¤â–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ¤Î´â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"],()=>{b("Further Realms").display(),f[2].unlock()}),new K("Zone 6",["â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆ%â–ˆâ–ˆâ•¬â–ˆ=â–ˆâ–ˆâ–ˆÂ¤â–ˆ%%+â–ˆ","â–ˆ%%â–ˆ%â–ˆ â–ˆâ–ˆ  â–ˆ%â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ %Â§%. â–ˆ â–ˆÂ§%Â§â–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆ%â–ˆâ–ˆâ•‘    â–ˆ%â–ˆâ–ˆ","â–ˆ+%Â§ % â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ%â™¥â–ˆ","â–ˆ%â–ˆ%â–ˆâ–ˆ â–ˆ%%%  â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ+%%â–ˆ%%Â§â–ˆâ–ˆâ–ˆ  +â–ˆ","â–ˆâ–ˆâ–ˆâ–ˆ%â–ˆâ–ˆâ–ˆ%%+â–ˆâ–ˆ +â–ˆ","â–ˆÂ§Â§Â§Â§â–ˆâ•£Î˜â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ","â–ˆ+â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ%%Â§ Â¤â–ˆ","â–ˆ%%â–ˆâ–ˆ  â–ˆÂ¤Â§â–ˆâ–ˆ%â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ++â–ˆ â–ˆâ–ˆâ–ˆâ•–â•–â•–%Â§Â§â–ˆ","â–ˆ+++â–ˆ     â–ˆâ–ˆâ–ˆâ–ˆ~â–ˆ","â–ˆâ–ˆâ–ˆâ•–â–ˆâ–ˆâ–ˆâ–ˆ ^â–ˆâ–ˆâ–ˆâ–ˆ~â–ˆ","â–ˆâ–ˆâ–ˆâ•–â•–â•–â•–~â•£â–ˆâ–ˆâˆšâ•£â•–~â–ˆ","â–ˆÂ¤â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ1â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ•–%>â–ˆ   ~â–ˆâ–ˆâ–ˆâ–ˆ+Â¤â–ˆ","â–ˆ%%â•–Â§ â–ˆâ–ˆâ–ˆâ–ˆ[â–ˆ++â–ˆâ–ˆ","â–ˆâ–ˆ%<â–ˆ2â–ˆâ•–  m+++â–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•–â•–â•–â–ˆâ–ˆ]â–ˆâ–ˆ3â–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ¤~â–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"],()=>{b("Unlocked Teleport Runes").display(),x("Teleport To").unlock(),x("Teleport From").unlock()}),new K("Zone 7",["â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆÂ«Â«Â«Â«Â«â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ¤â–ˆâ–ˆâ–ˆÂ¤â–ˆ","â–ˆ+â–ˆâ–ˆâ–ˆÂ«â–ˆâ˜¼â–ˆâ–ˆâ–ˆâ–ˆâ•¬â–ˆâ–ˆâ–ˆ â–ˆ","â–ˆ+Â«~~Â«Â«â™£â–ˆâ–ˆÂ¤â–ˆÂ§â•£%â–ˆ â–ˆ","â–ˆ++â–ˆâ–ˆâ–ˆâ–ˆÂ«â–ˆâ•–â•–â–ˆÂ§Â§â–ˆâ–ˆ%â–ˆ","â–ˆâ–ˆâ–ˆ Î˜â–ˆâ–ˆâ•–â•– â–ˆâ–ˆÂ§â•£%â–ˆ+â–ˆ","â–ˆâ–ˆm â–ˆâ–ˆâ˜¼â–ˆâ—‹Â§â–ˆâ–ˆÂ§â–ˆâ–ˆâ–ˆ3â–ˆ","â–ˆ^+â–ˆâ–ˆâ•–Â§â–ˆÂ§Â§Â§Â§Â§â•£(â–ˆÂ¤â–ˆ","â–ˆâ–ˆâ•–+Â¤mâ•–â•–.â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ}â–ˆ","â–ˆâ–ˆ+â–ˆâ–ˆâ•–Â§â–ˆâ™£â•–â–ˆâ–ˆâ–ˆâ•–=â–ˆ{â–ˆ","â–ˆâ–ˆâ•£â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•–â–ˆâ–£â•–â•–â–ˆâ–ˆâ™£â–ˆ","â–ˆ0~â•£â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•–â–ˆâ–ˆâ•–â–ˆâ–ˆâ–ˆ â–ˆ","â–ˆâ–ˆâ–ˆâ•£â–ˆâ–ˆâ˜¼â•–â•–â™£â™£â•–â™£â•–â–ˆâ–ˆ â–ˆ","â–ˆâ–ˆâˆšÂ§â–ˆâ–ˆâ–ˆâ•–â–ˆâ–ˆâ•–â–ˆâ–ˆâ•–â–ˆâ–ˆ â–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ+â•–â–ˆâ–ˆâ•–â–ˆâ–ˆâ•–+â–ˆ2â–ˆ","â–ˆâ–ˆ+â•–â•–â•–â™£â–ˆ+â•–â™£â•–+â–ˆ1â–ˆÂ¤â–ˆ","â–ˆâ–ˆâ–ˆâ–ˆ+â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ+â–ˆâ–ˆâ–ˆ â•–â•–â–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ)â–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"],()=>{b("Compounding Realm").display(),f[3].unlock()}),new K("Zone 8",["â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– â˜¼â– â–ˆâ– â– â– â– â–ˆ","â–ˆâ–ˆâ–ˆÂ§Â§Â¤â– Â§â˜¼Â§â–ˆ++â™¥â– â–ˆ","â–ˆâ–ˆâ–ˆGâ–ˆâ–ˆâ–ˆÂ§â– Â§â– â– â– â– â– â–ˆ","â–ˆâ–ˆ+^+â–ˆâ–ˆâ–ˆâ– â–ˆâ–ˆ++â– â– â–ˆ","â–ˆâ–ˆâ–ˆ2â–ˆâ–ˆâ–ˆÂ¤+=â–ˆâ– â– â– â–ˆâ–ˆ","â–ˆâ–ˆâ–ˆ2â–ˆâ–ˆâ–ˆâ–ˆ+â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆ+++â–ˆâ–ˆ#G#â–ˆÎ´3Î´â–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ– â–ˆâ–ˆâ–ˆâ™£.â™£123X!â–ˆ","â–ˆâ–ˆâ–ˆÎ´â–ˆâ–ˆâ–ˆâ– #â– â–ˆÎ´3Î´â–ˆâ–ˆ","â–ˆâ–ˆÂ¤â™£â–ˆâ–ˆâ–ˆÎ´Î´Î´â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆÎ´â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ+â•–â•–â•–â•– Â¤â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•£â–ˆâ–ˆâ– â–ˆâ–ˆ~â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâˆšâ– â–ˆâ•£â–ˆâ–ˆâ– â–ˆâ–ˆÎ´â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ– 1+â•–â•–â•–Î´Î´Î´â–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆÂ¤â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆ33â– â– â– ++++Â¤â–ˆâ–ˆâ–ˆ","â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"],()=>{b("Unlocked Pump Rune").display(),x("Pump").unlock()})];class he{name;icon;isInscribable;manaCost;description;createEvent;chargeEvent;activateAction;unlocked;upgradeCount;node;constructor(e,t,i,o,a,l,c,u){this.name=e,this.icon=t,this.isInscribable=i,this.manaCost=o,this.description=a,this.createEvent=l,this.chargeEvent=c,this.activateAction=u,this.unlocked=!1,this.upgradeCount=0,this.node=null}createNode(e){if(this.node){this.node.classList.remove("not-available"),this.node.style.order=`${e}`;return}let t=document.querySelector("#rune-template");if(t===null)throw new Error("No rune template found");this.node=t.cloneNode(!0),this.node.id="rune_"+this.name.replace(/\W/g,"_"),this.node.querySelector(".index").innerHTML=`${(e+1)%10}`,this.node.querySelector(".name").innerHTML=this.name,this.node.querySelector(".icon").innerHTML=this.icon,this.node.addEventListener("click",()=>{O(z.indexOf(this))}),document.querySelector("#runes")?.appendChild(this.node);let i=document.querySelector("#add-action-"+this.name.toLowerCase().replace(" ","-")).parentNode;i.classList.remove("hidden-action"),i.parentNode.classList.remove("hidden-action"),this.updateDescription()}notAvailable(){this.node&&this.node.classList.add("not-available")}canAddToQueue(){return!!this.node}create(e,t){if(s[r.currentZone].map[t+s[r.currentZone].yOffset][e+s[r.currentZone].xOffset]!=".")return!0;let i=_(e,t,!0);if(i===null)throw new Error("Can't create rune at location");return i.baseType.name=="Mana Spring"||i.baseType.name=="Mana-infused Rock"?!0:this.isInscribable()!=T.Now?!1:(i.setTemporaryPresent(this),B(e,t,this.icon),this.createEvent&&this.createEvent(i),!0)}unlock(){this.unlocked=!0,Pt()}updateDescription(){if(!this.node)return;let e=this.description(),t=e.match(/\{.*\}/);if(t){let i=JSON.parse(t[0].replace(/'/g,'"'));e=e.replace(/\{.*\}/,i[r.currentRealm]||i[0])}this.node.querySelector(".description").innerHTML=e}}function Pt(){for(let n=0;n<z.length;n++)z[n].unlocked?z[n].createNode(n):z[n].notAvailable()}function kn(n){n.getPresentAction()?.start(r.clones[0])}function bn(n){let e=n.x,t=n.y,i=[_(e-1,t,!0),_(e+1,t,!0),_(e,t-1,!0),_(e,t+1,!0)];for(let o of i)o&&o.creature&&(o.creature.attack=Math.max(o.creature.attack-1,0),o.creature.defense=Math.max(o.creature.defense-1,0))}function Sn(){for(let n=0;n<s[r.currentZone].map.length;n++)for(let e=0;e<s[r.currentZone].map[n].length;e++)if(s[r.currentZone].map[n][e]=="T"||s[r.currentZone].map[n][e]=="t")return T.Never;return T.Now}function x(n){return z.find(e=>e.name==n)}const z=[new he("Weaken","W",N([["Iron Bar",1],["Gold Nugget",1]]),0,()=>"This rune weakens any orthogonally adjacent enemies,  decreasing their attack and defense by 1.<br>Requires:<br>{'0':'1 Iron Bar<br>1 Gold Nugget', '1':'2 Iron Bars<br>2 Gold Nuggets'}",bn,null),new he("Wither","H",N([["Salt",1],["Iron Ore",1],["Gold Nugget",1]]),0,()=>`This rune allows you to kill even hardy orthogonally ${(x("Wither").upgradeCount||0)>0?"or diagonally ":""}adjacent plants.  Interact with it to charge it up - it takes ${(x("Wither").upgradeCount||0)>1?"1/"+2**(x("Wither").upgradeCount-1):""} as much Temporal to charge as the plants you're trying to kill would take to chop.<br>Requires:<br>{'0':'1 Salt<br>1 Iron Ore${j("Verdant Realm").completed||j("Verdant Realm").maxMult>1e307?"":"<br>1 Gold Nugget"}', '1':'2 Salt<br>2 Iron Ore${j("Verdant Realm").completed?"":"<br>2 Gold Nuggets"}'}`,null,null,"Charge Wither"),new he("Duplication","D",()=>T.Now,1e3,()=>`Mine more resources with this rune.  After placing it,  interact with it to charge it up.  You'll receive +${1+(x("Duplication").upgradeCount||0)*.25} of each (orthogonally or diagonally) adjacent resource (when mined), though each rune placed in a zone costs twice as much to charge as the last.`,kn,null,"Charge Duplication"),new he("Teleport To","T",Sn,0,()=>"This rune allows someone or something to come through from another place.  Only one can be placed,  and it must be charged after placement.  Use a pathfind action right after teleporting to fix the path prediction.",null,null,"Charge Teleport"),new he("Teleport From","F",N([["Iron Ore",2]]),1e3,()=>"This rune allows someone to slip beyond to another place.  Interact with it after inscribing it to activate it.<br>Requires:<br>{'0':'2 Iron Ore', '1':'4 Iron Ore'}",null,null,"Teleport"),new he("Pump","P",N([["Iron Bar",3],["Steel Bar",1]]),0,()=>"This rune drains water from surrounding spaces.  It drains log_2(Runic Lore) / 25 water per second from its space and a quarter that from the 4 adjacent spaces.<br>Requires:<br>{'0':'3 Iron Bars<br>1 Steel Bar', '1':'6 Iron Bars<br>2 Steel Bars'}",null,null,"Pump")];var S={level:0,prestigepoints:0,prestigecount:0,GameComplete:0};let Ye=!1;function ae(n=!1,e=!0){if(Ye)return;r.shouldReset=!1,Ye=!0;const t=g("Mana");b("Time Travel").display(s[0].manaGain==0&&f[r.currentRealm].name=="Core Realm"&&S.prestigecount==0)?$(Te,3):b("Persisted Programming").display(),t.base==5.5&&b("The Looping of Looping Loops").display()&&$(Te,1),t.base==6&&b("Strip Mining").display(),t.base==7.4&&b("Buy More Time").display(),r.routes.length==3&&b("All the known ways").display()&&$(Ae,!0),r.queueTime>5e4&&b("Looper's Log: Supplemental").display(),t.current>0&&A.finalize(),se.forEach(i=>{i.count=0}),P.forEach(i=>{i.reset(),i.update()}),d.grindMana&&r.routes.length&&!n&&V.loadBestRoute(),d.grindStats&&r.grindRoutes.length&&G.loadBestRoute(),se.forEach(i=>{i.count=0,i.update()}),r.clones.forEach(i=>i.reset()),r.queueTime=0,r.totalDrain=0,r.loopCompletions=0,lt.forEach(i=>{i.attack=i.creature.attack,i.defense=i.creature.defense,i.health=i.creature.health,i.drawHealth()}),s.forEach(i=>{i.resetZone(),(i.queues||[]).forEach(o=>o.reset())}),Pt(),Et(0,!1),g("Mana").dirty=!0,g("Mana").update(),Re(),e&&un(),we(),isNaN(r.timeBanked)&&(r.timeBanked=0),Ye=!1,r.currentRoutes=[]}class Ve{name;description;getMachineCount;activateMachine;extraDescription;multPerRock;locked=!0;node;index=-1;mult=null;machineCompletions=0;maxMult;completed=!1;constructor(e,t,i=null,o=null,a=null,l=0,c=1/0){this.name=e,this.description=t,this.getMachineCount=i??(()=>1/0),this.activateMachine=o||(()=>{}),this.extraDescription=a,this.multPerRock=l,this.node=null,this.maxMult=c,this.index=f.length,setTimeout(()=>{this.index=f.findIndex(u=>u==this)})}unlock(){this.locked=!1,this.display()}complete(){this.completed=!0,this.node?.parentNode?.removeChild(this.node),this.node=null,r.routes=r.routes.filter(e=>e.realm!==this.index),s.forEach(e=>e.routes=e.routes.filter(t=>t.realm!==this.index)),r.grindRoutes=r.grindRoutes.filter(e=>e.realm!==this.index)}display(){if(!this.node&&!this.completed){const e=document.querySelector("#realm-template");if(e===null)throw new Error("No realm template found");this.node=e.cloneNode(!0),this.node.removeAttribute("id"),this.node.querySelector(".name").innerHTML=this.name,this.node.querySelector(".description").innerHTML=this.description+'<div class="extra-description"></div>';let t=document.querySelector("#realm-select");if(t===null)throw new Error("No realm select found");t.appendChild(this.node),this.node.onclick=()=>{d.grindStats&&Me(),d.grindMana&&Ae(),at(this.index)},this.extraDescription&&(this.node.onmouseover=()=>{this.node.querySelector(".extra-description").innerHTML=this.extraDescription()})}}getNextActivateAmount(){return this.getMachineCount()==1?1:5*Math.pow(2,this.getMachineCount()-1)}}function at(n){if(f[n].completed)return;s.forEach(i=>i.resetZone()),ae(!0,!1),r.currentRealm=n,s.forEach(i=>i.routesChanged=!0),It(),z.forEach(i=>i.updateDescription());let e=document.querySelector("#realm-select");if(e===null)throw new Error("No realm select found");let t=e.querySelector(".active-realm");t&&t.classList.remove("active-realm"),f[n].node?.classList.add("active-realm"),document.querySelector("#queue-actions").style.display=r.currentRealm==3?"block":"none",ae()}function W(n,e=!1){const t=j(n);return(t.mult===void 0||t.mult===null||e)&&(t.mult=s.reduce((i,o)=>i+o.mapLocations.flat().filter(a=>a.type.name=="Mana-infused Rock").reduce((a,l)=>a+l.priorCompletionData[t.index],0),0)*t.multPerRock),Math.min(t.mult+1,t.maxMult)}function Tn(){return`Total multiplier: x${v(W("Verdant Realm",!0),4)}`}function Mn(){return`Stat slowdown start: ${v(99+W("Compounding Realm",!0),4)}`}function st(n){if(n.name=="Verdant Realm"){const e=x("Wither");(W(n.name,!0)===n.maxMult&&e.upgradeCount>=3||n.completed)&&(n.complete(),b("Complete Verdant").display(),e.upgradeCount=3,e.isInscribable=N([["Salt",1],["Iron Ore",1]]),e.updateDescription())}}const Ge={"#":"â™ ","âˆš":"â™ ","Â«":"â™£","â•–":"Î±","â•£":"Â§","â– ":"Î´"};function Cn(n,e){const t=j("Verdant Realm").maxMult===2;return n.map(i=>[...i].map(o=>e>6&&t?"â–ˆ":e==6&&o=="Î˜"&&t?"â™ ":Ge[o]||o).join(""))}const f=[];f.push(new Ve("Core Realm","Where you started.  Hopefully, how you'll leave this cave complex.",()=>r.clones.length-S.level,()=>Ne.addNewClone()));f.push(new Ve("Long Realm","A realm where everything takes thrice as long and costs twice as much (except bars and vaporizing gold).  It will help you slow down how quickly mana rocks become harder to mine.",()=>(x("Duplication").upgradeCount||0)+3,()=>{x("Duplication").upgradeCount++,x("Duplication").updateDescription(),b("Upgraded Duplication Rune").display(!0)}));f.push(new Ve("Verdant Realm","A realm where mushrooms have overgrown everything, and they grow five times as fast.  You'll learn how to get mana from gold more efficiently (0.05% per mana rock completion).",()=>(x("Wither").upgradeCount||0)>2?1/0:(x("Wither").upgradeCount||0)+3,()=>{x("Wither").upgradeCount++>=1&&b("Reupgraded Wither Rune").display(),x("Wither").updateDescription(),b("Upgraded Wither Rune").display()},Tn,5e-4,2));f.push(new Ve("Compounding Realm","A realm where things get harder the more you do.  Each movement action completed (including walking - and pathfinding doesn't save you on that) increases the amount of time each subsequent task will take by 2.5%.  You'll get better at learning from repeated tasks (stat slowdown will start 0.1 points later per mana rock completion and you'll gain base 0.1% faster).",()=>j("Compounding Realm").machineCompletions+2,()=>{j("Compounding Realm").machineCompletions++,b("Time Barriers").display()},Mn,.1));function j(n){let e=f.find(t=>t.name==n);if(e===void 0)throw new Error(`No realm with name "${n}" found`);return e}const Le={"â–ˆ":["wall","Solid Rock"],"Â¤":["mana","Mana-infused Rock",!0,(n,e,t)=>`${n} ${s[r.displayZone].mapLocations[t][e].type.nextCost(s[r.displayZone].mapLocations[t][e].completions,s[r.displayZone].mapLocations[t][e].priorCompletions,s[r.displayZone],e-s[r.displayZone].xOffset,t-s[r.displayZone].yOffset)}`],"*":["mined-mana","Mana Spring",!0,(n,e,t)=>`${n} ${s[r.displayZone].mapLocations[t][e].type.nextCost(s[r.displayZone].mapLocations[t][e].completions,s[r.displayZone].mapLocations[t][e].priorCompletions,s[r.displayZone],e-s[r.displayZone].xOffset,t-s[r.displayZone].yOffset)}`],".":["tunnel","Dug Tunnel"],"#":["limestone","Limestone"],"Â«":["travertine","Travertine"],"â•–":["granite","Granite"],"â•£":["basalt","Basalt"],"â– ":["chert","Chert"],"â™¥":["clone-machine","Strange Machine"],"+":["gold","Gold Ore"],"%":["iron","Iron Ore"],"â–‘":["salt","Salt"],"â•¬":["furnace","Furnace"],"â–£":["furnace2","Steel Furnace"],"=":["vaporizer","Vaporizer"],"âŽ¶":["bridge","Anvil - Bridge"],"&":["bridge2","Anvil - Upgrade Bridge"],"â•‘":["bridge3","Anvil - Long Bridge"]," ":["pit","Bottomless Pit"],"~":["lava","Bottomless Lava"],'"':["book","Book"],")":["sword","Anvil - Sword"],"[":["shield","Anvil - Shield"],"]":["armour","Anvil - Armour"],"(":["sword2","Anvil - Upgrade Sword"],"{":["shield2","Anvil - Upgrade Shield"],"}":["armour2","Anvil - Upgrade Armour"],"^":["fountain","Fountain"],W:["rune-weak","Weaken Rune"],H:["rune-wither","Wither Rune"],T:["rune-to","Teleport To Rune"],t:["rune-to-charged","Teleport To Rune"],F:["rune-from","Teleport From Rune"],D:["rune-dup","Duplication Rune"],d:["rune-dup-charged","Duplication Rune"],P:["rune-pump","Pump Rune"],"â—‹":["coal","Coal"],"â˜¼":["gem","Gem"],"Â©":["mined-gem","Gem Tunnel"],g:["goblin","Goblin"],c:["chieftain","Goblin Chieftain"],s:["skeleton","Skeleton"],m:["champion","Goblin Champion"],G:["golem","Golem"],X:["guardian","Guardian"],Î˜:["zone","Zone Portal"],"âˆš":["goal","Goal"],"â™ ":["mushroom","Mushroom"],"â™£":["kudzushroom","Kudzushroom"],Î±:["sporeshroom","Sporeshroom"],"Â§":["oystershroom","Oystershroom"],Î´:["springshroom","Springshroom"],"Â¢":["axe","Anvil - Axe"],"Â¥":["pick","Anvil - Pick"],"Â£":["hammer","Anvil - Hammer"],0:["spring","Spring"],"|":["sword3","Enchanter - Sword"],"<":["shield3","Enchanter - Shield"],">":["armour3","Enchanter - Armour"],1:["barrier","Timelike Barrier"],2:["barrier","Timelike Barrier"],3:["barrier","Timelike Barrier"],"!":["exit","Exit"]},We=11;setTimeout(()=>{Object.entries(Le).forEach(n=>{try{let e=qe(n[0]);e&&(n[1][1]=e)}catch{}})});const te='*.â™¥â•¬â–£=âŽ¶&â•‘"()[]{}^WHTtFDdPÂ¢Â¥Â£Â©Î˜|<>',L="â™ â™£Î±Â§Î´",I={mapDirt:[],mapStain:[],isDrawn:!1};let Be=null,He=null;function _(n,e,t=!1,i=null){return i!==null?s[i].getMapLocation(n,e,t):s[r.currentZone].getMapLocation(n,e,t)}function ce(){let n=document.querySelector("#map-inner");if(n===null)throw new Error("No map node");return n}let X=[];function An(){for(X=[];ce().firstChild;)ce().removeChild(ce().lastChild);let n=document.querySelector("#row-template");if(n===null)throw new Error("No row template");let e=document.querySelector("#cell-template");if(e===null)throw new Error("No cell template");for(let t=0;t<s[r.displayZone].map.length;t++){X[t]=[];let i=n.cloneNode(!0);if(i.removeAttribute("id"),ce().append(i),s[r.displayZone].mapLocations[t])for(let o=0;o<s[r.displayZone].map[t].length;o++){let a=e.cloneNode(!0);if(a.removeAttribute("id"),a.setAttribute("data-x",o.toString()),a.setAttribute("data-y",t.toString()),a.onmouseenter=()=>Zn(s[r.displayZone].mapLocations[t][o]),s[r.displayZone].mapLocations[t][o]){let[l,c,,u]=Le[s[r.displayZone].map[t][o]],h=l.split(" ");for(let y=0;y<h.length;y++)a.classList.add(h[y]);a.setAttribute("data-content",u?u(c,o,t):c),s[r.displayZone].mapLocations[t][o].water>.1&&a.classList.add(`watery-${Math.min(Math.floor(s[r.displayZone].mapLocations[t][o].water*10),We)}`)}else a.classList.add("blank");i.append(a),X[t][o]=a}}I.isDrawn=!0,Gt(),I.mapStain=[]}function ft(n,e){let t=(X[e]||[])[n];if(!t)return;let i=s[r.displayZone].mapLocations[e][n];if(!i)return;let[o,a,,l]=Le[s[r.displayZone].map[e][n]];t.className=o,i.water>.1&&t.classList.add(`watery-${Math.min(Math.floor(s[r.displayZone].mapLocations[e][n].water*10),We)}`),t.setAttribute("data-content",l?l(a,n,e):a)}function Re(){I.isDrawn||An(),r.currentZone==r.displayZone&&(I.mapDirt.forEach(([n,e])=>ft(n,e)),I.mapDirt=[],I.mapStain.forEach(([n,e])=>ft(n,e))),Ln(),Gt(),we(!0)}function Gt(){if(r.currentZone==r.displayZone)for(let n=0;n<r.clones.length;n++){let e=r.clones[n];e.occupiedNode&&e.occupiedNode.classList.remove("occupied");let t=X[e.y+s[r.displayZone].yOffset][e.x+s[r.displayZone].xOffset];t.classList.add("occupied"),e.occupiedNode=t}}function Ln(){let n=999,e=-999,t=999,i=-999;for(let l=0;l<s[r.displayZone].mapLocations.length;l++)for(let c=0;c<s[r.displayZone].mapLocations[l].length;c++)s[r.displayZone].mapLocations[l][c]&&(n=Math.min(n,c),e=Math.max(e,c),t=Math.min(t,l),i=Math.max(i,l));for(let l=0;l<X.length;l++)for(let c=0;c<X[l].length;c++){let u=X[l][c],h=n>c||c>e||t>l||l>i;u.hidden!=h&&(u.hidden=h)}let o=Math.max(e-n+1,i-t+1),a=Math.floor(440/o);ce().style.setProperty("--cell-count",o+"px"),ce().style.setProperty("--cell-size",a+"px")}function B(n,e,t){const i={"Â¤":"*","â˜¼":"Â©","#":".","â™ ":".",Î±:".","Â«":".","+":".","%":"."," ":".",g:".",G:".",X:".","â—‹":".",c:".","Â§":".",Î´:".",s:".",m:".","âˆš":".","â–‘":".","â•–":".","â•£":".","â– ":".",1:".",2:".",3:"."};n+=s[r.currentZone].xOffset,e+=s[r.currentZone].yOffset;let o=s[r.currentZone].map[e][n],a=t||i[o]||o;s[r.currentZone].map[e]=s[r.currentZone].map[e].slice(0,n)+a+s[r.currentZone].map[e].slice(n+1),a!==o&&I.mapDirt.push([n,e]),a=="*"&&b("Mana Extraction").display()}function Rn(n){let e=parseInt(n.dataset.x??"-1"),t=parseInt(n.dataset.y??"-1");ce()?.querySelector(".selected-map-cell")?.classList.remove("selected-map-cell"),n.classList.add("selected-map-cell");let i=[...n.classList].find(o=>o!=="occupied"&&o!=="final-location");if(s[r.displayZone].mapLocations[t]&&s[r.displayZone].mapLocations[t][e]){let o=s[r.displayZone].mapLocations[t][e];for(let a of Object.entries(Le))if(a[1][0]==i){let l=$e(qe(a[0])||"");if(l===void 0){console.warn(new Error("Failed to get location type"));continue}let c=l.presentAction||o.temporaryPresent||l.enterAction;document.querySelector("#location-name").innerHTML=l.name+(l.name=="Mana-infused Rock"||l.name=="Mana Spring"?` (${o.priorCompletions+o.completions})`:"");let u=l.description;if(u.includes("{STATS}")){let y=`Attack: ${o.creature?.attack}
Defense: ${o.creature?.defense}
Health: ${o.creature?.health}`;u=u.replace("{STATS}",y)}u.includes("{MANA_PER_GOLD}")&&(u=u.replace("{MANA_PER_GOLD}",v(fe*W("Verdant Realm",!0),4)));let h=u.match(/\{.*\}/);if(h){let y=JSON.parse(h[0].replace(/'/g,'"').replace(/""/g,"'"));u=u.replace(/\{.*\}/,y[r.currentRealm]||y[0]||"")}if(document.querySelector("#location-description").innerHTML=u.replace(/\n/g,"<br>"),l.nextCost)document.querySelector("#location-next").innerHTML=`Next: ${l.nextCost(o.completions,o.priorCompletions,o.zone,e-s[r.displayZone].xOffset,t-s[r.displayZone].yOffset)}`;else if(c){let y=c.getProjectedDuration(o,o.wither);document.querySelector("#location-next").innerHTML=`Time: ${v(y/1e3,2)}s`}else document.querySelector("#location-next").innerHTML="";if(o.water?document.querySelector("#location-water").innerHTML=`Water level: ${v(o.water,2)}`:document.querySelector("#location-water").innerHTML="",Be=e-s[r.displayZone].xOffset,He=t-s[r.displayZone].yOffset,l.name=="Mana-infused Rock"||l.name=="Mana Spring"){document.querySelector("#location-route").hidden=!0;let y=rt(Be,He,r.displayZone);y?y.showOnLocationUI():(document.querySelector("#route-has-route").hidden=!0,document.querySelector("#route-not-visited").hidden=!0)}else document.querySelector("#location-route").hidden=!0;return}}}function Wt(n,e){return X[e]&&X[e][n]}function xn(n,e){return Wt(n+s[r.displayZone].xOffset,e+s[r.displayZone].yOffset)}function qn(n,e){return s[r.displayZone].map[e]&&s[r.displayZone].map[e][n]}function Nn(n,e){return s[r.currentZone].map[e+s[r.currentZone].yOffset]&&s[r.currentZone].map[e+s[r.currentZone].yOffset][n+s[r.currentZone].xOffset]}function Dn(n){if(r.currentZone!=r.displayZone)return;let e=xn(n.x,n.y);e&&(n.health>0&&n.health<n.creature.health?e.innerHTML=`<div class="enemy-hp" style="width:${Math.floor(n.health/n.creature.health*100)}%"></div>`:e.innerHTML="")}function Zn(n){if(!n)return;let e;if(f[r.currentRealm].name=="Verdant Realm"&&Ge[n.baseType.symbol]){let t=qe(Ge[n.baseType.symbol]);t&&(e=$e(t)?.getEnterAction(n.entered))}if(!e){let t=n.baseType.getEnterAction(n.entered);e=t?.name=="Walk"&&(n.baseType.presentAction||n.temporaryPresent)||t}document.querySelectorAll(".relevant-stat").forEach(t=>t.classList.remove("relevant-stat")),e&&e.stats.forEach(t=>{document.querySelector(`#stat_${t[0].name.replace(" ","-")}`)?.classList.add("relevant-stat")})}class me{name;attack;defense;health;constructor(e,t,i,o){this.name=e,this.attack=t,this.defense=i,this.health=o}}let En=[new me("Goblin",5,0,12),new me("Goblin Chieftain",7,3,20),new me("Skeleton",5,5,50),new me("Goblin Champion",15,8,50),new me("Golem",15,15,50),new me("Guardian",25,20,100)];class In{creature;name;attack;defense;health;x;y;constructor(e,t,i){this.creature=e,this.name=e.name,this.attack=e.attack,this.defense=e.defense,this.health=e.health,this.x=t,this.y=i}drawHealth(){Dn(this)}}function Pn(n){return typeof n=="string"?En.find(e=>e.name==n):lt.find(e=>e.x==n[0]&&e.y==n[1])}let lt=[];class ct{x;y;zone;baseType;creature;priorCompletionData;completions;entered;temporaryPresent;wither;water;usedTime;activeEnter=null;activePresent=null;constructor(e,t,i,o){this.x=e,this.y=t,this.zone=i,this.baseType=$e(o);const a=Pn(o);a?(this.creature=new In(a,e,t),lt.push(this.creature)):this.creature=null,this.priorCompletionData=Array(f.length).fill(0),this.completions=0,this.entered=0,this.temporaryPresent=null,this.wither=0,this.water=this.type.startWater}get priorCompletions(){return this.priorCompletionData[r.currentRealm]}get type(){if(r.currentRealm===2){const e=Ge[this.baseType.symbol];if(e)return $e(qe(e)||"")||this.baseType}return this.baseType}getEnterAction(){this.activeEnter?.remainingDuration==0&&this.activeEnter.startingDuration>0&&(this.activeEnter=null);const e=this.type.getEnterAction(this.entered);return e==null?null:this.type.canWorkTogether&&e.name!="Walk"?(this.activeEnter===null&&(this.activeEnter=new re(e,this,!0)),this.activeEnter):new re(e,this,!0)}getPresentAction(){if(this.activePresent?.remainingDuration==0&&this.activePresent.startingDuration!=0&&(this.activePresent=null),this.type.canWorkTogether||this.temporaryPresent){if(this.activePresent!==null)return this.activePresent;if(this.type.presentAction)this.activePresent=new re(this.type.presentAction,this,!1);else if(this.temporaryPresent)this.activePresent=new re(this.temporaryPresent,this,!1);else return null;return this.activePresent}return this.type.presentAction?new re(this.type.presentAction,this,!1):null}setTemporaryPresent(e){return this.type.presentAction?!1:(this.temporaryPresent=Z(e.activateAction),!0)}reset(){this.priorCompletionData[r.currentRealm]=this.type.reset(this.completions,this.priorCompletions),this.completions=0,this.entered=0,this.temporaryPresent=null,this.wither=0,this.water=this.type.startWater,this.activeEnter=null,this.activePresent=null}zoneTick(e){if(this.temporaryPresent?.name=="Pump"){const t=Math.log2(g("Runic Lore").current)/25*e/1e3;this.water=Math.max(0,this.water-t),s[r.currentZone].getAdjLocations(this.x,this.y).forEach(([,i])=>{if(!i||!i.water)return;const o=Math.min(Math.floor(i.water*10),We);i.water=Math.max(0,i.water-t/4),o!==Math.min(Math.floor(i.water*10),We)&&I.mapDirt.push([i.x+s[r.currentZone].xOffset,i.y+s[r.currentZone].yOffset])})}this.water&&(this.baseType.name=="Springshroom"&&!this.entered&&(this.water=this.water+e/1e3*.2/(1+this.water)**2),s[r.currentZone].getAdjLocations(this.x,this.y).forEach(([t,i])=>{if(!i||!te.includes(t)&&!L.includes(t))return;const o=Math.floor(i.water*10);i.water=Math.min(Math.max(this.water,i.water),i.water+(this.water/158/(L.includes(t)?2:1))**2*e),o!=Math.floor(i.water*10)&&I.mapDirt.push([i.x+s[r.currentZone].xOffset,i.y+s[r.currentZone].yOffset])}))}}let Qe=0;class Ce{actionID;currentClone=null;currentAction=null;done=k.NotStarted;domNode=null;lastAttemptFailed=!1;lastProgress=0;isProgressQueued=!1;queue;constructor(e,t,i=!1){this.actionID=e,this.queue=t,i&&(this.done=k.Complete),this.drawProgress()}get started(){return this.node?.classList.contains("started")}get action(){return this.done==k.Complete?null:this.actionID=="T"?"I":this.actionID}get node(){return this.domNode?this.domNode:(this.domNode=Hn(this.actionID),this.done==k.Complete&&(this.domNode.classList.add("started"),this.domNode.style.backgroundSize="0%"),this.domNode)}drawProgress(){this.isProgressQueued||(this.isProgressQueued=!0,setTimeout(()=>{if(this.done==k.Started||this.done==k.Complete)if(this.node.classList.add("started"),this.currentAction){let e=1-this.currentAction.remainingDuration/this.currentAction.startingDuration;e*=100,this.node.style.backgroundSize=`${Math.max(0,e)}%`,e<this.lastProgress+100/(.5*60)?this.queue.displayActionProgress(e):this.queue.displayActionProgress(0),this.lastProgress=isNaN(e)?0:e}else this.node.style.backgroundSize="100%";else this.node.classList.remove("started"),this.node.style.backgroundSize="0%";this.isProgressQueued=!1}))}static fromJSON(e,t){return e=this.migrate(e),e[0]=="P"?new Bt(e,t):new Ce(e,t)}static migrate(e){return e}start(){if(this.currentClone||(this.currentClone=r.clones[this.queue.index]),this.done==k.Started||this.done==k.Complete)return;if(this.drawProgress(),!this.currentAction){if(!this.action)return this.complete();if("LURDI".includes(this.action)){const t=this.currentClone.x+ +(this.action=="R")-+(this.action=="L"),i=this.currentClone.y+ +(this.action=="D")-+(this.action=="U"),o=_(t,i),a=this.action=="I"?o?.getPresentAction():o?.getEnterAction();if(!a){this.done=k.Complete,this.lastAttemptFailed=!0;return}this.currentAction=a}else{const t=new ct(0,0,new K("Not a zone",["."]),"Not a location");if(this.currentAction=this.action=="."?new re(Z("Wait"),t,!1):this.action==","?new re(Z("Long Wait"),t,!1):null,!this.currentAction){if(this.action[0]=="N"){const i=this.action.match(/N(\d+);/)?.[1];if(!i)throw new Error(`Ill-formed rune action: ${this.action}`);z[+i].create(this.currentClone.x,this.currentClone.y)?(this.complete(),this.currentClone.addToTimeline({name:"Create rune"})):this.setWaiting();return}switch(this.action){case"=":this.currentClone.sync(),this.setWaiting(),this.currentClone.addToTimeline({name:"Sync"});break;case"+":this.currentClone.noSync(),this.complete();break;case"<":this.complete();break;case"W":this.setWaiting();break;default:throw new Error(`Unrecognized action: ${this.action}`)}return}}}const e=this.currentAction.start(this.currentClone);e==T.Now?this.done=k.Started:e==T.NotNow?this.setWaiting():e==T.Never&&(this.done=k.Complete)}tick(e){if(this.done==k.Started){if(!this.currentAction)throw new Error("Attempted to run uninitialized action");if(this.currentAction.remainingDuration==0){"LURD".includes(this.action)||this.actionID=="T"||this.currentAction.action.name=="Teleport"?(this.currentAction=null,this.done=k.NotStarted):this.done=k.Complete,this.drawProgress();return}if(this.currentAction.tick(e,this.currentClone),this.drawProgress(),this.currentClone.remainingTime=this.currentAction.remainingDuration,this.currentClone.addToTimeline(this.currentAction.action,e),this.currentAction.remainingDuration==0){const t=this.currentClone.x+ +(this.action=="R")-+(this.action=="L"),i=this.currentClone.y+ +(this.action=="D")-+(this.action=="U");if("LURD".includes(this.action)&&(t!=this.currentClone.x||i!=this.currentClone.y)&&!this.currentAction.moved&&".*Â©".includes(Nn(t,i))&&!["Walk","Kudzu Chop"].includes(this.currentAction.action.name)){r.loopCompletions--;const o=_(t,i),a=[];r.clones.forEach((l,c)=>{const u=s[r.currentZone].queues[c].getNextAction();if(!u||u.done==k.NotStarted)return;const h=l.x+ +(u.action=="R")-+(u.action=="L"),y=l.y+ +(u.action=="D")-+(u.action=="U");h==t&&y==i&&(u.currentAction=new re(Object.create(Z("Walk")),o,!0),u.currentAction.start(l),a.push(u.currentAction))}),a.length>1?a.forEach(l=>l.remainingDuration=l.remainingDuration*(a.length-1)/a.length):(this.currentAction.remainingDuration=0,this.currentAction.tick(0,this.currentClone),this.complete())}else this.action=="I"&&this.currentAction.location.type.canWorkTogether?r.clones.forEach((o,a)=>{const l=s[r.currentZone].queues[a].getNextAction();!l||l.done==k.NotStarted||o.x==t&&o.y==i&&l.action=="I"&&l.complete()}):this.complete()}this.drawProgress()}}complete(){this.currentAction?.remainingDuration===0&&(this.currentAction=null),this.done=this.actionID=="T"?k.NotStarted:k.Complete,this.done==k.Complete&&A.addQueueAction(this.currentClone.id,this.actionID),this.drawProgress()}setWaiting(){this.done=this.actionID=="T"?k.Complete:k.Waiting,this.done==k.Complete&&A.addQueueAction(this.currentClone.id,this.actionID),this.drawProgress()}reset(){this.done=k.NotStarted,this.lastAttemptFailed=!1,this.lastProgress=0,this.currentClone=null,this.currentAction=null,this.drawProgress()}toString(){return this.actionID}}class Bt extends Ce{targetXOffset;targetYOffset;cacheAction=null;constructor(e,t,i=!1){super(e,t,i);const o=this.actionID.match(/P(-?\d+):(-?\d+);/);if(o===null)throw new Error("Invalid pathfind action");let[a,l,c]=o;this.targetXOffset=+l,this.targetYOffset=+c}get targetX(){return this.targetXOffset+s[r.currentZone].xOffset}get targetY(){return this.targetYOffset+s[r.currentZone].yOffset}get action(){if(this.currentClone===null)throw new Error("Pathfind action not initialized");if(this.cacheAction)return this.cacheAction;if(this.done==k.Complete)return null;let e=this.currentClone.x+s[r.currentZone].xOffset,t=this.currentClone.y+s[r.currentZone].yOffset,i=(l,c,u,h)=>Math.abs(l-c)+Math.abs(u-h);if(i(e,this.targetX,t,this.targetY)==0)return this.done=k.Complete,A.addQueueAction(this.currentClone.id,this.actionID),this.drawProgress(),null;let o=[],a=[[t,e]];for(te.includes(s[r.currentZone].map[t-1][e])&&o.push([t-1,e,1,i(e,this.targetX,t-1,this.targetY),"U"]),te.includes(s[r.currentZone].map[t+1][e])&&o.push([t+1,e,1,i(e,this.targetX,t+1,this.targetY),"D"]),te.includes(s[r.currentZone].map[t][e-1])&&o.push([t,e-1,1,i(e-1,this.targetX,t,this.targetY),"L"]),te.includes(s[r.currentZone].map[t][e+1])&&o.push([t,e+1,1,i(e+1,this.targetX,t,this.targetY),"R"]);o.length>0;){let l=o.reduce((u,h)=>u<h[3]?u:h[3],1/0),c=o.splice(o.findIndex(u=>u[3]==l),1)[0];if(i(c[1],this.targetX,c[0],this.targetY)==0)return this.cacheAction=c[4],c[4];te.includes(s[r.currentZone].map[c[0]-1][c[1]])&&!a.find(u=>u[0]==c[0]-1&&u[1]==c[1])&&o.push([c[0]-1,c[1],c[2]+1,c[2]+i(c[1],this.targetX,c[0]-1,this.targetY),c[4]]),te.includes(s[r.currentZone].map[c[0]+1][c[1]])&&!a.find(u=>u[0]==c[0]+1&&u[1]==c[1])&&o.push([c[0]+1,c[1],c[2]+1,c[2]+i(c[1],this.targetX,c[0]+1,this.targetY),c[4]]),te.includes(s[r.currentZone].map[c[0]][c[1]-1])&&!a.find(u=>u[0]==c[0]&&u[1]==c[1]-1)&&o.push([c[0],c[1]-1,c[2]+1,c[2]+i(c[1]-1,this.targetX,c[0],this.targetY),c[4]]),te.includes(s[r.currentZone].map[c[0]][c[1]+1])&&!a.find(u=>u[0]==c[0]&&u[1]==c[1]+1)&&o.push([c[0],c[1]+1,c[2]+1,c[2]+i(c[1]+1,this.targetX,c[0],this.targetY),c[4]]),a.push([c[0],c[1]])}return"W"}complete(){this.cacheAction=null,this.currentAction=null,this.done!=k.Complete&&(this.done=k.NotStarted)}reset(){this.done=k.NotStarted,this.lastProgress=0,this.cacheAction=null,this.currentClone=null,this.currentAction=null,this.drawProgress()}}class ye extends Array{index;cursorPos=null;queueNode=null;cursorNode=null;progressNode=null;isScrolling=!1;constructor(e,...t){super(...t),this.index=e,t.forEach(i=>i.queue=this)}get cursor(){return this.cursorPos}set cursor(e){e!==null&&(e<-1&&(e=-1),e>this.length-2&&(e=null)),this.cursorPos=e,Tt(),!(!this.cursorNode&&(this.cursorNode=document.querySelector(`#queue${this.index} .cursor`),!this.cursorNode))&&(this.cursorPos===null?this.cursorNode.classList.remove("visible"):(this.cursorNode.classList.add("visible"),this.cursorNode.style.left=this.cursorPos*16+17+"px"))}get selected(){return r.clones[this.index].isSelected}set selected(e){this.selected!=e&&(this.cursor=null,r.clones[this.index].isSelected=e,Tt(),this.selected?this.node.parentElement.classList.add("selected-clone"):this.node.parentElement.classList.remove("selected-clone"),we())}static fromJSON(e){return e=this.migrate(e),e.map((t,i)=>{let o=new ye(i,...t.map(a=>Ce.fromJSON(a,null)));return o.index=i,o})}static migrate(e){return e}addAction(e){if(e=="b"&&this.cursor!==null&&(e="B",this.cursor++),e=="B")return this.removeAction();if(!e.match(/^([UDLRI<=+\.,:]|N\d+;|T|P-?\d+:-?\d+;)$/))return;let t=this.cursor==null?!1:this.cursor>=0?this[this.cursor+1].done:this[0].started,i=e[0]=="P"?new Bt(e,this,!!t):new Ce(e,this,!!t);this.cursor==null?(this.push(i),this.queueNode?.append(i.node)):this.cursor>=0?(this.splice(this.cursor+1,0,i),this[this.cursor].node.insertAdjacentElement("afterend",i.node),this.cursor++):(this.unshift(i),this.queueNode?.insertAdjacentElement("afterbegin",i.node),this.cursor++),this.scrollQueue()}removeAction(){if(this.cursor===null){const e=this.pop();if(e===void 0)return;e.node.remove()}else{if(this.length==0||this.cursor==-1)return;this.splice(this.cursor,1)[0].node.remove(),this.cursor--}}getNextAction(){if(r.clones[this.index].damage===1/0)return null;const e=this.find(t=>t.done!=k.Complete)||null;if(e===null){const t=this.findIndex(i=>i.actionID=="<");if(t>=0&&t<this.length-1){if(this.every((i,o)=>i.lastAttemptFailed||o<=t))return null;for(let i=t;i<this.length;i++)this[i].reset(),this[i].drawProgress();return r.clones[this.index].repeated=!0,this.getNextAction()}}return e}displayActionProgress(e){this.progressNode||(this.progressNode=this.node.parentNode?.querySelector(".work-progress")),this.progressNode&&(this.progressNode.style.width=e+"%")}hasFutureSync(){return this.some(e=>(e.done==k.NotStarted||e.done==k.Waiting)&&e.actionID=="=")}scrollQueue(){this.isScrolling||(this.isScrolling=!0,setTimeout(()=>{if(!Qe)return Wn(this.node);this.node.parentElement.scrollLeft=Math.max((this.cursor!==null?this.cursor:this.length)*16-Qe/2,0),this.isScrolling=!1}))}get node(){if(this.queueNode!==null)return this.queueNode;if(this.queueNode=document.querySelector(`#queue${this.index} > .queue-inner`),this.queueNode!==null)return this.queueNode;const e=document.querySelector("#queue-template");if(e===null)throw new Error("No queue template found");const t=e.cloneNode(!0);return t.id=`queue${this.index}`,document.querySelector("#queues").append(t),this.cursorNode=t.querySelector(".cursor"),this.queueNode=t.querySelector(".queue-inner"),this.queueNode}clear(){this.splice(0,this.length).forEach(e=>e.node.remove()),this.cursor=null,ut()}reset(){this.forEach(e=>e.reset())}fromString(e){this.clear();let t="",i="";for(let o of e){if(t&&"PN".includes(t)){if(i.length||(i=t),i+=o,o!=";")continue;this.addAction(i),i=""}else"PN".includes(o)||this.addAction(o);t=o}}toString(){return Array.from(this).join("")}}function D(n,e){let t;if(n instanceof HTMLElement)t=+n.id.replace("queue","");else if(t=n,s[r.displayZone].queues.length<=t)return;e.ctrlKey||e.metaKey?s[r.displayZone].queues[t].selected=!s[r.displayZone].queues[t].selected:s[r.displayZone].queues.forEach((i,o)=>i.selected=o==t),r.clones[s[r.currentZone].queues.findIndex(i=>i.selected)].writeStats()}function Gn(n){return+(n.match(/\d+/)?.[0]||0)}function Wn(n){Qe=n.parentElement.clientWidth}function R(n){s[r.displayZone].queues.filter(e=>e.selected).forEach(e=>e.addAction(n)),we(),ut()}function O(n){n<z.length&&z[n].canAddToQueue()&&R("N"+n+";")}function Bn(){d.warnings&&!confirm("Really clear selected queues?")||s[r.displayZone].queues.forEach(n=>n.selected?n.clear():null)}function Hn(n){const e=document.querySelector("#action-template");if(e===null)throw new Error("No action template found");let t=e.cloneNode(!0);t.removeAttribute("id");let i={L:Kt,R:Mt,U:Ut,D:Ft,I:_t,T:Qt,"<":Xt,"=":Jt,"+":en,".":"...",",":",,,",":":nn}[n];if(!i){let o=Gn(n);i=n[0]=="N"?z[o].icon:n[0]=="P"?tn:""}return t.querySelector(".character").innerHTML=i||"",t}function Ht(){s[r.currentZone].queues.forEach(n=>{n.forEach(e=>e.drawProgress()),n.scrollQueue()})}function ut(){r.queuesNode&&(r.queuesNode.querySelectorAll(".action-count").forEach(n=>{n.parentNode?.removeChild(n)}),s[r.displayZone].queues.forEach(n=>{const e=n.node;let t=e.children,i=0,o=null;for(let a=0;a<=n.length;a++){let l=n[a]?.actionID;if(i>3&&l!=o){let c=document.createElement("div");c.classList.add("action-count"),c.setAttribute("data-count",i.toString()),c.style.left=`${(a-i)*16+2}px`,c.style.width=`${i*16-2}px`,i>9&&c.classList.add("double-digit"),e.insertBefore(c,t[a-i]),i=0,o=null}".,I".includes(l)&&(o==l||o===null)?(i++,o=l):(i=0,o=null)}}))}function On(){[...r.queuesNode?.querySelectorAll(".work-progress")||[]].forEach(n=>n.style.width="0%")}function Q(){s[r.displayZone].queues.forEach(e=>{for(;e.node.lastChild;)e.node.removeChild(e.node.lastChild);for(let t of e){let i=t.node;e.node.append(i)}}),Ht(),ut();let n=document.querySelector("#timelines");if(n===null)throw new Error("Timelines node not found");for(;n.lastChild;)n.removeChild(n.lastChild);for(const e of r.clones)n.append(e.timeLineElements[r.displayZone]);On()}function Ot(n,e){s[r.currentZone].queues.forEach(t=>t.cursor=null)}function Oe(n){return n.toString()}function zt(n){if(!n&&(n=prompt("Input your queues"),!n))return;let e=JSON.stringify(s.map(t=>t.node?t.queues.map(i=>Oe(i)):"").filter(t=>t));try{let t;if(typeof n=="string")t=JSON.parse(n);else{t=[];for(let i=0;i<n[0].length;i++)t.push(n.map(o=>o[i]))}if(t.length>s.length||t.some(i=>i.length>r.clones.length)){alert("Could not import queues - too many queues.");return}t.forEach((i,o)=>{s[o].queues.map(a=>a.clear());for(let a=0;a<i.length;a++)s[o].queues[a].fromString(i[a])}),Q()}catch{alert("Could not import queues."),zt(e)}}class G{statName;totalStatGain;totalTime;projectedGain;realm;route;tried=!0;failed=!1;constructor(e,t=0){if(typeof e!="string"){Object.assign(this,e);return}this.statName=e,this.totalStatGain=t,this.totalTime=r.queueTime,this.projectedGain=G.calculateProjectedGain(this.statName,this.totalStatGain),g(e).learnable||(this.projectedGain=-1/0),this.realm=r.currentRealm,this.route=s.map(i=>i.node?i.queues.map(o=>o.toString()):"").filter(i=>i)}loadRoute(){this.realm!==r.currentRealm&&at(this.realm),this.route.forEach((e,t)=>{s[t].queues.map(i=>i.clear());for(let i=0;i<s[t].queues.length;i++)s[t].queues[i].fromString(e[i]||e[e.length-1])}),Q()}isLoaded(){return this.route.toString()===s.map(e=>e.node?e.queues.map(t=>t.toString()):"").filter(e=>e).toString()}static calculateProjectedGain(e,t){const i=99+W("Compounding Realm"),o=g(e),a=(o.base+t+1)**(.9*(o.base>i?i/o.base:1)**.05)-(o.base+1),l=(o.base+1)**(.9*(o.base>i?i/o.base:1)**.05)-(o.base+1);return a<0?0:(a-(l<0?0:l))/o.statIncreaseDivisor*(.99+W("Compounding Realm")/100)}static getBestRoute(e){return r.grindRoutes.find(t=>t.statName===e)}static updateBestRoute(e,t){if(e==="Mana"||!t)return;const i=G.getBestRoute(e);d.statGrindPerSec?!i||t/r.queueTime>i.totalStatGain/i.totalTime?(r.grindRoutes=r.grindRoutes.filter(o=>o.statName!==e),r.grindRoutes.push(new G(e,t||0))):i.projectedGain=G.calculateProjectedGain(i.statName,i.totalStatGain):!i||t>i.totalStatGain?(r.grindRoutes=r.grindRoutes.filter(o=>o.statName!==e),r.grindRoutes.push(new G(e,t||0))):i.projectedGain=G.calculateProjectedGain(i.statName,i.totalStatGain)}static migrate(e){return e}static fromJSON(e){return e=this.migrate(e),e.map(t=>new G(t)).filter(t=>g(t.statName).learnable)}static deleteRoute(e){const t=r.grindRoutes.findIndex(i=>i.statName===e);r.grindRoutes.splice(t,1)}static loadBestRoute(){if(!r.grindRoutes.length)return;let e=r.grindRoutes.filter(t=>t.projectedGain>d.minStatGain&&!t.failed).sort((t,i)=>i.projectedGain-t.projectedGain);e.some(t=>!t.tried)&&(e=e.filter(t=>t.tried)),e&&e.length&&(e[0].tried=!0,e[0].loadRoute())}static checkStatValue(){r.grindRoutes.forEach(e=>e.tried=!1)}static stopCheckingStatValue(){r.grindRoutes.forEach(e=>e.tried=!0)}}class ze{actions={};current=!0;goldVaporizedCount=0;goldVaporizedMana=0;kept=!1;stats;queues=[];manaMined=!1;node=null;zoneNames=["z1"];constructor(){this.stats=P.map(e=>({base:e.base,current:e.base}))}addQueueAction(e,t){for(;this.queues.length<=e;)this.queues.push([""]);this.queues[e][this.queues[e].length-1]+=t}moveZone(e){this.queues.length&&s[this.queues[0].length-1].queues.forEach((t,i)=>{const o=t.getNextAction();o&&this.addQueueAction(i,o.actionID)}),this.queues.forEach(t=>t.push("")),!(e==="Zone 1"||e==="z1")&&this.zoneNames.push(e)}addActionTime(e,t,i){for(this.actions[e]||(this.actions[e]=[]);this.actions[e].length<=t;)this.actions[e].push(0);this.actions[e][t]+=i}vaporizeGold(e,t){this.goldVaporizedCount+=e,this.goldVaporizedMana+=t}finalize(){if(Object.values(this.actions).reduce((t,i)=>t+i.reduce((o,a)=>o+a,0),0)<10){A=new ze;return}if(P.forEach((t,i)=>{this.stats[i].current=t.current-this.stats[i].current,this.stats[i].base=t.base-this.stats[i].base,G.updateBestRoute(t.name,this.stats[i].current)}),this.current=!1,A=new ze,ie.push(this),ie.forEach(t=>t.node=null),ie.filter(t=>!t.kept).length>zn){let t=!1;ie=ie.filter(i=>t||i.kept||(t=!0)&&!1)}ve===this&&this.display()}display(e=-1){pe.hidden=!1,ve=this,this.displayActions(e),this.displayStats(),this.displayHeader(e),Yn()}displayActions(e){const t=pe.querySelector("#loop-actions");for(;t.lastChild;)t.removeChild(t.lastChild);let i=Object.entries(this.actions);e===-1?i=i.sort((a,l)=>l[1].reduce((c,u)=>c+u,0)-a[1].reduce((c,u)=>c+u,0)):i=i.sort((a,l)=>(l[1][e]||0)-(a[1][e]||0));const o=Xe.cloneNode(!0);o.querySelector(".name").innerHTML="Total clone-seconds",o.querySelector(".value").innerHTML=v(i.filter(a=>!["Frost","Barrier Drain"].includes(a[0])).reduce((a,l)=>a+l[1].reduce((c,u)=>c+u,0),0)/1e3,1),o.style.fontWeight="bold",t.append(o);for(let a=0;a<i.length;a++){const l=(e===-1?i[a][1].reduce((u,h)=>u+h,0):i[a][1][e])/1e3;if(l===0||isNaN(l))continue;const c=Xe.cloneNode(!0);c.classList.add(i[a][0].replace(/ /g,"-")),c.querySelector(".name").innerHTML=i[a][0],c.querySelector(".value").innerHTML=v(l,1),t.append(c),c.querySelector(".description").innerHTML=`Relevant stats:<br>${Z(i[a][0])?.stats.map(u=>`${u[0].name}: ${u[1]}`).join("<br>")||""}`,c.style.color=an(window.getComputedStyle(c).backgroundColor)}+getComputedStyle(t).height.replace("px","")>+getComputedStyle(document.body).height.replace("px","")*.68?t.style.overflowY="auto":t.style.overflowY="unset"}displayStats(){const e=pe.querySelector("#loop-stats");for(;e.lastChild;)e.removeChild(e.lastChild);const t=Je.cloneNode(!0);t.querySelector(".name").innerHTML="Total stats gained",t.style.fontWeight="bold",e.append(t);let i=0;for(let o=0;o<this.stats.length;o++){if(!P[o].learnable||this.stats[o].current===0&&this!==A||this.stats[o].current===P[o].current||Object.keys(this.actions).length===0)continue;const a=Je.cloneNode(!0);a.querySelector(".name").innerHTML=P[o].name,this.current?(a.querySelector(".current-value").innerHTML=v(P[o].current-this.stats[o].current,3),a.querySelector(".base-value").innerHTML=v(P[o].base-this.stats[o].base,3),i+=P[o].base-this.stats[o].base):(a.querySelector(".current-value").innerHTML=v(this.stats[o].current,3),a.querySelector(".base-value").innerHTML=v(this.stats[o].base,3),i+=this.stats[o].base),e.append(a)}t.querySelector(".base-value").innerHTML=v(i,3)}displayHeader(e){$n.innerHTML=this.goldVaporizedCount.toString(),Vn.innerHTML=v(this.goldVaporizedMana,3),gt.style.display=this.current?"none":"inline-block",gt.onclick=()=>{zt(this.queues),ae()};const t=pe.querySelector("#loop-log-zones");for(;t.lastChild;)t.removeChild(t.lastChild);const i=this.queues[0]?.length||0;for(let o=-1;o<i;o++){const a=jn.cloneNode(!0);a.innerHTML=o<0?"All":this.zoneNames[o],o===e&&a.classList.add("active");const l=(c=>u=>{u.stopPropagation(),this.display(c)})(o);a.onmousedown=l,a.onmouseup=l,t.append(a)}}}let A=new ze,ie=[],ve=null;const pe=document.querySelector("#loop-log-box");if(pe===null)throw new Error("No loop log box found");const Xe=document.querySelector("#log-entry-template");Xe.removeAttribute("id");const Je=document.querySelector("#stat-log-entry-template");Je.removeAttribute("id");const et=document.querySelector("#previous-log-template");et.removeAttribute("id");const zn=10,$n=document.querySelector("#loop-gold-count"),Vn=document.querySelector("#loop-gold-value"),jn=document.querySelector("#loop-zone-template"),gt=document.querySelector("#load-loop-log");function Yn(){const n=pe.querySelector("#loop-prev-list");for(;n.lastChild;)n.removeChild(n.lastChild);A.node?A.node.querySelector(".value").innerHTML=v(Object.values(A.actions).reduce((e,t)=>e+t.reduce((i,o)=>i+o,0),0)/1e3,1)+" cs":(A.node=et.cloneNode(!0),A.node.querySelector(".pin").classList.add("disabled"),A.node.querySelector(".name").innerHTML="Current",A.node.querySelector(".value").innerHTML=v(Object.values(A.actions).reduce((e,t)=>e+t.reduce((i,o)=>i+o,0),0)/1e3,1)+" cs",A.node.onclick=e=>{ie.forEach(t=>t.node?.classList.remove("selected")),A.display(),e.stopPropagation()},ve===A&&A.node.classList.add("selected")),n.append(A.node);for(let e=ie.length-1;e>=0;e--){const t=ie[e];t.node||(t.node=et.cloneNode(!0),t.manaMined&&t.node.classList.add("mana-mined"),t.kept&&t.node.querySelector(".pin").classList.add("pinned"),t.node.querySelector(".pin").onmousedown=()=>t.kept=!t.kept,t.node.querySelector(".name").innerHTML="Previous",t.node.querySelector(".value").innerHTML=v(Object.values(t.actions).reduce((i,o)=>i+o.reduce((a,l)=>a+l,0),0)/1e3,1)+" cs",t.node.onclick=i=>{ie.forEach(o=>o.node?.classList.remove("selected")),A.node?.classList.remove("selected"),t.display(),i.stopPropagation()}),ve===t&&t.node.classList.add("selected"),n.append(t.node)}}const Un=5,Fn=5;let Kn=0;class re{action;appliedWither=0;id=Kn++;isMove;isStarted=!1;location;moved=!1;remainingDuration;startingDuration;constructor(e,t,i){this.action=e,this.location=t,this.isMove=i,this.startingDuration=this.remainingDuration=0}get expectedLeft(){const e=this.action.getSkillDiv();return this.remainingDuration*e}start(e){if(this.isStarted)return T.Now;const t=this.action.attemptStart(this.location,e);return t==T.Now&&this.remainingDuration==0&&(this.startingDuration=this.remainingDuration=this.action.getDuration(this.location,e)),t==T.Now&&(this.isStarted=!0),t}tick(e,t){this.remainingDuration=Math.max(0,this.remainingDuration+this.appliedWither-this.location.wither),this.appliedWither=this.location.wither;const i=this.action.getSkillDiv();let o=Math.min(e/i,this.remainingDuration);this.action.tick(o,this.location,o*i,t),this.remainingDuration-=o,this.remainingDuration==0&&(this.isStarted=!1,this.action.complete(this.location,t,this)?this.start(t):this.isMove?(r.loopCompletions++,this.location.entered++):this.location.completions++),o*=i}}class p{name;baseDuration;stats;complete;attemptStart;tickExtra;specialDuration;constructor(e,t,i,o,a=null,l=null,c=()=>1){this.name=e,this.baseDuration=t,this.stats=i.map(u=>[g(u[0]),u[1]]),this.complete=o||(()=>{}),this.attemptStart=a||(()=>T.Now),this.tickExtra=l,this.specialDuration=c}tick(e,t,i=0,o){for(let a=0;a<this.stats.length;a++)this.stats[a][0].gainSkill(i/1e3*this.stats[a][1]*(1+.1*S.level));this.tickExtra&&this.tickExtra(e,t,i,o)}getDuration(e,t){let i=(typeof this.baseDuration=="function"?this.baseDuration():this.baseDuration)*this.specialDuration(e,t);return f[r.currentRealm].name=="Long Realm"?i*=3:f[r.currentRealm].name=="Compounding Realm"&&(i*=1+r.loopCompletions/40),i}getBaseDuration(e=r.currentRealm){let t=(typeof this.baseDuration=="function"?this.baseDuration():this.baseDuration)/1e3;return f[e].name=="Long Realm"?t*=3:f[e].name=="Compounding Realm"&&(t*=1+r.loopCompletions/40),t}getProjectedDuration(e,t=0,i=0){let o;return i>0?o=i:(o=(typeof this.baseDuration=="function"?this.baseDuration():this.baseDuration)*this.specialDuration(e),o-=t),o*=this.getSkillDiv(),i||(f[r.currentRealm].name=="Long Realm"?o*=3:f[r.currentRealm].name=="Compounding Realm"&&(o*=1+r.loopCompletions/40)),o}increaseStat(e,t){const i=this.stats.findIndex(o=>o[0].name==e);i==-1?this.stats.push([g(e),t]):this.stats[i][1]+=t}getSkillDiv(){if(this.name=="Wait"||this.name=="Long Wait")return 1;let e=1;for(let t=0;t<this.stats.length;t++)e*=Math.pow(this.stats[t][0].value,this.stats[t][1]);return e}}function tt(n,e,t){e.x=n.x,e.y=n.y,B(n.x,n.y),t.moved=!0}function ee(n){B(n.x,n.y),b("Digging").display()}function xe(n){let e=n.x,t=n.y,i=Math.round((1+.1*S.level)*1e3)/1e3;const o=s[r.currentZone];return e+=o.xOffset,t+=o.yOffset,[[e-1,t],[e+1,t],[e,t-1],[e,t+1],[e-1,t+1],[e+1,t+1],[e+1,t-1],[e-1,t-1]].forEach(([l,c])=>{i+=+(o.map[c][l]=="d")*Math.round((1+x("Duplication").upgradeCount*.25)*(1+.1*S.level)*1e3)/1e3}),i}function _n(n){const e=M("Gold Nugget");e.update(xe(n)),e.count>=5&&b("Mass Manufacturing").display(),B(n.x,n.y)}function Qn(n){M("Iron Ore").update(xe(n)),B(n.x,n.y)}function Xn(n){M("Coal").update(xe(n)),B(n.x,n.y)}function Jn(n){M("Salt").update(xe(n)),B(n.x,n.y)}function ei(n){if(V.updateBestRoute(n,!0),s[r.currentZone].mineComplete(),f[r.currentRealm].name==="Long Realm"&&r.routes.forEach(e=>{e.zone!==n.zone.index||e.x!==n.x||e.y!==n.y||(e.needsNewEstimate=!0)}),d.autoRestart==ne.RestartDone&&d.grindMana){const e=r.currentRoutes.find(t=>t.x==n.x&&t.y==n.y&&t.zone==r.currentZone);(!e||e.estimateRefineManaLeft()<0)&&(r.shouldReset=!0)}st(f[r.currentRealm])}function ti(n,e){V.updateBestRoute(e)}function ni(n,e,t){if(n===void 0||e===void 0)return 1;const i=s[t].getMapLocation(n,e,!0);if(i===null)throw new Error("Location not found");return .99**i.priorCompletionData[1]**.75}function ii(n){return T.Now}function $t(n,e=null,t=null,i){const o=1+(.1+.05*(n.zone.index+(t??r.currentRealm)))*ni(n.x,n.y,n.zone.index)*.95**S.level**.75;return n.completions&&!i?Math.pow(o,n.priorCompletions+n.completions)-Math.pow(o,n.priorCompletions+n.completions-1):Math.pow(o,i??n.priorCompletions)}function oi(n){return(n.completions+1)**1.4}function ri(n){M("Gem").update(xe(n))}function ai(){const n=M("Gold Nugget"),e=f[r.currentRealm].getNextActivateAmount();return n.count>=e?T.Now:T.NotNow}function si(){const n=M("Gold Nugget"),e=f[r.currentRealm].getNextActivateAmount();n.update(-e),f[r.currentRealm].activateMachine(),st(f[r.currentRealm])}function E(n){function e(){for(let t=0;t<n.length;t++)M(n[t][0]).update(n[t][1])}return e}function N(n,e=!1){function t(){const i=f[r.currentRealm].name=="Long Realm"&&!e?2:1;for(let o=0;o<n.length;o++)if(M(n[o][0]).count<n[o][1]*(n[o][0].match(/Armour|Sword|Shield|Bridge/)?1:i))return T.NotNow;for(let o=0;o<n.length;o++)M(n[o][0]).update(-n[o][1]*(n[o][0].match(/Armour|Sword|Shield|Bridge/)?1:i));return T.Now}return t}function Ue(n,e){function t(){return se.reduce((a,l)=>a+(l.name.includes(e)?l.count:0),0)>=r.clones.length?T.Never:N(n)()==T.NotNow?T.NotNow:T.Now}return t}function yt(){return M("Iron Bridge").count||M("Steel Bridge").count?T.Now:T.NotNow}function li(){const n=W("Verdant Realm")||1;return g("Mana").current+=fe*n,A.vaporizeGold(1,fe*n),!1}function ci(n){let e=M("Iron Bridge");return e.count<1&&(e=M("Steel Bridge"),e.count<1||!d.useDifferentBridges)?!0:(e.update(-1),B(n.x,n.y),!1)}function ui(n,e,t){let i=M("Steel Bridge");if(i.count<1){if(i=M("Iron Bridge"),i.count<1||!d.useDifferentBridges)return!0;i.update(-1),tt(n,e,t),b("Lava Can't Melt Steel Bridges").display();return}return i.update(-1),B(n.x,n.y,"."),n.entered=1/0,!1}function di(n,e,t,i){if(!e.creature)throw new Error("No creature to fight");let o=Math.max(e.creature.attack-g("Defense").current,0)*t/1e3;e.creature.defense>=g("Attack").current&&e.creature.attack<=Math.ceil(g("Defense").current)&&(o=t/1e3),i.inCombat=!0,Vt(o,i)}function Vt(n,e){const t=r.clones.filter(i=>i.x==e.x&&i.y==e.y&&i.damage<1/0);t.forEach(i=>{i.takeDamage(n/t.length)})}let Ee=[[M("Iron Axe"),.01*1,g("Woodcutting")],[M("Iron Pick"),.01*1,g("Mining")],[M("Iron Hammer"),.01*1,g("Smithing")]];function hi(){let n=1;for(let e=0;e<Ee.length;e++)n*=Math.pow(Ee[e][2].value,Ee[e][1]*Ee[e][0].count);return n}function mi(n){const e=g("Attack").current,t=n.creature;if(!t)throw new Error("No creature to fight");return t.health&&(t.health=Math.max(t.health-Math.max(e-t.defense,0),0),t.drawHealth()),t.health?!0:(r.clones.forEach(i=>{i.inCombat=!1}),B(n.x,n.y),!1)}function pi(n,e){return e.inCombat?T.Never:T.Now}function fi(n,e,t,i){i.takeDamage(-n/1e3)}function gi(n,e){return e.damage>0}function yi(n,e=null){return e?Math.max(e.damage*g("Runic Lore").value,.01):1}function vi(){for(let n=0;n<s[r.currentZone].map.length;n++)for(let e=0;e<s[r.currentZone].map[n].length;e++)if(s[r.currentZone].map[n][e]=="t")return T.Never;return T.Now}function wi(){for(let n=0;n<s[r.currentZone].map.length;n++)for(let e=0;e<s[r.currentZone].map[n].length;e++)if(s[r.currentZone].map[n][e]=="t")return T.Now;return T.NotNow}function ki(n,e){for(let t=0;t<s[r.currentZone].map.length;t++)for(let i=0;i<s[r.currentZone].map[t].length;i++)if(s[r.currentZone].map[t][i]=="t"){e.x=i-s[r.currentZone].xOffset,e.y=t-s[r.currentZone].yOffset;return}}function bi(){for(let n=0;n<s[r.currentZone].map.length;n++)for(let e=0;e<s[r.currentZone].map[n].length;e++)if(s[r.currentZone].map[n][e]=="t")return 1;return 1/0}function Si(n){return n.completions>0?T.Never:T.Now}function Ti(){let n=0;for(let e=0;e<s[r.currentZone].map.length;e++)n+=s[r.currentZone].map[e].split(/[dD]/).length-1;return 2**(n-1)}function vt(n){B(n.x,n.y,s[r.currentZone].map[n.y+s[r.currentZone].yOffset][n.x+s[r.currentZone].xOffset].toLowerCase())}function Mi(n,e){let t=e.x+s[r.currentZone].xOffset,i=e.y+s[r.currentZone].yOffset;const o=x("Wither"),a=[L.includes(s[r.currentZone].map[i-1][t])?s[r.currentZone].mapLocations[i-1][t]:null,L.includes(s[r.currentZone].map[i][t-1])?s[r.currentZone].mapLocations[i][t-1]:null,L.includes(s[r.currentZone].map[i+1][t])?s[r.currentZone].mapLocations[i+1][t]:null,L.includes(s[r.currentZone].map[i][t+1])?s[r.currentZone].mapLocations[i][t+1]:null].filter(l=>l!==null);o.upgradeCount>0&&a.push(...[L.includes(s[r.currentZone].map[i-1][t-1])?s[r.currentZone].mapLocations[i-1][t-1]:null,L.includes(s[r.currentZone].map[i+1][t-1])?s[r.currentZone].mapLocations[i+1][t-1]:null,L.includes(s[r.currentZone].map[i+1][t+1])?s[r.currentZone].mapLocations[i+1][t+1]:null,L.includes(s[r.currentZone].map[i-1][t+1])?s[r.currentZone].mapLocations[i-1][t+1]:null].filter(l=>l!==null)),a.forEach(l=>{l.wither+=n*(o.upgradeCount?2**(o.upgradeCount-1):1),l.type.getEnterAction(l.entered).getProjectedDuration(l,l.wither)<=0&&(B(l.x,l.y,"."),l.wither=0,l.entered=1/0)})}function Ci(n){let e=n.x+s[r.currentZone].xOffset,t=n.y+s[r.currentZone].yOffset;const i=[L.includes(s[r.currentZone].map[t-1][e])?s[r.currentZone].mapLocations[t-1][e]:null,L.includes(s[r.currentZone].map[t][e-1])?s[r.currentZone].mapLocations[t][e-1]:null,L.includes(s[r.currentZone].map[t+1][e])?s[r.currentZone].mapLocations[t+1][e]:null,L.includes(s[r.currentZone].map[t][e+1])?s[r.currentZone].mapLocations[t][e+1]:null].filter(o=>o);return x("Wither").upgradeCount>0&&i.push(...[L.includes(s[r.currentZone].map[t-1][e-1])?s[r.currentZone].mapLocations[t-1][e-1]:null,L.includes(s[r.currentZone].map[t+1][e-1])?s[r.currentZone].mapLocations[t+1][e-1]:null,L.includes(s[r.currentZone].map[t+1][e+1])?s[r.currentZone].mapLocations[t+1][e+1]:null,L.includes(s[r.currentZone].map[t-1][e+1])?s[r.currentZone].mapLocations[t-1][e+1]:null].filter(o=>o)),!!i.length}function Ai(n){let e=n.x,t=n.y;if(e===null||t===null)return 1;e+=s[r.currentZone].xOffset,t+=s[r.currentZone].yOffset;const i=x("Wither"),o=[L.includes(s[r.currentZone].map[t-1][e])?s[r.currentZone].mapLocations[t-1][e]:null,L.includes(s[r.currentZone].map[t][e-1])?s[r.currentZone].mapLocations[t][e-1]:null,L.includes(s[r.currentZone].map[t+1][e])?s[r.currentZone].mapLocations[t+1][e]:null,L.includes(s[r.currentZone].map[t][e+1])?s[r.currentZone].mapLocations[t][e+1]:null].filter(a=>a!==null);return i.upgradeCount>0&&o.push(...[L.includes(s[r.currentZone].map[t-1][e-1])?s[r.currentZone].mapLocations[t-1][e-1]:null,L.includes(s[r.currentZone].map[t+1][e-1])?s[r.currentZone].mapLocations[t+1][e-1]:null,L.includes(s[r.currentZone].map[t+1][e+1])?s[r.currentZone].mapLocations[t+1][e+1]:null,L.includes(s[r.currentZone].map[t-1][e+1])?s[r.currentZone].mapLocations[t-1][e+1]:null].filter(a=>a!==null)),o.length?Math.max(...o.map(a=>a.type.getEnterAction(a.entered).getProjectedDuration(a,a.wither)))/2e3+.1:0}function Li(){r.breakActions=!0,Et(r.currentZone+1),d.pauseOnPortal&&d.running&&ue()}function Ri(n){s[r.currentZone].completeGoal(),B(n.x,n.y)}function Ie(n,e){return()=>n+e*r.queueTime*(f[r.currentRealm].name=="Verdant Realm"?Fn:1)}function xi(n,e,t,i){Vt(t/1e3,i)}function qi(n){s[r.currentZone].manaDrain+=Un,document.querySelector("#barrier-mult").style.display="block",document.querySelector("#current-barrier-mult").innerHTML=`x${s[r.currentZone].manaDrain+1}`,B(n.x,n.y)}function Ni(n){let e=+s[r.currentZone].map[n.y+s[r.currentZone].yOffset][n.x+s[r.currentZone].xOffset];return!isNaN(e)&&j("Compounding Realm").machineCompletions>=e?T.Now:T.Never}function Di(){return f[r.currentRealm].name=="Compounding Realm"?1/(1+r.loopCompletions/40):1}function Zi(){b("You Win!").display();const n=j("Verdant Realm");n.maxMult=1e308,n.completed=!1,n.display(),S.GameComplete=1}const Ei=[new p("Walk",100,[["Speed",1]],tt),new p("Wait",100,[["Speed",1]],()=>{}),new p("Long Wait",()=>d.longWait,[["Speed",1]],()=>{}),new p("Mine",1e3,[["Mining",1],["Speed",.2]],ee),new p("Mine Travertine",1e4,[["Mining",1],["Speed",.2]],ee),new p("Mine Granite",35e4,[["Mining",1],["Speed",.2]],ee),new p("Mine Basalt",4e6,[["Mining",1],["Speed",.2]],ee),new p("Mine Chert",5e7,[["Mining",1],["Speed",.2]],ee),new p("Mine Gold",1e3,[["Mining",1],["Speed",.2]],_n),new p("Mine Iron",2500,[["Mining",2]],Qn),new p("Mine Coal",5e3,[["Mining",2]],Xn),new p("Mine Salt",5e4,[["Mining",1]],Jn),new p("Mine Gem",1e5,[["Mining",.75],["Gemcraft",.25]],ee),new p("Collect Gem",1e5,[["Smithing",.1],["Gemcraft",1]],ri,null,null,oi),new p("Collect Mana",1e3,[["Magic",1]],ei,ii,ti,$t),new p("Activate Machine",1e3,[],si,ai),new p("Make Iron Bars",5e3,[["Smithing",1]],E([["Iron Bar",1]]),N([["Iron Ore",1]],!0)),new p("Make Steel Bars",15e3,[["Smithing",1]],E([["Steel Bar",1]]),N([["Iron Bar",1],["Coal",1]],!0)),new p("Turn Gold to Mana",1e3,[["Magic",1]],li,N([["Gold Nugget",1]],!0)),new p("Cross Pit",3e3,[["Smithing",1],["Speed",.3]],ci,yt),new p("Cross Lava",6e3,[["Smithing",1],["Speed",.3]],ui,yt),new p("Create Bridge",5e3,[["Smithing",1]],E([["Iron Bridge",1]]),N([["Iron Bar",2]])),new p("Create Long Bridge",5e4,[["Smithing",1]],E([["Iron Bridge",1]]),N([["Iron Bar",2]])),new p("Upgrade Bridge",12500,[["Smithing",1]],E([["Steel Bridge",1]]),N([["Steel Bar",1],["Iron Bridge",1]])),new p("Create Sword",7500,[["Smithing",1]],E([["Iron Sword",1]]),Ue([["Iron Bar",3]],"Sword")),new p("Upgrade Sword",22500,[["Smithing",1]],E([["Steel Sword",1]]),N([["Steel Bar",2],["Iron Sword",1]])),new p("Enchant Sword",3e6,[["Smithing",.5],["Gemcraft",.5]],E([["+1 Sword",1]]),N([["Gem",3],["Steel Sword",1]])),new p("Create Shield",12500,[["Smithing",1]],E([["Iron Shield",1]]),Ue([["Iron Bar",5]],"Shield")),new p("Upgrade Shield",27500,[["Smithing",1]],E([["Steel Shield",1]]),N([["Steel Bar",2],["Iron Shield",1]])),new p("Enchant Shield",3e6,[["Smithing",.5],["Gemcraft",.5]],E([["+1 Shield",1]]),N([["Gem",3],["Steel Shield",1]])),new p("Create Armour",1e4,[["Smithing",1]],E([["Iron Armour",1]]),Ue([["Iron Bar",4]],"Armour")),new p("Upgrade Armour",25e3,[["Smithing",1]],E([["Steel Armour",1]]),N([["Steel Bar",2],["Iron Armour",1]])),new p("Enchant Armour",3e6,[["Smithing",.5],["Gemcraft",.5]],E([["+1 Armour",1]]),N([["Gem",3],["Steel Armour",1]])),new p("Attack Creature",1e3,[["Combat",1]],mi,null,di,hi),new p("Teleport",1,[["Runic Lore",1]],ki,wi,null,bi),new p("Charge Duplication",5e4,[["Runic Lore",1]],vt,Si,null,Ti),new p("Charge Wither",1e3,[["Runic Lore",1]],Ci,null,Mi,Ai),new p("Charge Teleport",5e4,[["Runic Lore",1]],vt,vi),new p("Pump",0,[],()=>{}),new p("Heal",1e3,[["Runic Lore",1]],gi,pi,fi,yi),new p("Portal",1,[["Magic",.5],["Runic Lore",.5]],Li),new p("Complete Goal",1e3,[["Speed",1]],Ri),new p("Chop",Ie(1e3,.1),[["Woodcutting",1],["Speed",.2]],ee),new p("Kudzu Chop",Ie(1e3,.1),[["Woodcutting",1],["Speed",.2]],tt),new p("Spore Chop",Ie(1e3,.1),[["Woodcutting",1],["Speed",.2]],ee,null,xi),new p("Oyster Chop",Ie(1e3,.2),[["Woodcutting",1],["Speed",.2]],ee),new p("Create Axe",2500,[["Smithing",1]],E([["Iron Axe",1]]),N([["Iron Bar",1]])),new p("Create Pick",2500,[["Smithing",1]],E([["Iron Pick",1]]),N([["Iron Bar",1]])),new p("Create Hammer",2500,[["Smithing",1]],E([["Iron Hammer",1]]),N([["Iron Bar",1]])),new p("Enter Barrier",1e4,[["Chronomancy",1]],qi,Ni,null,Di),new p("Exit",5e7,[["Mining",.25],["Woodcutting",.25],["Magic",.25],["Speed",.25],["Smithing",.25],["Runic Lore",.25],["Combat",.25],["Gemcraft",.25],["Chronomancy",.25]],Zi)];function Z(n){return Ei.find(e=>e.name==n)}Z("Wait").getDuration=Z("Wait").getBaseDuration=Z("Wait").getProjectedDuration=()=>Z("Wait").baseDuration;Z("Long Wait").getDuration=Z("Long Wait").getBaseDuration=Z("Long Wait").getProjectedDuration=()=>Z("Long Wait").baseDuration();class m{canWorkTogether;description;enterAction;enterCount;extraReset=null;name;nextCost;presentAction;startWater;symbol;constructor(e,t,i,o,a,l=null,c=null,u=1,h=!0,y=0){this.name=e,this.symbol=t,this.description=i,this.enterAction=o?Object.create(Z(o)):null,this.presentAction=a?Object.create(Z(a)):null,this.nextCost=c,this.enterCount=u,l&&(this.extraReset=l),this.canWorkTogether=h,this.startWater=y}getEnterAction(e){return e>=this.enterCount?Object.create(Z("Walk")):this.name=="Complete Goal"&&s[r.currentZone].goalComplete?Object.create(Z("Mine")):this.enterAction}reset(...e){return this.extraReset?this.extraReset(...e):0}}function wt(n,e){return n+e}function Ii(){return`${f[r.currentRealm].getNextActivateAmount()} gold nuggets, 1s`}function kt(n,e,t,i,o){return`${v(this.presentAction?this.presentAction.getProjectedDuration(_(i,o,!0,t.index))/1e3:-1,2)}s`}function $e(n){return dt.find(e=>e.name==n)}const dt=[new m("Solid Rock","â–ˆ","Some kind of rock, too hard to dig through.",null,null,null),new m("Tunnel",".","A bare stone passage, empty of any ornamentation.","Walk",null,null),new m("Limestone","#","A whole bunch of relatively soft rock.","Mine",null,null),new m("Travertine","Â«","A whole bunch of rock, but much harder than usual.","Mine Travertine",null,null),new m("Granite","â•–","This stone just doesn't want to budge.","Mine Granite",null,null),new m("Basalt","â•£","{'0':'You''ve hit a wall.','3':'The wall hits back.'}","Mine Basalt",null,null),new m("Chert","â– ","You'd think it was the hard rock all around it, but it's a different colour.","Mine Chert",null,null),new m("Gold ore","+","Rocks with veins of gold ore.","Mine Gold",null,null),new m("Iron ore","%","Rocks with veins of iron ore.","Mine Iron",null,null),new m("Salt","â–‘","A wall of rock salt.  It only takes so long to mine it because you want to sort out the salt and not carry a ton of gravel with you.","Mine Salt",null,null),new m("Mana-infused Rock","Â¤","A whole bunch of rock.  But this time, it glows!","Mine","Collect Mana",wt,kt),new m("Mana Spring","*","Pure mana, flowing out of the rock.  Each time you absorb the mana, the cost to do so next time increases.","Walk","Collect Mana",wt,kt),new m("Strange Machine","â™¥","A strange machine labelled '{'0':'Clone Machine','1':'Rune Enhancer','2':'Rune Enhancer','3':'Time Stretcher'}'.  What could it do?","Walk","Activate Machine",null,Ii),new m("Vaporizer","=","A machine for extracting the magic right out of gold. ({MANA_PER_GOLD} mana per gold)","Walk","Turn Gold to Mana",null),new m("Fountain","^","A healing fountain, activated by the runes around its base.","Walk","Heal",null,null,void 0,!1),new m("Bottomless Pit"," ","A bottomless pit.","Cross Pit",null,null),new m("Lava","~","A bottomless pit full of lava.  At least, you're not going to be walking on the bottom, so it's bottomless enough for you.  Your bridges might not last very long here, but probably long enough for one clone.","Cross Lava",null,null,null,1/0),new m("Goblin","g",`An ugly humanoid more likely to try and kill you than to let you by.
{STATS}`,"Attack Creature",null,null),new m("Goblin Chieftain","c",`This one is uglier than the last two.  Probably meaner, too.
{STATS}`,"Attack Creature",null,null),new m("Goblin Champion","m",`The largest of the goblins.  You're going to have to work hard to take him down.
{STATS}`,"Attack Creature",null,null),new m("Skeleton","s",`An undead.  It's not very dangerous, but it is resilient.
{STATS}`,"Attack Creature",null,null),new m("Golem","G",`A towering golem made out of finely crafted stone.  There aren't even any chinks in its armour!
{STATS}`,"Attack Creature",null,null),new m("Guardian","X",`This massive creature exudes an aura of implacable doom.
{STATS}`,"Attack Creature",null,null),new m("Weaken Rune","W","Weakens adjacent creatures.","Walk",null,null),new m("Wither Rune","H","This rune kills plants next to it.","Walk",null,null),new m("Teleport To Rune","T","This rune allows someone or something to come through from another place.","Walk",null,null),new m("Teleport To Rune - Charged","t","This rune allows someone or something to come through from another place.","Walk",null,null),new m("Teleport From Rune","F","This rune allows someone to slip beyond to another place.","Walk",null,null),new m("Duplication Rune","D","This rune increases the yield of mining in the 8 tiles next to it.","Walk",null,null),new m("Duplication Rune - Charged","d","This rune increases the yield of mining in the 8 tiles next to it.","Walk",null,null),new m("Pump Rune","P","This rune drains water from it and orthogonally adjacent tiles.","Walk",null,null),new m("Coal","â—‹","Bituminous coal is present in these rocks.","Mine Coal",null,null),new m("Gem","â˜¼","You can find gems studded in the walls here.  Each time you extract a gem from this tile (in one reset), it gets a bit harder to get the next one.","Mine Gem","Collect Gem",null),new m("Gem Tunnel","Â©","You can find gems studded in the walls here.  Each time you extract a gem from this tile (in one reset), it gets a bit harder to get the next one.","Mine Gem","Collect Gem",null),new m("Furnace","â•¬","A large box full of fire.","Walk","Make Iron Bars",null),new m("Anvil - Bridge","âŽ¶","An anvil on which you can make a bridge out of {'0':2,'1':4} iron bars.","Walk","Create Bridge",null),new m("Anvil - Long Bridge","â•‘","An anvil on which you can make a bridge out of {'0':2,'1':4} iron bars.  These pits are a bit wider than the others, so it'll take a bit longer to craft the bridge (though your old ones still work for some reason).","Walk","Create Long Bridge",null),new m("Anvil - Sword",")","An anvil on which you can make a sword out of {'0':3,'1':6} iron bars.","Walk","Create Sword",null),new m("Anvil - Shield","[","An anvil on which you can make a shield out of {'0':5,'1':10} iron bars.","Walk","Create Shield",null),new m("Anvil - Armour","]","An anvil on which you can make a suit of armour out of {'0':4,'1':8} iron bars.","Walk","Create Armour",null),new m("Steel Furnace","â–£","A large box full of fire.  This one has a slot for coal and a slot for iron bars.","Walk","Make Steel Bars",null),new m("Anvil - Upgrade Bridge","&","An anvil on which you can upgrade an iron bridge into a steel bridge using {'0':1,'1':2} steel bar.","Walk","Upgrade Bridge",null),new m("Anvil - Upgrade Sword","(","An anvil on which you can upgrade an iron sword into a steel sword using {'0':2,'1':4} steel bars.","Walk","Upgrade Sword",null),new m("Anvil - Upgrade Shield","{","An anvil on which you can upgrade an iron shield into a steel shield using {'0':2,'1':4} steel bars.","Walk","Upgrade Shield",null),new m("Anvil - Upgrade Armour","}","An anvil on which you can upgrade an iron suit of armour into a steel suit of armour using {'0':2,'1':4} steel bars.","Walk","Upgrade Armour",null),new m("Portal","Î˜","A portal to another zone.","Walk","Portal",null),new m("Complete Goal","âˆš","A strange energy field where you can obtain additional powers.","Complete Goal",null,null),new m("Mushroom","â™ ","A giant mushroom which grows quickly.  It's harder to cut the longer you wait. (Growth: 1+{'0':0.1,'2':0.5}t)","Chop",null,null),new m("Kudzushroom","â™£","A giant mushroom which grows quickly.  It grows so fast each clone needs to make its own way every time. (Growth: 1+{'0':0.1,'2':0.5}t)","Kudzu Chop",null,null,null,1/0,!1),new m("Sporeshroom","Î±","A giant mushroom which grows quickly.  While you cut it, it lets out poisonous spores, injuring your game.clones cutting it for 1 damage per second. (Growth: 1+{'0':0.1,'2':0.5}t)","Spore Chop",null,null),new m("Oystershroom","Â§","A giant mushroom which grows extremely quickly.  You don't think you've ever seen a mushroom grow that fast. (Growth: 1+{'0':0.2,'2':1}t)","Oyster Chop",null,null),new m("Springshroom","Î´","A giant mushroom which grows quickly.  It seems to continually spray water. (Growth: 1+{'0':0.1,'2':0.5}t)","Chop",null,null,null,void 0,!0,.001),new m("Anvil - Axe","Â¢","An anvil on which you can make an axe out of {'0':'an iron bar','1':'2 iron bars'}.  This probably won't be useful to you for at least a few zones.","Walk","Create Axe",null),new m("Anvil - Pick","Â¥","An anvil on which you can make a pick out of {'0':'an iron bar','1':'2 iron bars'}.","Walk","Create Pick",null),new m("Anvil - Hammer","Â£","An anvil on which you can make a hammer out of {'0':'an iron bar','1':'2 iron bars'}.","Walk","Create Hammer",null),new m("Spring","0","Deep water - it'll spread out and drown you if you're not careful!","Walk",null,null,null,void 0,!0,1),new m("Sword Enchanter","|","An anvil on which you can enchant a steel sword using {'0':3,'1':6} gems.","Walk","Enchant Sword",null),new m("Shield Enchanter","<","An anvil on which you can enchant a steel shield using {'0':3,'1':6} gems.","Walk","Enchant Shield",null),new m("Armour Enchanter",">","An anvil on which you can enchant a steel suit of armour using {'0':3,'1':6} gems.","Walk","Enchant Armour",null),new m("Timelike Barrier","1","A wall made of a strange energy that saps your mana. {'3':'Its duration does not compound.'}","Enter Barrier",null,null),new m("Timelike Barrier","2","A wall made of a strange energy that saps your mana. {'3':'Its duration does not compound.'}","Enter Barrier",null,null),new m("Timelike Barrier","3","A wall made of a strange energy that saps your mana. {'3':'Its duration does not compound.'}","Enter Barrier",null,null),new m("Exit","!","A door.  Opening to the outside world","Exit",null,null),new m("Not a location","","",null,null)];new URL(document.location.href).searchParams.get("save")==="separate"&&(dt.forEach(n=>{n.name!=="Portal"&&(n.canWorkTogether=!1)}),console.log("Location types set to not work together."));function qe(n){return dt.find(e=>e.symbol==n)?.name}function v(n,e=0){return n<10**-(e+1)&&(n=0),n>100&&(e=Math.min(e,1)),n.toFixed(e)}function Pi(n){if(n==1/0)return"Infinity";let e=Math.floor(n/3600);e=`${e?`${e}:`:""}`;let t=Math.floor(n%3600/60);t=t||e?t>9?`${t}:`:`0${t}:`:"";let i=Math.floor(n%60*10)/10;return n>100*3600&&(i=Math.floor(i)),i=i<10&&t?`0${i.toFixed(n>100*3600?0:1)}`:i.toFixed(n>100*3600?0:1),`${e}${t}${i}`}let Fe;function bt(){Fe=Fe||document.querySelector("#time-banked"),Fe.innerText=Pi(r.timeBanked/1e3)}window.ondrop=n=>n.preventDefault();class Ne{id;x=0;y=0;startDamage=0;damage=0;minHealth=0;inCombat=!0;isSyncing=!1;notSyncing=!1;remainingTime=0;repeated=!1;timeLines=[];timeLineElements=[];currentTimelineEntry=null;el=null;repeatsThisTick=0;noActionsAvailable=!1;currentCompletions=null;timeAvailable=0;occupiedNode=null;isPausing=!1;nextActionMove=!1;isSelected=!1;constructor(e){this.id=e,this.createTimeline(),this.reset(),s.forEach(t=>t.queues.push(new ye(this.id)))}enterZone(){this.x=0,this.y=0,this.startDamage=this.damage,this.minHealth=0,this.isSyncing=!1,this.notSyncing=!1,this.inCombat=!1,this.repeated=!1,this.currentTimelineEntry=null}reset(){this.enterZone(),this.remainingTime=0,this.damage=0,this.styleDamage(),this.resetTimeLine()}takeDamage(e){if(g("Health").current-this.damage>.1?this.damage=Math.min(g("Health").current-.05,this.damage+e):this.damage+=e,this.minHealth=Math.min(this.minHealth,this.startDamage-this.damage),this.damage<0&&(this.damage=0),this.damage>=g("Health").current&&(this.damage=1/0,b("Death").display(),r.clones.every(t=>t.damage==1/0&&t.x==this.x&&t.y==this.y))){const t=rt(this.x,this.y,r.currentZone);t&&(t.allDead=!0)}this.styleDamage()}styleDamage(){if(!this.el&&(this.el=document.querySelector(`#queue${this.id}`),!this.el))return;const e=1-Math.min(this.damage/g("Health").current);this.el.querySelector(".damage").style.width=e==1||!Number.isFinite(e)?"0":e*100+"%",e<0?this.el.classList.add("dead-clone"):this.el.classList.remove("dead-clone")}writeStats(){document.querySelector(".clone-info .health-amount").innerHTML=v(Math.max(g("Health").current-this.damage,0),this.damage?2:0);const e=this.timeLines[r.currentZone][this.timeLines[r.currentZone].length-1]||this.currentTimelineEntry;e?(document.querySelector(".clone-info .action-name").innerHTML=e.type,document.querySelector(".clone-info .action-progress").innerHTML=v(this.remainingTime/1e3,2)):(document.querySelector(".clone-info .action-name").innerHTML="",document.querySelector(".clone-info .action-progress").innerHTML="0")}sync(){this.notSyncing||(this.isSyncing=!0)}unSync(){this.isSyncing=!1}noSync(){this.notSyncing=!this.notSyncing}drown(e){const t=s[r.currentZone].getMapLocation(this.x,this.y,!0);t?.water&&this.takeDamage(t.water**2*e/1e3)}createTimeline(){this.timeLines=[];const e=document.querySelector("#timeline-template");if(e===null)throw new Error("No timeline template found");this.timeLineElements=[];for(let t=0;t<s.length;t++)this.timeLines[t]=[],this.timeLineElements[t]=e.cloneNode(!0),this.timeLineElements[t].id=`zone${t+1}-timeline${r.clones.length}`;document.querySelector("#timelines").append(this.timeLineElements[r.displayZone])}resetTimeLine(){for(let e=0;e<this.timeLines.length;e++){this.timeLines[e]=[];const t=this.timeLineElements[e];for(;t.lastChild;)t.removeChild(t.lastChild)}}addToTimeline(e,t=0){if(e===null||t<1||isNaN(t))return;A.addActionTime(e.name,r.currentZone,t);const i=this.timeLines[r.currentZone][this.timeLines[r.currentZone].length-1]||this.currentTimelineEntry;if(i?.type==e.name)i.time+=t,i.el.dataset.time=Math.round(i.time).toString(),i.el.style.flexGrow=i.time.toString();else if(d.timeline){const o=document.createElement("div");o.dataset.name=e.name,o.dataset.time=Math.round(t).toString(),o.style.flexGrow=t.toString(),o.classList.add(e.name.replace(/ /g,"-")),r.currentZone>0&&this.timeLines[r.currentZone].length==0&&e.name=="No action"?(this.timeLineElements[r.currentZone-1].append(o),this.timeLines[r.currentZone-1].push({type:e.name,time:t,el:o})):(this.timeLineElements[r.currentZone].append(o),this.timeLines[r.currentZone].push({type:e.name,time:t,el:o})),this.currentTimelineEntry=this.timeLines[r.currentZone][this.timeLines[r.currentZone].length-1]}else this.currentTimelineEntry={type:e.name,time:t,el:document.createElement("div")}}static addNewClone(e=!1){const t=new Ne(r.clones.length);r.clones.push(t),e||(r.clones.length==2&&b("First Clone").display(),r.clones.length==3&&b("Second Clone").display(),r.clones.length==4&&b("Third Clone").display(),r.clones.length==5&&b("Fourth Clone").display()),s.forEach(i=>{for(;i.queues.length<r.clones.length;){let o=new ye(i.queues.length);i.queues.push(o)}})}}const Gi=60;class Wi{lastAction=Date.now();timeBanked=0;queueTime=0;queuesNode=document.querySelector("#queues");queueTimeNode=document.querySelector("#time-spent");zoneTimeNode=document.querySelector("#time-spent-zone");queueActionNode=document.querySelector("#actions-spent");loopCompletions=0;clones=[];currentRoutes=[];breakActions=!1;shouldReset=!1;currentZone=0;displayZone=0;totalDrain=0;grindRoutes=[];routes=[];currentRealm=0;runActions(e){const t=g("Mana");for(;e>.001;){let i=s[this.currentZone].queues.map(u=>u.getNextAction());const o=i.map((u,h)=>u===null?h:-1).filter(u=>u>-1);if(i=i.filter(u=>u!==null),i.length==0)return(d.autoRestart==ne.RestartAlways||d.autoRestart==ne.RestartDone)&&ae(),e;if(i.some(u=>u.actionID==":"))return d.running&&ue(),i.forEach(u=>{u.action==":"&&u.complete()}),e;if(i.some(u=>u.done==k.NotStarted)){i.forEach(u=>u.start());continue}const a=i.filter(u=>u.done!=k.Started);if(i=i.filter(u=>u.done==k.Started),s[this.currentZone].queues.every((u,h)=>this.clones[h].isSyncing||this.clones[h].damage==1/0||this.clones[h].notSyncing||!u.hasFutureSync())&&a.some(u=>u.action=="=")){a.filter(u=>u.action=="=").forEach(u=>u.complete()),this.clones.forEach(u=>u.unSync());continue}if(i.length==0)return a.length>0&&a.forEach(u=>u.start()),e;const l=i.map(u=>u.currentAction);if(i.some(u=>u.currentAction?.expectedLeft===0&&u.actionID=="T")){i.forEach(u=>{u.currentAction?.expectedLeft===0&&u.actionID=="T"&&(u.done=k.Complete)});continue}let c=Math.min(...l.map(u=>u.expectedLeft/l.reduce((h,y)=>h+ +(y===u),0)),e);c<.01&&(c=.01),i.forEach(u=>u.tick(c)),o.forEach(u=>{this.clones[u].damage===1/0?this.clones[u].addToTimeline({name:"Dead"},c):(this.clones[u].addToTimeline({name:"None"},c),g("Speed").gainSkill(c/1e3))}),a.forEach(u=>{u.currentClone.addToTimeline({name:"Wait"},c),g("Speed").gainSkill(c/1e3)}),this.clones.forEach(u=>u.drown(c)),s[this.currentZone].tick(c),t.spendMana(c/1e3),e-=c,this.queueTime+=c}return 0}mainLoop(){if(s[0].index===-1||f[0].index===-1)return;this.shouldReset&&ae();const e=g("Mana");this.queuesNode=this.queuesNode||document.querySelector("#queues"),isNaN(e.current)&&d.running&&ue();const t=Date.now()-this.lastAction;if(this.lastAction=Date.now(),d.running&&(e.current==0||this.clones.every(a=>a.damage===1/0)?(this.queuesNode.classList.add("out-of-mana"),this.clones.forEach(a=>{let l=s[this.currentZone].getMapLocation(a.x,a.y);if(l?.baseType.name=="Mana-infused Rock"){let c=l.getPresentAction();c&&c.startingDuration>c.remainingDuration&&V.updateBestRoute(l);const u=rt(a.x,a.y,this.currentZone);u&&(u.hasAttempted=!0)}}),A.finalize(),b("Out of Mana").display(),(d.autoRestart==ne.RestartAlways||d.autoRestart==ne.RestartDone&&this.clones.every(a=>a.repeated))&&ae()):this.queuesNode.classList.remove("out-of-mana"),d.autoRestart==ne.RestartAlways&&s[this.currentZone].queues.every(a=>!a.getNextAction())&&(this.queuesNode.classList.remove("out-of-mana"),ae())),!d.running||e.current==0||d.autoRestart==ne.WaitAny&&s[this.currentZone].queues.some(a=>!a.getNextAction()&&(!a.length||a[a.length-1].actionID!="="))||d.autoRestart==ne.WaitAll&&s[this.currentZone].queues.every(a=>!a.getNextAction())&&this.clones.some(a=>a.damage<1/0)||!it().hidden){this.timeBanked+=t,bt();return}let i=t;if(d.usingBankedTime&&this.timeBanked>0){const a=3+s[0].cacheManaGain[0]**.5;i=Math.min(t+this.timeBanked,t*a)}i=Math.min(i,d.maxTotalTick,e.current*1e3),i<0&&(i=0);let o=this.runActions(i);this.timeBanked+=t+o-i,this.timeBanked<0&&(this.timeBanked=0),s[this.currentZone].queues.some(a=>a.selected)&&this.clones[s[this.currentZone].queues.findIndex(a=>a.selected)].writeStats(),this.queueTimeNode=this.queueTimeNode||document.querySelector("#time-spent"),this.queueTimeNode.innerText=v(this.queueTime/1e3,1),this.zoneTimeNode=this.zoneTimeNode||document.querySelector("#time-spent-zone"),this.currentZone==this.displayZone?this.zoneTimeNode.innerText=v((this.queueTime-(s[this.currentZone].zoneStartTime||0))/1e3,1):this.zoneTimeNode.innerText=v(Math.max(0,(s[this.displayZone+1]?.zoneStartTime||0)-(s[this.displayZone].zoneStartTime||0))/1e3,1),this.queueActionNode=this.queueActionNode||document.querySelector("#actions-spent"),this.queueActionNode.innerText=`${v(this.loopCompletions,0)} (x${v(1+this.loopCompletions/40,3)})`,bt(),P.forEach(a=>a.update()),se.forEach(a=>a.displayDescription()),A==ve&&ve.display(),Re()}}const r=new Wi;setInterval(()=>r.mainLoop(),Math.floor(1e3/Gi));function St(){const n=new URL(document.location.href).searchParams;Ne.addNewClone(),s[0].enterZone(),s[0].queues[0].selected=!0,_(0,0),Re(),b("Welcome to Cavernous!").display(),n.has("timeless")&&(r.timeBanked=1/0)}setTimeout(()=>dn(),15);let nt=[],jt=[],Ke=null;const Se={FINAL:0,HOVER:1,CURSOR:2};function ht(n,e,t=!1,i=Se.FINAL){if(n==-1)return;let o=s[r.displayZone].xOffset,a=s[r.displayZone].yOffset;if([o,a]=Bi(o,a,s[r.displayZone].queues[e],n),o===void 0||a===void 0)return;let l=Wt(o,a);l&&(i==Se.HOVER?(Ke&&Ke.classList.remove("hover-location"),l.classList.add("hover-location"),Ke=l):i==Se.CURSOR?(l.classList.add("cursor-location"),jt.push(l)):(l.classList.add("final-location"),nt.push(l)),t||Rn(l))}function Bi(n,e,t,i=-1){for(let o=0;o<=i;o++){if(!t||!t[o]||n===void 0||e===void 0)return[void 0,void 0];let a=t[o].actionID;if([n,e]=Hi(n,e,a),!s[r.displayZone].hasMapLocation(n,e))return[void 0,void 0]}return[n,e]}function Hi(n,e,t){if(t[0]=="P"){const i=t.match(/P(-?\d+):(-?\d+);/);if(i===null)throw new Error(`Invalid action string "${t}"`);return[,n,e]=i.map(o=>+o),[n+s[r.displayZone].xOffset,e+s[r.displayZone].yOffset]}return n+=+(t=="R")-+(t=="L"),e+=+(t=="D")-+(t=="U"),qn(n,e)=="â–ˆ"&&(n-=+(t=="R")-+(t=="L"),e-=+(t=="D")-+(t=="U")),[n,e]}function we(n=!1){nt.forEach(e=>e.classList.remove("final-location")),nt=[],s[r.displayZone].queues.forEach(e=>{e.selected&&ht(e.cursor||e.length-1,e.index,n)})}function Oi(n){let e=n.target.parentElement.parentElement,t=Array.from(e.children).filter(o=>!o.classList.contains("action-count")).findIndex(o=>o==n.target.parentElement),i=+e.parentElement.id.replace("queue","");isNaN(+i)||ht(t,i,!1,Se.HOVER)}function Tt(){jt.forEach(n=>n.classList.remove("cursor-location")),s[r.displayZone].queues.forEach(n=>{n.cursor!==null&&ht(n.cursor,n.index,!1,Se.CURSOR)})}document.querySelector("#app").innerHTML=`
	<div id="templates">
		<div id="stat-template" class="stat block">
			<span class="name"></span>
			<span class="icon"></span>
			<span class="effect"></span>
			<div class="description"></div>
		</div>
		<div id="rune-template" class="stat block">
			<span class="name"></span>
			<span class="icon"></span>
			<span class="index"></span>
			<div class="description"></div>
		</div>
		<div id="stuff-template" class="stuff block">
			<div class="name"></div>
			<span class="count"></span>
			<span class="icon"></span>
			<div class="stuff-cut">
				<span class="count2"></span>
				<span class="icon2"></span>
			</div>
			<div class="description"></div>
		</div>
		<div id="action-template" class="action" onmouseover="${n=>Oi(n)}"
			onmouseout="stopHovering()" onclick="setCursor(event, this)">
			<div class="character"></div>
		</div>
		<table>
			<tr id="row-template"></tr>
			<tr id="grind-row-template"></tr>
			<tr>
				<td id="cell-template"></td>
				<td id="grind-cell-template"></td>
			</tr>
		</table>
		<div id="queue-template" class="bottom-block" onclick="selectClone(this, event)">
			<div class="damage" style="width: 100%"></div>
			<div class="queue-inner" onclick="clearCursors(event, this)"></div>
			<div class="cursor"></div>
			<div class="work-progress"></div>
		</div>
		<div id="timeline-template" class="timeline"></div>
		<div id="zone-template" class="zone">
			<div class="name"></div>
			<div class="mana"></div>
			<div class="routes"></div>
		</div>
		<div id="realm-template" class="realm">
			<div class="name"></div>
			<div class="description"></div>
		</div>
		<div id="zone-route-template">
			<span class="actions"></span>
			<span class="mana"></span>
			<span class="require"></span>
			<span class="stuff"></span>
			<span class="delete-route"><span class="delete-route-inner">x</span></span>
		</div>
		<div id="message-link-template" class="message-link" onclick="viewMessage(event, this)"></div>
		<div id="log-entry-template" class="log-entry">
			<span class="name"></span>
			<span class="value"></span>
			<div class="description"></div>
		</div>
		<div id="stat-log-entry-template" class="log-entry">
			<span class="name"></span>
			<span>
				<span class="current-value"></span>
				(<span class="base-value"></span>)
			</span>
		</div>
		<div id="previous-log-template" class="log-entry previous">
			<span class="pin">â™¦</span>
			<span class="name"></span>
			<span class="value"></span>
		</div>
		<div id="loop-zone-template" class="loop-zone"></div>
	</div>
	<div class="vertical-blocks">
		<div id="options" class="vertical-block">
			<h3>Options</h3>
			<div id="options-inner">
				<div class="option block clickable" onclick="toggleBankedTime()">
					<span id="time-banked-toggle">Using</span> Time (B)
					<span id="time-banked">0</span>
					<div class="description">
						If you're offline or your computer runs slowly, time is banked (at 100% efficiency) - you can
						use it to speed up the game!
					</div>
				</div>
				<div class="option block clickable" onclick="toggleRunning()">
					<span id="running-toggle">Running</span> (P)
					<div class="description">Pause the game to more easily adjust your queue.</div>
				</div>
				<div class="option block clickable" onclick="toggleAutoRestart()">
					<span id="auto-restart-toggle">Wait when any complete</span> (<span id="auto-restart-key">W</span>)
					<div class="description">Restart to improve your skills when the queue is empty.</div>
				</div>
				<div class="option block clickable" onclick="resetLoop()">
					<span class="name">Travel back in time (R)</span>
					<div class="description">Return to your little room.</div>
				</div>
				<div id="grind-option" class="option block clickable" onclick="toggleGrindMana(event)" onmouseover="updateGrindStats()">
					<span id="grind-mana-toggle">Not grinding mana rocks</span> (G)
					<div class="description">
						Loops through your best paths to each mana rock.<br />
						Ctrl-click to reset all route times so all rocks will be revisited when grinding.<br />
						<b>Expected completions:</b>
						<table id="grind-stats-table">
							<tr id="grind-stats-header"></tr>
							<tbody id="grind-stats"></tbody>
							<tr id="grind-stats-footer"></tr>
							<tr><td><b>Legend:</b></td></tr>
							<tr><td class="failed" colspan="100" style="text-align: left;">Some route failed to load</td></tr>
							<tr><td class="drowned" colspan="100" style="text-align: left;">Some route was drowned</td></tr>
							<tr><td class="unreached" colspan="100" style="text-align: left;">Some mana rock unreached</td></tr>
							<tr><td class="revisit" colspan="100" style="text-align: left;">Some rock yet to be revisited</td></tr>
							<tr><td class="skipped" colspan="100" style="text-align: left;">Some rock skipped</td></tr>
						</table>
					</div>
				</div>
				<div id="stat-grind-option" class="option block clickable" onclick="toggleGrindStats(event)">
					<span id="grind-stat-toggle">Not grinding stats</span> (<span id="auto-stat-grind-key">S</span>)
					<div class="description">Each loop, loads the route that gives the most stats.</div>
				</div>
				<div class="option block clickable" onclick="toggleLoadPrereqs()">
					<span id="load-prereq-toggle">Load only zone route</span> (Q)
					<div class="description">Adjust what happens when clicking on a zone route.</div>
				</div>
				<h4 class="option-separator">Config</h4>
				<div class="option block clickable" onclick="viewMessages()">
					<span class="name">View messages</span>
					<div class="description">Reminisce about the 'story'.</div>
				</div>
				<div class="option block clickable" onclick="viewConfig()">
					<span class="name">View more config</span>
					<div class="description">There are a bunch more options.</div>
				</div>
				<div class="block">
					Mouse over to see key bindings.
					<div class="description big-description">
						Arrow keys to move<br />
						Space to act at your location<br />
						Backspace removes a command<br />
						1-6 to inscribe a rune<br />
						Ctrl-backspace clears the whole queue<br />
						Tab selects the next clone<br />
						Ctrl-Left/Right to move within a queue<br />
						Shift-Tab selects the previous clone<br />
						Ctrl-click and Ctrl-Shift-number selects multiple clones<br />
						Ctrl-A selects all clones<br />
						. to wait for 100ms<br />
						, to wait for longer<br />
						: or ; to insert a breakpoint which pauses the game<br />
						Home/End moves the cursor to the start/end of selected clones<br />
					</div>
				</div>
				<div onclick="displaySaveClick(event)">
					<div class="option block clickable" onclick="save()">
						<span class="name">Manually Save</span>
						<div class="description">The game automatically saves every time a reset occurs.</div>
					</div>
					<div class="option block clickable" ondblclick="deleteSave()">
						<span class="name">Clear Save (double click)</span>
						<div class="description">Are you sure you want to restart the game?</div>
					</div>
					<div class="option-row">
						<div class="option block clickable option--half-width" onclick="exportGame()">
							<span class="name">Export</span>
							<div class="description">This will put your save on your clipboard.</div>
						</div>
						<div class="option block clickable option--half-width" onclick="importGame()">
							<span class="name">Import</span>
							<div class="description">Paste your save in the box.</div>
						</div>
					</div>
					<div class="option-row">
						<div class="option block clickable option--half-width" onclick="exportQueues()">
							<span class="name">Export Queue</span>
							<div class="description">This will put your current queues on your clipboard.</div>
						</div>
						<div class="option block clickable option--half-width" onclick="importQueues()">
							<span class="name">Import Queue</span>
							<div class="description">Paste queues in the box.</div>
						</div>
					</div>
					<div class="option-row">
						<div class="option block clickable option--half-width" onclick="longExportQueues()">
							<span class="name">Long Export</span>
							<div class="description">This will put your current queues (all zones, this realm) on your clipboard.</div>
						</div>
						<div class="option block clickable option--half-width" onclick="longImportQueues()">
							<span class="name">Long Import</span>
							<div class="description">Paste queues for all zones in this realm in the box.</div>
						</div>
					</div>
				</div>
				<div class="option block clickable" onclick="currentLoopLog.display()">
					<span class="name">View loop log</span>
					<div class="description">Might be laggy if it's open while running.</div>
				</div>
				<div class="option block clickable" onclick="multiworld.login()">
					<span class="name">Multi World</span>
					<div class="description">Connect to Archipelago server.</div>
				</div>
			</div>
			<div class="version" title="By Nucaranlaeg">
				<a href="https://paypal.me/SamBenner" target="_blank">Paypal</a>
				<a href="https://discord.gg/EXAHXBr" target="_blank">Discord</a><br />
				Version <span id="version">2.7.13</span><br />
				Â©2021-2025
			</div>
		</div>
		<div id="stats" class="vertical-block">
			<h3>Stats</h3>
			<div class="clone-info">
				<h6>Selected Clone</h6>
				Health: <span class="health-amount"></span><br>
				<span class="action-name"></span><br>
				<span class="action-progress"></span> <small>clone-seconds</small>
			</div>
			<div class="queue-time">
				<div id="queue-actions">Actions: <span id="actions-spent"></span></div>
				<span class="barrier-related" id="barrier-mult">Barrier mult: <span id="current-barrier-mult">1</span><br></span>
				Zone time: <span id="time-spent-zone">0</span>s<br>
				Time spent: <span id="time-spent">0</span>s
			</div>
		</div>
		<div id="stuff" class="vertical-block">
			<h3>Stuff</h3>
			<div id="stuff-inner"></div>
			<div id="runes">
				<hr />
				<h3 title="Press the rune's number to insert it into your queue.">Runes</h3>
			</div>
			<div id="stuff-inner"></div>
			<h3>Prestige
				<div class="block">
					Bonuses
					<div class="description big-description">
						Prestige Count: <span id="prestigecount"></span><br />
						Bonuses listed per prestige<br />
						Bonus Clones: 1 <br />
						Faster Stats: 10% faster<br />
						Mana Scaling: 95% cost (dimishing at 0.75 per)<br />
						Bonus Resouces: 10% more (stacks with Duplication Rune)<br />
						Better Equipment: 10% more (not including weapons)<br />
						Stat Soft Cap: +1x Compound scaling and +20 base<br />
						Bonus Zones: TBD<br />
					</div>	
				</div>	
			</h3>
			<div class="option block clickable option--half-width" ondblclick="prestigeGame()">
				<span class="name">Prestige</span>
				<div class="description">Prestige and get points.</div>
			</div>
		</div>
		<div id="map" class="vertical-block wide" onclick="viewCell(event.target)">
			<!-- <canvas id="mapCanvas" style="position:absolute;z-index:5;width:10px;height:10px;"></canvas> -->
			<h3>Map (<span id="zone-name">Zone 1</span>)</h3>
			<div id="realm-select"></div>
			<div id="zone-select"></div>
			<table id="map-inner"></table>
			<div id="map-legend" class="block">
				Map highlighting legend
				<div class="description">
					<div class="map-legend-item"><span class="map-legend-name">Clone position</span><table class="map-legend-icon"><tr><td class="tunnel occupied"></td></tr></table></div>
					<div class="map-legend-item"><span class="map-legend-name">Final queue position</span><table class="map-legend-icon"><tr><td class="limestone final-location"></td></tr></table></div>
					<div class="map-legend-item"><span class="map-legend-name">Cursor position</span><table class="map-legend-icon"><tr><td class="limestone cursor-location"></td></tr></table></div>
					<div class="map-legend-item"><span class="map-legend-name">Hovered action</span><table class="map-legend-icon"><tr><td class="limestone hover-location"></td></tr></table></div>
					<div class="map-legend-item"><span class="map-legend-name">Viewed cell</span><table class="map-legend-icon"><tr><td class="limestone selected-map-cell"></td></tr></table></div>
				</div>
			</div>
		</div>
		<div id="location" class="vertical-block">
			<div id="location-details">
				<h3>Selected Location</h3>
				<h4 id="location-name"></h4>
				<div id="location-description"></div>
				<div id="location-next"></div>
				<div id="location-water"></div>
				<button id="pathfind-button" onclick="adjustableKeybindings.KeyF()">Pathfind Here (F)</button>
				<div id="location-route">
					<button id="route-button" class="button" onclick="loadRoute(true)">
						Load best route to this rock
						<input type="hidden" id="x-loc" />
						<input type="hidden" id="y-loc" />
					</button>
					<div id="route-has-route">
						Route time: <span id="route-best-time"></span>s<br />
						Stuff used: <span id="route-requirements"><span class="require"></span></span><br />
						Est. mana left: <span id="route-best-mana-left"></span>s<br />
						Probably
						<span id="route-best-unminable" hidden>cannot be refined</span>
						<span id="route-best-minable">can be refined about <u>123</u> times<span hidden></span></span>
						right now<br />
						<span id="route-best-invalidated" hidden>Route values will be reset on the next visit.</span>
					</div>
					<div id="route-not-visited">There is no known routes to this location.</div>
					<div id="failed-route">There is no known valid route to this location - check your prerequisites!
					</div>
					<div id="dead-route">This route ends with all your clones dead!</div>
					<button id="delete-route-button">Forget route</button>
					<button id="nogrind-button">Grinding</button>
				</div>
			</div>
			<div class="bottom-vertical-block">
				<hr />
				<h3>Actions</h3>
				<div class="block-row">
					<div class="small-option block clickable" onclick="addActionToQueue('U')">
						<span id="add-action-up">ðŸ¡…</span>
						<div class="description">Move up</div>
					</div>
					<div class="small-option block clickable" onclick="addActionToQueue('L')">
						<span id="add-action-left">ðŸ¡„</span>
						<div class="description">Move left</div>
					</div>
					<div class="small-option block clickable" onclick="addActionToQueue('D')">
						<span id="add-action-down">ðŸ¡‡</span>
						<div class="description">Move down</div>
					</div>
					<div class="small-option block clickable" onclick="addActionToQueue('R')">
						<span id="add-action-right">ðŸ¡†</span>
						<div class="description">Move right</div>
					</div>
					<div class="small-option block clickable" onclick="addActionToQueue('I')">
						<span id="add-action-interact">ðŸž‡</span>
						<div class="description">Interact</div>
					</div>
					<div class="small-option block clickable" onclick="addActionToQueue('T')">
						<span id="add-action-repeat-interact">ðŸž‡</span>
						<div class="description">Repeatedly Interact</div>
					</div>
				</div>
				<div class="block-row hidden-action">
					<div class="small-option block clickable hidden-action" onclick="fixedKeybindings.Digit1()">
						<span id="add-action-weaken">W</span>
						<div class="description">Weaken Rune</div>
					</div>
					<div class="small-option block clickable hidden-action" onclick="fixedKeybindings.Digit2()">
						<span id="add-action-wither">H</span>
						<div class="description">Wither Rune</div>
					</div>
					<div class="small-option block clickable hidden-action" onclick="fixedKeybindings.Digit3()">
						<span id="add-action-duplication">D</span>
						<div class="description">Duplication Rune</div>
					</div>
					<div class="small-option block clickable hidden-action" onclick="fixedKeybindings.Digit4()">
						<span id="add-action-teleport-to">T</span>
						<div class="description">Teleport To Rune</div>
					</div>
					<div class="small-option block clickable hidden-action" onclick="fixedKeybindings.Digit5()">
						<span id="add-action-teleport-from">F</span>
						<div class="description">Teleport From Rune</div>
					</div>
					<div class="small-option block clickable hidden-action" onclick="fixedKeybindings.Digit6()">
						<span id="add-action-pump">P</span>
						<div class="description">Pump Rune</div>
					</div>
				</div>
				<div class="block-row">
					<div class="small-option block clickable" onclick="adjustableKeybindings['Period']()">
						<span id="add-action-wait">.</span>
						<div class="description">Wait 100ms</div>
					</div>
					<div class="small-option block clickable" onclick="adjustableKeybindings['Comma']()">
						<span id="add-action-long-wait">,</span>
						<div class="description">Long wait (default 5000ms; see settings)</div>
					</div>
					<div class="small-option block clickable" onclick="adjustableKeybindings['>Semicolon']()">
						<span id="add-action-pause">:</span>
						<div class="description">Pause at this action</div>
					</div>
					<div class="small-option block clickable" onclick="fixedKeybindings['^KeyA']()">
						<span id="select-all">All</span>
						<div class="description">Select all</div>
					</div>
					<div class="small-option block clickable" onclick="fixedKeybindings.Backspace()">
						<span id="delete-action">&lt;=</span>
						<div class="description">Erase</div>
					</div>
					<div class="small-option block clickable" onclick="fixedKeybindings['^Backspace']()">
						<span id="delete-all-actions">X</span>
						<div class="description">Clear</div>
					</div>
				</div>
				<div class="option block clickable" onclick="addActionToQueue('<')">
					<span id="repeat-last-action">Repeat following action(s)</span>
					<div class="description">Repeat all actions after this action.</div>
				</div>
				<div class="block-row">
					<div class="small-option option block clickable" style="width: 45%" onclick="addActionToQueue('=')">
						Sync (=)
						<div class="description">If other clones have sync actions, wait until they're all on sync actions.</div>
					</div>
					<div class="small-option option block clickable" style="width: 45%" onclick="addActionToQueue('+')">
						No Sync (+)
						<div class="description">If a clone takes a No Sync action, it will not be considered for syncing with other clones for the rest of this zone until it takes another No Sync action.</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="queues"></div>
	<div id="timelines"></div>
	<div id="message-box" onclick="${Pe()}" hidden>
		<div id="message-wrapper">
			<h3 id="message-title"></h3>
			<div id="message-text"></div>
		</div>
	</div>
	<div id="config-box" onclick="hideConfig()" hidden>
		<div id="config-wrapper" onclick="(event => event.stopPropagation())(event)">
			<div class="option block clickable" onclick="toggleFollowZone()">
				<span id="follow-zone-toggle">Follow on zone complete</span> (Z)
				<div class="description big-description">Adjust what happens when your clones exit the zone you're currently viewing.</div>
			</div>
			<div class="option block clickable" onclick="togglePauseOnPortal()">
				<span id="pause-on-portal-toggle">Do not pause on portal</span> (L)
				<div class="description big-description">Pause when your clones enter a new zone.</div>
			</div>
			<div class="option block clickable" onclick="findUsedZoneRoutes(true)">
				<span class="name">Check zone route usage</span>
				<div class="description big-description">
					For performance reasons, the blue shading on unused zone routes may not update frequently; this forces an update.
				</div>
			</div>
			<div class="option block clickable" onclick="toggleTimeline()">
				<span id="timeline-toggle">Showing timeline</span>
				<div class="description big-description">It's a neat feature, but it might be a little eye-grabbing.
				</div>
			</div>
			<div class="option block clickable" onclick="Route.invalidateRouteCosts()">
				<span class="name">Revisit all known mana rocks in this realm</span>
				<div class="description big-description">You can also ctrl-click on the Grind option.</div>
			</div>
			<div class="option block clickable" onclick="toggleWarnings()">
				<span id="warnings">Showing warnings</span>
				<div class="description big-description">The game warns on clearing queues.</div>
			</div>
			<div class="option block clickable" onclick="toggleUseWASD()">
				<span id="use-wasd-toggle">Use WASD</span>
				<div class="description big-description">Some people.</div>
			</div>
			<div class="option block clickable" onclick="toggleStatGrindPerSec()">
				<span id="stat-grind-per-sec">Stat grind strategy: Total</span>
				<div class="description big-description">Change whether stat grind routes are saved based on the best total gain or the best per second gain.</div>
			</div>
			<div class="option block enter-value">
				<span class="label" for="max-time">Max tick time (ms)</span>
				<input id="max-time" onblur="setMaxTickTime(this)" />
				<div class="description big-description">
					Minimum value is 250; set this lower if the game is choppy. The maximum speed is dependant on your base Mana or capped by this value.
				</div>
			</div>
			<div class="option block enter-value">
				<span class="label" for="long-wait">Long Wait action time (ms)</span>
				<input id="long-wait" onblur="setLongWaitTime(this)" />
				<div class="description big-description">
					Determines how long a long wait action (,) is.
				</div>
			</div>
			<div class="option block enter-value">
				<span class="label" for="min-stat-gain">Minimum stat gain for grinding</span>
				<input id="min-stat-gain" onblur="setMinimumStatGain(this)" />
				<div class="description big-description">
					When grinding stats (S), pause when expected stat gain is less than this number.
				</div>
			</div>
		</div>
	</div>
	</div>
	<div id="loop-log-box" onclick="hideLoopLog()" hidden>
		<div id="loop-log-wrapper">
			<h3>Current Run Stats</h3>
			<div>
				<span id="loop-log-zones"></span>
				<span id="load-loop-log">Load this route</span>
			</div>
			<div id="gold-vaporized">
				<span id="loop-gold-count"></span> gold vaporized for <span id="loop-gold-value"></span> mana
			</div>
			<div id="loop-prev">
				<div class="log-entry" style="font-weight: bold;"><span>Previous Runs</span></div>
				<div id="loop-prev-list"></div>
			</div>
			<div id="loop-stats"></div>
			<div id="loop-actions" class="timeline"></div>
		</div>
	</div>
`;
